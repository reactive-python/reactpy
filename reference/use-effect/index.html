<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="It's React, but in Python."><meta name=author content=Archmonger><link href=https://reactive-python.github.io/reactpy/reference/use-effect/ rel=canonical><link href=../use-state/ rel=prev><link href=../use-async-effect/ rel=next><link rel=icon href=https://raw.githubusercontent.com/reactive-python/reactpy/main/branding/svg/reactpy-logo-square.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.4.0"><title>Use Effect 🚧 - ReactPy</title><link rel=stylesheet href=../../assets/stylesheets/main.9f615399.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.649f08f9.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h224V368c0-26.5 21.5-48 48-48h112V96c0-35.3-28.7-64-64-64H64zm384 320H336c-8.8 0-16 7.2-16 16v112l32-32 64-64 32-32z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../assets/css/main.css><link rel=stylesheet href=../../assets/css/button.css><link rel=stylesheet href=../../assets/css/admonition.css><link rel=stylesheet href=../../assets/css/banner.css><link rel=stylesheet href=../../assets/css/sidebar.css><link rel=stylesheet href=../../assets/css/navbar.css><link rel=stylesheet href=../../assets/css/table-of-contents.css><link rel=stylesheet href=../../assets/css/code.css><link rel=stylesheet href=../../assets/css/footer.css><link rel=stylesheet href=../../assets/css/home.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#overview class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest release. <a href=../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=ReactPy class="md-header__button md-logo" aria-label=ReactPy data-md-component=logo> <img src=https://raw.githubusercontent.com/reactive-python/reactpy/main/branding/svg/reactpy-logo-square.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ReactPy </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Use Effect 🚧 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81 1.42-1.42M1 13h3v-2H1m12 9h-2v3h2"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/reactive-python/reactpy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ReactPy </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../learn/quick-start/ class=md-tabs__link> Get Started </a> </li> <li class=md-tabs__item> <a href=../../learn/your-first-component/ class=md-tabs__link> Learn </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../overview/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../about/changelog/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=ReactPy class="md-nav__button md-logo" aria-label=ReactPy data-md-component=logo> <img src=https://raw.githubusercontent.com/reactive-python/reactpy/main/branding/svg/reactpy-logo-square.svg alt=logo> </a> ReactPy </label> <div class=md-nav__source> <a href=https://github.com/reactive-python/reactpy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ReactPy </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Get Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Get Started </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> Quick Start </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Quick Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learn/quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick start </span> </a> </li> <li class=md-nav__item> <a href=../../learn/tutorial-tic-tac-toe/ class=md-nav__link> <span class=md-ellipsis> Tutorial: Tic-Tac-Toe 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/thinking-in-react/ class=md-nav__link> <span class=md-ellipsis> Thinking in React </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Installation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learn/creating-a-react-app/ class=md-nav__link> <span class=md-ellipsis> Creating a Standalone React App </span> </a> </li> <li class=md-nav__item> <a href=../../learn/add-react-to-an-existing-project/ class=md-nav__link> <span class=md-ellipsis> Add React to an Existing Project </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Setup </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learn/editor-setup/ class=md-nav__link> <span class=md-ellipsis> Editor Setup </span> </a> </li> <li class=md-nav__item> <a href=../../learn/extra-tools-and-packages/ class=md-nav__link> <span class=md-ellipsis> Tools, Modules, and Packages 🚧 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Learn </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Learn </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Describing the UI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Describing the UI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learn/your-first-component/ class=md-nav__link> <span class=md-ellipsis> Your First Component 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/importing-and-exporting-components/ class=md-nav__link> <span class=md-ellipsis> Importing and Exporting Components 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/passing-props-to-a-component/ class=md-nav__link> <span class=md-ellipsis> Passing Props to a Component 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/conditional-rendering/ class=md-nav__link> <span class=md-ellipsis> Conditional Rendering 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/rendering-lists/ class=md-nav__link> <span class=md-ellipsis> Rendering Lists 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/keeping-components-pure/ class=md-nav__link> <span class=md-ellipsis> Keeping Components Pure 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Adding Interactivity </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Adding Interactivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learn/responding-to-events/ class=md-nav__link> <span class=md-ellipsis> Responding to Events 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/state-a-components-memory/ class=md-nav__link> <span class=md-ellipsis> State: A Component's Memory 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/render-and-commit/ class=md-nav__link> <span class=md-ellipsis> Render and Commit 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/state-as-a-snapshot/ class=md-nav__link> <span class=md-ellipsis> State as a Snapshot 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/queueing-a-series-of-state-updates/ class=md-nav__link> <span class=md-ellipsis> Queueing a Series of State Updates 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/updating-objects-in-state/ class=md-nav__link> <span class=md-ellipsis> Updating Objects in State 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/updating-arrays-in-state/ class=md-nav__link> <span class=md-ellipsis> Updating Arrays in State 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> Managing State </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Managing State </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learn/reacting-to-input-with-state/ class=md-nav__link> <span class=md-ellipsis> Reacting to Input with State 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/choosing-the-state-structure/ class=md-nav__link> <span class=md-ellipsis> Choosing the State Structure 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/sharing-state-between-components/ class=md-nav__link> <span class=md-ellipsis> Sharing State Between Components 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/preserving-and-resetting-state/ class=md-nav__link> <span class=md-ellipsis> Preserving and Resetting State 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/extracting-state-logic-into-a-reducer/ class=md-nav__link> <span class=md-ellipsis> Extracting State Logic into a Reducer 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/passing-data-deeply-with-context/ class=md-nav__link> <span class=md-ellipsis> Passing Data Deeply with Context 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/scaling-up-with-reducer-and-context/ class=md-nav__link> <span class=md-ellipsis> Scaling Up with Reducer and Context 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> Escape Hatches </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Escape Hatches </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../learn/referencing-values-with-refs/ class=md-nav__link> <span class=md-ellipsis> Referencing Values with Refs 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/manipulating-the-dom-with-refs/ class=md-nav__link> <span class=md-ellipsis> Manipulating the DOM with Refs 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/synchronizing-with-effects/ class=md-nav__link> <span class=md-ellipsis> Synchronizing with Effects 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/you-might-not-need-an-effect/ class=md-nav__link> <span class=md-ellipsis> You Might Not Need an Effect 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/lifecycle-of-reactive-effects/ class=md-nav__link> <span class=md-ellipsis> Lifecycle of Reactive Effects 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/separating-events-from-effects/ class=md-nav__link> <span class=md-ellipsis> Separating Events from Effects 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/removing-effect-dependencies/ class=md-nav__link> <span class=md-ellipsis> Removing Effect Dependencies 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/reusing-logic-with-custom-hooks/ class=md-nav__link> <span class=md-ellipsis> Reusing Logic with Custom Hooks 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/communicate-data-between-server-and-client/ class=md-nav__link> <span class=md-ellipsis> Communicating Data Between Server and Client 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/convert-between-vdom-and-html/ class=md-nav__link> <span class=md-ellipsis> Convert Between VDOM and HTML 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/vdom-mutations/ class=md-nav__link> <span class=md-ellipsis> VDOM Mutations 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/creating-vdom-event-handlers/ class=md-nav__link> <span class=md-ellipsis> Creating VDOM Event Handlers 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/creating-html-tags/ class=md-nav__link> <span class=md-ellipsis> Creating HTML Tags 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/creating-backends/ class=md-nav__link> <span class=md-ellipsis> Creating Backends 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../learn/manually-register-a-client/ class=md-nav__link> <span class=md-ellipsis> Manually Register a Client 🚧 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Hooks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=true> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Hooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../use-state/ class=md-nav__link> <span class=md-ellipsis> Use State 🚧 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Use Effect 🚧 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Use Effect 🚧 </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> Reference </a> <nav class=md-nav aria-label=Reference> <ul class=md-nav__list> <li class=md-nav__item> <a href=#useeffectsetup-dependencies class=md-nav__link> useEffect(setup, dependencies?) </a> <nav class=md-nav aria-label="useEffect(setup, dependencies?)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parameters class=md-nav__link> Parameters </a> </li> <li class=md-nav__item> <a href=#returns class=md-nav__link> Returns </a> </li> <li class=md-nav__item> <a href=#caveats class=md-nav__link> Caveats </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#connecting-to-an-external-system class=md-nav__link> Connecting to an external system </a> <nav class=md-nav aria-label="Connecting to an external system"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#connecting-to-a-chat-server class=md-nav__link> Connecting to a chat server </a> </li> <li class=md-nav__item> <a href=#listening-to-a-global-browser-event class=md-nav__link> Listening to a global browser event </a> </li> <li class=md-nav__item> <a href=#triggering-an-animation class=md-nav__link> Triggering an animation </a> </li> <li class=md-nav__item> <a href=#controlling-a-modal-dialog class=md-nav__link> Controlling a modal dialog </a> </li> <li class=md-nav__item> <a href=#tracking-element-visibility class=md-nav__link> Tracking element visibility </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#wrapping-effects-in-custom-hooks class=md-nav__link> Wrapping Effects in custom Hooks </a> <nav class=md-nav aria-label="Wrapping Effects in custom Hooks"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#custom-usechatroom-hook class=md-nav__link> Custom useChatRoom Hook </a> </li> <li class=md-nav__item> <a href=#custom-usewindowlistener-hook class=md-nav__link> Custom useWindowListener Hook </a> </li> <li class=md-nav__item> <a href=#custom-useintersectionobserver-hook class=md-nav__link> Custom useIntersectionObserver Hook </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#controlling-a-non-react-widget class=md-nav__link> Controlling a non-React widget </a> </li> <li class=md-nav__item> <a href=#fetching-data-with-effects class=md-nav__link> Fetching data with Effects </a> <nav class=md-nav aria-label="Fetching data with Effects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-are-good-alternatives-to-data-fetching-in-effects class=md-nav__link> What are good alternatives to data fetching in Effects? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#specifying-reactive-dependencies class=md-nav__link> Specifying reactive dependencies </a> <nav class=md-nav aria-label="Specifying reactive dependencies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#passing-a-dependency-array class=md-nav__link> Passing a dependency array </a> </li> <li class=md-nav__item> <a href=#passing-an-empty-dependency-array class=md-nav__link> Passing an empty dependency array </a> </li> <li class=md-nav__item> <a href=#passing-no-dependency-array-at-all class=md-nav__link> Passing no dependency array at all </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#updating-state-based-on-previous-state-from-an-effect class=md-nav__link> Updating state based on previous state from an Effect </a> </li> <li class=md-nav__item> <a href=#removing-unnecessary-object-dependencies class=md-nav__link> Removing unnecessary object dependencies </a> </li> <li class=md-nav__item> <a href=#removing-unnecessary-function-dependencies class=md-nav__link> Removing unnecessary function dependencies </a> </li> <li class=md-nav__item> <a href=#reading-the-latest-props-and-state-from-an-effect class=md-nav__link> Reading the latest props and state from an Effect </a> </li> <li class=md-nav__item> <a href=#displaying-different-content-on-the-server-and-the-client class=md-nav__link> Displaying different content on the server and the client </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#my-effect-runs-twice-when-the-component-mounts class=md-nav__link> My Effect runs twice when the component mounts </a> </li> <li class=md-nav__item> <a href=#my-effect-runs-after-every-re-render class=md-nav__link> My Effect runs after every re-render </a> </li> <li class=md-nav__item> <a href=#my-effect-keeps-re-running-in-an-infinite-cycle class=md-nav__link> My Effect keeps re-running in an infinite cycle </a> </li> <li class=md-nav__item> <a href=#my-cleanup-logic-runs-even-though-my-component-didnt-unmount class=md-nav__link> My cleanup logic runs even though my component didn't unmount </a> </li> <li class=md-nav__item> <a href=#my-effect-does-something-visual-and-i-see-a-flicker-before-it-runs class=md-nav__link> My Effect does something visual, and I see a flicker before it runs </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../use-async-effect/ class=md-nav__link> <span class=md-ellipsis> Use Async Effect 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../use-context/ class=md-nav__link> <span class=md-ellipsis> Use Context 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../use-reducer/ class=md-nav__link> <span class=md-ellipsis> Use Reducer 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../use-callback/ class=md-nav__link> <span class=md-ellipsis> Use Callback 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../use-memo/ class=md-nav__link> <span class=md-ellipsis> Use Memo 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../use-ref/ class=md-nav__link> <span class=md-ellipsis> Use Ref 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../use-debug-value/ class=md-nav__link> <span class=md-ellipsis> Use Debug Value 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../use-connection/ class=md-nav__link> <span class=md-ellipsis> Use Connection 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../use-scope/ class=md-nav__link> <span class=md-ellipsis> Use Scope 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../use-location/ class=md-nav__link> <span class=md-ellipsis> Use Location 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> HTML Tags </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> HTML Tags </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../common-props/ class=md-nav__link> <span class=md-ellipsis> Common Props 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../usage/ class=md-nav__link> <span class=md-ellipsis> Usage 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> Executors </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Executors </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reactpy/ class=md-nav__link> <span class=md-ellipsis> ReactPy </span> </a> </li> <li class=md-nav__item> <a href=../reactpy-csr/ class=md-nav__link> <span class=md-ellipsis> ReactPyCsr 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../reactpy-middleware/ class=md-nav__link> <span class=md-ellipsis> ReactPyMiddleware 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> Rules of React </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Rules of React </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../rules-of-react/ class=md-nav__link> <span class=md-ellipsis> Overview 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../components-and-hooks-must-be-pure/ class=md-nav__link> <span class=md-ellipsis> Components and Hooks must be pure 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../react-calls-components-and-hooks/ class=md-nav__link> <span class=md-ellipsis> React calls Components and Hooks 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../rules-of-hooks/ class=md-nav__link> <span class=md-ellipsis> Rules of Hooks 🚧 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../protocol-structure/ class=md-nav__link> <span class=md-ellipsis> Protocol Structure 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../client-api/ class=md-nav__link> <span class=md-ellipsis> Client API 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> About </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/community/ class=md-nav__link> <span class=md-ellipsis> Community 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/running-tests/ class=md-nav__link> <span class=md-ellipsis> Running Tests 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/code/ class=md-nav__link> <span class=md-ellipsis> Contributing Code 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/docs/ class=md-nav__link> <span class=md-ellipsis> Contributing Documentation 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/licenses/ class=md-nav__link> <span class=md-ellipsis> Licenses 🚧 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#reference class=md-nav__link> Reference </a> <nav class=md-nav aria-label=Reference> <ul class=md-nav__list> <li class=md-nav__item> <a href=#useeffectsetup-dependencies class=md-nav__link> useEffect(setup, dependencies?) </a> <nav class=md-nav aria-label="useEffect(setup, dependencies?)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#parameters class=md-nav__link> Parameters </a> </li> <li class=md-nav__item> <a href=#returns class=md-nav__link> Returns </a> </li> <li class=md-nav__item> <a href=#caveats class=md-nav__link> Caveats </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> Usage </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#connecting-to-an-external-system class=md-nav__link> Connecting to an external system </a> <nav class=md-nav aria-label="Connecting to an external system"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#connecting-to-a-chat-server class=md-nav__link> Connecting to a chat server </a> </li> <li class=md-nav__item> <a href=#listening-to-a-global-browser-event class=md-nav__link> Listening to a global browser event </a> </li> <li class=md-nav__item> <a href=#triggering-an-animation class=md-nav__link> Triggering an animation </a> </li> <li class=md-nav__item> <a href=#controlling-a-modal-dialog class=md-nav__link> Controlling a modal dialog </a> </li> <li class=md-nav__item> <a href=#tracking-element-visibility class=md-nav__link> Tracking element visibility </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#wrapping-effects-in-custom-hooks class=md-nav__link> Wrapping Effects in custom Hooks </a> <nav class=md-nav aria-label="Wrapping Effects in custom Hooks"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#custom-usechatroom-hook class=md-nav__link> Custom useChatRoom Hook </a> </li> <li class=md-nav__item> <a href=#custom-usewindowlistener-hook class=md-nav__link> Custom useWindowListener Hook </a> </li> <li class=md-nav__item> <a href=#custom-useintersectionobserver-hook class=md-nav__link> Custom useIntersectionObserver Hook </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#controlling-a-non-react-widget class=md-nav__link> Controlling a non-React widget </a> </li> <li class=md-nav__item> <a href=#fetching-data-with-effects class=md-nav__link> Fetching data with Effects </a> <nav class=md-nav aria-label="Fetching data with Effects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-are-good-alternatives-to-data-fetching-in-effects class=md-nav__link> What are good alternatives to data fetching in Effects? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#specifying-reactive-dependencies class=md-nav__link> Specifying reactive dependencies </a> <nav class=md-nav aria-label="Specifying reactive dependencies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#passing-a-dependency-array class=md-nav__link> Passing a dependency array </a> </li> <li class=md-nav__item> <a href=#passing-an-empty-dependency-array class=md-nav__link> Passing an empty dependency array </a> </li> <li class=md-nav__item> <a href=#passing-no-dependency-array-at-all class=md-nav__link> Passing no dependency array at all </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#updating-state-based-on-previous-state-from-an-effect class=md-nav__link> Updating state based on previous state from an Effect </a> </li> <li class=md-nav__item> <a href=#removing-unnecessary-object-dependencies class=md-nav__link> Removing unnecessary object dependencies </a> </li> <li class=md-nav__item> <a href=#removing-unnecessary-function-dependencies class=md-nav__link> Removing unnecessary function dependencies </a> </li> <li class=md-nav__item> <a href=#reading-the-latest-props-and-state-from-an-effect class=md-nav__link> Reading the latest props and state from an Effect </a> </li> <li class=md-nav__item> <a href=#displaying-different-content-on-the-server-and-the-client class=md-nav__link> Displaying different content on the server and the client </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#my-effect-runs-twice-when-the-component-mounts class=md-nav__link> My Effect runs twice when the component mounts </a> </li> <li class=md-nav__item> <a href=#my-effect-runs-after-every-re-render class=md-nav__link> My Effect runs after every re-render </a> </li> <li class=md-nav__item> <a href=#my-effect-keeps-re-running-in-an-infinite-cycle class=md-nav__link> My Effect keeps re-running in an infinite cycle </a> </li> <li class=md-nav__item> <a href=#my-cleanup-logic-runs-even-though-my-component-didnt-unmount class=md-nav__link> My cleanup logic runs even though my component didn't unmount </a> </li> <li class=md-nav__item> <a href=#my-effect-does-something-visual-and-i-see-a-flicker-before-it-runs class=md-nav__link> My Effect does something visual, and I see a flicker before it runs </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Use Effect 🚧</h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p class=intro> <code>useEffect</code> is a React Hook that lets you <a href=/learn/synchronizing-with-effects>synchronize a component with an external system.</a> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(</span><span class=nx>setup</span><span class=p>,</span><span class=w> </span><span class=nx>dependencies</span><span class=o>?</span><span class=p>)</span>
</code></pre></div></td></tr></table></div> </p> <hr> <h2 id=reference>Reference<a class=headerlink href=#reference title="Permanent link">&para;</a></h2> <h3 id=useeffectsetup-dependencies><code>useEffect(setup, dependencies?)</code><a class=headerlink href=#useeffectsetup-dependencies title="Permanent link">&para;</a></h3> <p>Call <code>useEffect</code> at the top level of your component to declare an Effect:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>]);</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><a href=#usage>See more examples below.</a></p> <h4 id=parameters>Parameters<a class=headerlink href=#parameters title="Permanent link">&para;</a></h4> <ul> <li> <p><code>setup</code>: The function with your Effect's logic. Your setup function may also optionally return a <em>cleanup</em> function. When your component is added to the DOM, React will run your setup function. After every re-render with changed dependencies, React will first run the cleanup function (if you provided it) with the old values, and then run your setup function with the new values. After your component is removed from the DOM, React will run your cleanup function.</p> </li> <li> <p><strong>optional</strong> <code>dependencies</code>: The list of all reactive values referenced inside of the <code>setup</code> code. Reactive values include props, state, and all the variables and functions declared directly inside your component body. If your linter is <a href=/learn/editor-setup#linting>configured for React</a>, it will verify that every reactive value is correctly specified as a dependency. The list of dependencies must have a constant number of items and be written inline like <code>[dep1, dep2, dep3]</code>. React will compare each dependency with its previous value using the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is><code>Object.is</code></a> comparison. If you omit this argument, your Effect will re-run after every re-render of the component. <a href=#examples-dependencies>See the difference between passing an array of dependencies, an empty array, and no dependencies at all.</a></p> </li> </ul> <h4 id=returns>Returns<a class=headerlink href=#returns title="Permanent link">&para;</a></h4> <p><code>useEffect</code> returns <code>undefined</code>.</p> <h4 id=caveats>Caveats<a class=headerlink href=#caveats title="Permanent link">&para;</a></h4> <ul> <li> <p><code>useEffect</code> is a Hook, so you can only call it <strong>at the top level of your component</strong> or your own Hooks. You can't call it inside loops or conditions. If you need that, extract a new component and move the state into it.</p> </li> <li> <p>If you're <strong>not trying to synchronize with some external system,</strong> <a href=/learn/you-might-not-need-an-effect>you probably don't need an Effect.</a></p> </li> <li> <p>When Strict Mode is on, React will <strong>run one extra development-only setup+cleanup cycle</strong> before the first real setup. This is a stress-test that ensures that your cleanup logic "mirrors" your setup logic and that it stops or undoes whatever the setup is doing. If this causes a problem, <a href=/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development>implement the cleanup function.</a></p> </li> <li> <p>If some of your dependencies are objects or functions defined inside the component, there is a risk that they will <strong>cause the Effect to re-run more often than needed.</strong> To fix this, remove unnecessary <a href=#removing-unnecessary-object-dependencies>object</a> and <a href=#removing-unnecessary-function-dependencies>function</a> dependencies. You can also <a href=#updating-state-based-on-previous-state-from-an-effect>extract state updates</a> and <a href=#reading-the-latest-props-and-state-from-an-effect>non-reactive logic</a> outside of your Effect.</p> </li> <li> <p>If your Effect wasn't caused by an interaction (like a click), React will let the browser <strong>paint the updated screen first before running your Effect.</strong> If your Effect is doing something visual (for example, positioning a tooltip), and the delay is noticeable (for example, it flickers), replace <code>useEffect</code> with <a href=/reference/react/useLayoutEffect><code>useLayoutEffect</code>.</a></p> </li> <li> <p>Even if your Effect was caused by an interaction (like a click), <strong>the browser may repaint the screen before processing the state updates inside your Effect.</strong> Usually, that's what you want. However, if you must block the browser from repainting the screen, you need to replace <code>useEffect</code> with <a href=/reference/react/useLayoutEffect><code>useLayoutEffect</code>.</a></p> </li> <li> <p>Effects <strong>only run on the client.</strong> They don't run during server rendering.</p> </li> </ul> <hr> <h2 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">&para;</a></h2> <h3 id=connecting-to-an-external-system>Connecting to an external system<a class=headerlink href=#connecting-to-an-external-system title="Permanent link">&para;</a></h3> <p>Some components need to stay connected to the network, some browser API, or a third-party library, while they are displayed on the page. These systems aren't controlled by React, so they are called <em>external.</em></p> <p>To <a href=/learn/synchronizing-with-effects>connect your component to some external system,</a> call <code>useEffect</code> at the top level of your component:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>]);</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>You need to pass two arguments to <code>useEffect</code>:</p> <ol> <li>A <em>setup function</em> with <codestep step={1}>setup code</codestep> that connects to that system.<ul> <li>It should return a <em>cleanup function</em> with <codestep step={2}>cleanup code</codestep> that disconnects from that system.</li> </ul> </li> <li>A <codestep step={3}>list of dependencies</codestep> including every value from your component used inside of those functions.</li> </ol> <p><strong>React calls your setup and cleanup functions whenever it's necessary, which may happen multiple times:</strong></p> <ol> <li>Your <codestep step={1}>setup code</codestep> runs when your component is added to the page <em>(mounts)</em>.</li> <li>After every re-render of your component where the <codestep step={3}>dependencies</codestep> have changed:<ul> <li>First, your <codestep step={2}>cleanup code</codestep> runs with the old props and state.</li> <li>Then, your <codestep step={1}>setup code</codestep> runs with the new props and state.</li> </ul> </li> <li>Your <codestep step={2}>cleanup code</codestep> runs one final time after your component is removed from the page <em>(unmounts).</em></li> </ol> <p><strong>Let's illustrate this sequence for the example above.</strong></p> <p>When the <code>ChatRoom</code> component above gets added to the page, it will connect to the chat room with the initial <code>serverUrl</code> and <code>roomId</code>. If either <code>serverUrl</code> or <code>roomId</code> change as a result of a re-render (say, if the user picks a different chat room in a dropdown), your Effect will <em>disconnect from the previous room, and connect to the next one.</em> When the <code>ChatRoom</code> component is removed from the page, your Effect will disconnect one last time.</p> <p><strong>To <a href=/learn/synchronizing-with-effects#step-3-add-cleanup-if-needed>help you find bugs,</a> in development React runs <codestep step={1}>setup</codestep> and <codestep step={2}>cleanup</codestep> one extra time before the <codestep step={1}>setup</codestep>.</strong> This is a stress-test that verifies your Effect's logic is implemented correctly. If this causes visible issues, your cleanup function is missing some logic. The cleanup function should stop or undo whatever the setup function was doing. The rule of thumb is that the user shouldn't be able to distinguish between the setup being called once (as in production) and a <em>setup</em> → <em>cleanup</em> → <em>setup</em> sequence (as in development). <a href=/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development>See common solutions.</a></p> <p><strong>Try to <a href=/learn/lifecycle-of-reactive-effects#each-effect-represents-a-separate-synchronization-process>write every Effect as an independent process</a> and <a href=/learn/lifecycle-of-reactive-effects#thinking-from-the-effects-perspective>think about a single setup/cleanup cycle at a time.</a></strong> It shouldn't matter whether your component is mounting, updating, or unmounting. When your cleanup logic correctly "mirrors" the setup logic, your Effect is resilient to running setup and cleanup as often as needed.</p> <p><note></p> <p>An Effect lets you <a href=/learn/synchronizing-with-effects>keep your component synchronized</a> with some external system (like a chat service). Here, <em>external system</em> means any piece of code that's not controlled by React, such as:</p> <ul> <li>A timer managed with <codestep step={1}><a href=https://developer.mozilla.org/en-US/docs/Web/API/setInterval><code>setInterval()</code></a></codestep> and <codestep step={2}><a href=https://developer.mozilla.org/en-US/docs/Web/API/clearInterval><code>clearInterval()</code></a></codestep>.</li> <li>An event subscription using <codestep step={1}><a href=https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener><code>window.addEventListener()</code></a></codestep> and <codestep step={2}><a href=https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/removeEventListener><code>window.removeEventListener()</code></a></codestep>.</li> <li>A third-party animation library with an API like <codestep step={1}><code>animation.start()</code></codestep> and <codestep step={2}><code>animation.reset()</code></codestep>.</li> </ul> <p><strong>If you're not connecting to any external system, <a href=/learn/you-might-not-need-an-effect>you probably don't need an Effect.</a></strong></p> <p></note></p> <p><recipes titletext="Examples of connecting to an external system" titleid=examples-connecting></p> <h4 id=connecting-to-a-chat-server>Connecting to a chat server<a class=headerlink href=#connecting-to-a-chat-server title="Permanent link">&para;</a></h4> <p>In this example, the <code>ChatRoom</code> component uses an Effect to stay connected to an external system defined in <code>chat.js</code>. Press "Open chat" to make the <code>ChatRoom</code> component appear. This sandbox runs in development mode, so there is an extra connect-and-disconnect cycle, as <a href=/learn/synchronizing-with-effects#step-3-add-cleanup-if-needed>explained here.</a> Try changing the <code>roomId</code> and <code>serverUrl</code> using the dropdown and the input, and see how the Effect re-connects to the chat. Press "Close chat" to see the Effect disconnect one last time.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>,</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Server</span><span class=w> </span><span class=nx>URL</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>serverUrl</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=nx>room</span><span class=o>!&lt;</span><span class=err>/h1&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>,</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;general&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Choose</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>chat</span><span class=w> </span><span class=nx>room</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;general&quot;</span><span class=o>&gt;</span><span class=nx>general</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;travel&quot;</span><span class=o>&gt;</span><span class=nx>travel</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;music&quot;</span><span class=o>&gt;</span><span class=nx>music</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>(</span><span class=o>!</span><span class=nx>show</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Close chat&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Open chat&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>ChatRoom</span><span class=w> </span><span class=nx>roomId</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// A real implementation would actually connect to the server</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;✅ Connecting to &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;...&quot;</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>disconnect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;❌ Disconnected from &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h4 id=listening-to-a-global-browser-event>Listening to a global browser event<a class=headerlink href=#listening-to-a-global-browser-event title="Permanent link">&para;</a></h4> <p>In this example, the external system is the browser DOM itself. Normally, you'd specify event listeners with JSX, but you can't listen to the global <a href=https://developer.mozilla.org/en-US/docs/Web/API/Window><code>window</code></a> object this way. An Effect lets you connect to the <code>window</code> object and listen to its events. Listening to the <code>pointermove</code> event lets you track the cursor (or finger) position and update the red dot to move with it.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>position</span><span class=p>,</span><span class=w> </span><span class=nx>setPosition</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span><span class=w> </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=p>});</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>function</span><span class=w> </span><span class=nx>handleMove</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setPosition</span><span class=p>({</span><span class=w> </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span><span class=w> </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=w> </span><span class=p>});</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>        </span><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&quot;pointermove&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>handleMove</span><span class=p>);</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nb>window</span><span class=p>.</span><span class=nx>removeEventListener</span><span class=p>(</span><span class=s2>&quot;pointermove&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>handleMove</span><span class=p>);</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;pink&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>borderRadius</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;50%&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>opacity</span><span class=o>:</span><span class=w> </span><span class=mf>0.6</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px, </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px)`</span><span class=p>,</span>
<span class=w>                </span><span class=nx>pointerEvents</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;none&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>left</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>20</span><span class=p>,</span>
<span class=w>                </span><span class=nx>top</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>20</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>40</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>40</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>300</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h4 id=triggering-an-animation>Triggering an animation<a class=headerlink href=#triggering-an-animation title="Permanent link">&para;</a></h4> <p>In this example, the external system is the animation library in <code>animation.js</code>. It provides a JavaScript class called <code>FadeInAnimation</code> that takes a DOM node as an argument and exposes <code>start()</code> and <code>stop()</code> methods to control the animation. This component <a href=/learn/manipulating-the-dom-with-refs>uses a ref</a> to access the underlying DOM node. The Effect reads the DOM node from the ref and automatically starts the animation for that node when the component appears.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>FadeInAnimation</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./animation.js&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>Welcome</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>animation</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>FadeInAnimation</span><span class=p>(</span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>);</span>
<span class=w>        </span><span class=nx>animation</span><span class=p>.</span><span class=nx>start</span><span class=p>(</span><span class=mf>1000</span><span class=p>);</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>animation</span><span class=p>.</span><span class=nx>stop</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>h1</span>
<span class=w>            </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>opacity</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=w>                </span><span class=nx>color</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;white&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>padding</span><span class=o>:</span><span class=w> </span><span class=mf>50</span><span class=p>,</span>
<span class=w>                </span><span class=nx>textAlign</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>fontSize</span><span class=o>:</span><span class=w> </span><span class=mf>50</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundImage</span><span class=o>:</span>
<span class=w>                    </span><span class=s2>&quot;radial-gradient(circle, rgba(63,94,251,1) 0%, rgba(252,70,107,1) 100%)&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>&gt;</span>
<span class=w>            </span><span class=nx>Welcome</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/h1&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>(</span><span class=o>!</span><span class=nx>show</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Remove&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Show&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>Welcome</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>class</span><span class=w> </span><span class=nx>FadeInAnimation</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kr>constructor</span><span class=p>(</span><span class=nx>node</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>node</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>start</span><span class=p>(</span><span class=nx>duration</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>duration</span><span class=p>;</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>duration</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=mf>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=c1>// Jump to end immediately</span>
<span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>onProgress</span><span class=p>(</span><span class=mf>1</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>onProgress</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>
<span class=w>            </span><span class=c1>// Start animating</span>
<span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>startTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>performance</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
<span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>frameId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>requestAnimationFrame</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>onFrame</span><span class=p>());</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>onFrame</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>timePassed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>performance</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>startTime</span><span class=p>;</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>progress</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>timePassed</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>duration</span><span class=p>,</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>onProgress</span><span class=p>(</span><span class=nx>progress</span><span class=p>);</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>progress</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mf>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=c1>// We still have more frames to paint</span>
<span class=w>            </span><span class=k>this</span><span class=p>.</span><span class=nx>frameId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>requestAnimationFrame</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=nx>onFrame</span><span class=p>());</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>onProgress</span><span class=p>(</span><span class=nx>progress</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>node</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>opacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>progress</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>stop</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>cancelAnimationFrame</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>frameId</span><span class=p>);</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>startTime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>frameId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=o>,</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>html</span><span class=o>,</span>
<span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>300</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h4 id=controlling-a-modal-dialog>Controlling a modal dialog<a class=headerlink href=#controlling-a-modal-dialog title="Permanent link">&para;</a></h4> <p>In this example, the external system is the browser DOM. The <code>ModalDialog</code> component renders a <a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog><code>&lt;dialog&gt;</code></a> element. It uses an Effect to synchronize the <code>isOpen</code> prop to the <a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement/showModal><code>showModal()</code></a> and <a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement/close><code>close()</code></a> method calls.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>ModalDialog</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./ModalDialog.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>(</span><span class=kc>true</span><span class=p>)}</span><span class=o>&gt;</span><span class=nx>Open</span><span class=w> </span><span class=nx>dialog</span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>ModalDialog</span><span class=w> </span><span class=nx>isOpen</span><span class=o>=</span><span class=p>{</span><span class=nx>show</span><span class=p>}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Hello</span><span class=w> </span><span class=nx>there</span><span class=o>!</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>br</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>button</span>
<span class=w>                    </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>                        </span><span class=nx>setShow</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>                    </span><span class=p>}}</span>
<span class=w>                </span><span class=o>&gt;</span>
<span class=w>                    </span><span class=nx>Close</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/ModalDialog&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>ModalDialog</span><span class=p>({</span><span class=w> </span><span class=nx>isOpen</span><span class=p>,</span><span class=w> </span><span class=nx>children</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>();</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>isOpen</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>return</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>dialog</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>;</span>
<span class=w>        </span><span class=nx>dialog</span><span class=p>.</span><span class=nx>showModal</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>dialog</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>isOpen</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>dialog</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>children</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/dialog&gt;;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>300</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h4 id=tracking-element-visibility>Tracking element visibility<a class=headerlink href=#tracking-element-visibility title="Permanent link">&para;</a></h4> <p>In this example, the external system is again the browser DOM. The <code>App</code> component displays a long list, then a <code>Box</code> component, and then another long list. Scroll the list down. Notice that when the <code>Box</code> component appears in the viewport, the background color changes to black. To implement this, the <code>Box</code> component uses an Effect to manage an <a href=https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API><code>IntersectionObserver</code></a>. This browser API notifies you when the DOM element is visible in the viewport.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nx>Box</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Box.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>LongSection</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Box</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>LongSection</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Box</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>LongSection</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>function</span><span class=w> </span><span class=nx>LongSection</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[];</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>let</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span><span class=p>;</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mf>50</span><span class=p>;</span><span class=w> </span><span class=nx>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>items</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=o>&lt;</span><span class=nx>li</span><span class=w> </span><span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>Item</span><span class=w> </span><span class=err>#</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span><span class=w> </span><span class=p>(</span><span class=nx>keep</span><span class=w> </span><span class=nx>scrolling</span><span class=p>)</span><span class=o>&lt;</span><span class=err>/li&gt;);</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>ul</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>items</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/ul&gt;;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useRef</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Box</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>div</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>;</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>observer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>IntersectionObserver</span><span class=p>((</span><span class=nx>entries</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>entry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>entries</span><span class=p>[</span><span class=mf>0</span><span class=p>];</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>entry</span><span class=p>.</span><span class=nx>isIntersecting</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>backgroundColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;black&quot;</span><span class=p>;</span>
<span class=w>                </span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;white&quot;</span><span class=p>;</span>
<span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>backgroundColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;white&quot;</span><span class=p>;</span>
<span class=w>                </span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;black&quot;</span><span class=p>;</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>        </span><span class=nx>observer</span><span class=p>.</span><span class=nx>observe</span><span class=p>(</span><span class=nx>div</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>threshold</span><span class=o>:</span><span class=w> </span><span class=mf>1.0</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>observer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>margin</span><span class=o>:</span><span class=w> </span><span class=mf>20</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>border</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2px solid black&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;blue&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p></recipes></p> <hr> <h3 id=wrapping-effects-in-custom-hooks>Wrapping Effects in custom Hooks<a class=headerlink href=#wrapping-effects-in-custom-hooks title="Permanent link">&para;</a></h3> <p>Effects are an <a href=/learn/escape-hatches>"escape hatch":</a> you use them when you need to "step outside React" and when there is no better built-in solution for your use case. If you find yourself often needing to manually write Effects, it's usually a sign that you need to extract some <a href=/learn/reusing-logic-with-custom-hooks>custom Hooks</a> for common behaviors your components rely on.</p> <p>For example, this <code>useChatRoom</code> custom Hook "hides" the logic of your Effect behind a more declarative API:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>useChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>serverUrl</span><span class=o>:</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span>
<span class=w>            </span><span class=nx>roomId</span><span class=o>:</span><span class=w> </span><span class=nx>roomId</span><span class=p>,</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>options</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>,</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>]);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Then you can use it from any component like this:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;https://localhost:1234&#39;</span><span class=p>);</span>

<span class=w>  </span><span class=nx>useChatRoom</span><span class=p>({</span>
<span class=w>    </span><span class=nx>roomId</span><span class=o>:</span><span class=w> </span><span class=nx>roomId</span><span class=p>,</span>
<span class=w>    </span><span class=nx>serverUrl</span><span class=o>:</span><span class=w> </span><span class=nx>serverUrl</span>
<span class=w>  </span><span class=p>});</span>
<span class=w>  </span><span class=c1>// ...</span>
</code></pre></div></td></tr></table></div> <p>There are also many excellent custom Hooks for every purpose available in the React ecosystem.</p> <p><a href=/learn/reusing-logic-with-custom-hooks>Learn more about wrapping Effects in custom Hooks.</a></p> <p><recipes titletext="Examples of wrapping Effects in custom Hooks" titleid=examples-custom-hooks></p> <h4 id=custom-usechatroom-hook>Custom <code>useChatRoom</code> Hook<a class=headerlink href=#custom-usechatroom-hook title="Permanent link">&para;</a></h4> <p>This example is identical to one of the <a href=#examples-connecting>earlier examples,</a> but the logic is extracted to a custom Hook.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useChatRoom</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./useChatRoom.js&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useChatRoom</span><span class=p>({</span>
<span class=w>        </span><span class=nx>roomId</span><span class=o>:</span><span class=w> </span><span class=nx>roomId</span><span class=p>,</span>
<span class=w>        </span><span class=nx>serverUrl</span><span class=o>:</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Server</span><span class=w> </span><span class=nx>URL</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>serverUrl</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=nx>room</span><span class=o>!&lt;</span><span class=err>/h1&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>,</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;general&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Choose</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>chat</span><span class=w> </span><span class=nx>room</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;general&quot;</span><span class=o>&gt;</span><span class=nx>general</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;travel&quot;</span><span class=o>&gt;</span><span class=nx>travel</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;music&quot;</span><span class=o>&gt;</span><span class=nx>music</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>(</span><span class=o>!</span><span class=nx>show</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Close chat&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Open chat&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>ChatRoom</span><span class=w> </span><span class=nx>roomId</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>useChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>,</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>]);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// A real implementation would actually connect to the server</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;✅ Connecting to &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;...&quot;</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>disconnect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;❌ Disconnected from &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h4 id=custom-usewindowlistener-hook>Custom <code>useWindowListener</code> Hook<a class=headerlink href=#custom-usewindowlistener-hook title="Permanent link">&para;</a></h4> <p>This example is identical to one of the <a href=#examples-connecting>earlier examples,</a> but the logic is extracted to a custom Hook.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useWindowListener</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./useWindowListener.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>position</span><span class=p>,</span><span class=w> </span><span class=nx>setPosition</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span><span class=w> </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=p>});</span>

<span class=w>    </span><span class=nx>useWindowListener</span><span class=p>(</span><span class=s2>&quot;pointermove&quot;</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPosition</span><span class=p>({</span><span class=w> </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span><span class=w> </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=w> </span><span class=p>});</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;pink&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>borderRadius</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;50%&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>opacity</span><span class=o>:</span><span class=w> </span><span class=mf>0.6</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px, </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px)`</span><span class=p>,</span>
<span class=w>                </span><span class=nx>pointerEvents</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;none&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>left</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>20</span><span class=p>,</span>
<span class=w>                </span><span class=nx>top</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>20</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>40</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>40</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>useWindowListener</span><span class=p>(</span><span class=nx>eventType</span><span class=p>,</span><span class=w> </span><span class=nx>listener</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=nx>eventType</span><span class=p>,</span><span class=w> </span><span class=nx>listener</span><span class=p>);</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nb>window</span><span class=p>.</span><span class=nx>removeEventListener</span><span class=p>(</span><span class=nx>eventType</span><span class=p>,</span><span class=w> </span><span class=nx>listener</span><span class=p>);</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>eventType</span><span class=p>,</span><span class=w> </span><span class=nx>listener</span><span class=p>]);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>300</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h4 id=custom-useintersectionobserver-hook>Custom <code>useIntersectionObserver</code> Hook<a class=headerlink href=#custom-useintersectionobserver-hook title="Permanent link">&para;</a></h4> <p>This example is identical to one of the <a href=#examples-connecting>earlier examples,</a> but the logic is partially extracted to a custom Hook.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=nx>Box</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Box.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>LongSection</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Box</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>LongSection</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Box</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>LongSection</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>function</span><span class=w> </span><span class=nx>LongSection</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>items</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[];</span>
<span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>let</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span><span class=p>;</span><span class=w> </span><span class=nx>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mf>50</span><span class=p>;</span><span class=w> </span><span class=nx>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>items</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=o>&lt;</span><span class=nx>li</span><span class=w> </span><span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>Item</span><span class=w> </span><span class=err>#</span><span class=p>{</span><span class=nx>i</span><span class=p>}</span><span class=w> </span><span class=p>(</span><span class=nx>keep</span><span class=w> </span><span class=nx>scrolling</span><span class=p>)</span><span class=o>&lt;</span><span class=err>/li&gt;);</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>ul</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>items</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/ul&gt;;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useRef</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useIntersectionObserver</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./useIntersectionObserver.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Box</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>isIntersecting</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useIntersectionObserver</span><span class=p>(</span><span class=nx>ref</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isIntersecting</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>backgroundColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;black&quot;</span><span class=p>;</span>
<span class=w>            </span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;white&quot;</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>backgroundColor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;white&quot;</span><span class=p>;</span>
<span class=w>            </span><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;black&quot;</span><span class=p>;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>isIntersecting</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>margin</span><span class=o>:</span><span class=w> </span><span class=mf>20</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>border</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;2px solid black&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;blue&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>useIntersectionObserver</span><span class=p>(</span><span class=nx>ref</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>isIntersecting</span><span class=p>,</span><span class=w> </span><span class=nx>setIsIntersecting</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>div</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>;</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>observer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>IntersectionObserver</span><span class=p>((</span><span class=nx>entries</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>entry</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>entries</span><span class=p>[</span><span class=mf>0</span><span class=p>];</span>
<span class=w>            </span><span class=nx>setIsIntersecting</span><span class=p>(</span><span class=nx>entry</span><span class=p>.</span><span class=nx>isIntersecting</span><span class=p>);</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>        </span><span class=nx>observer</span><span class=p>.</span><span class=nx>observe</span><span class=p>(</span><span class=nx>div</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>threshold</span><span class=o>:</span><span class=w> </span><span class=mf>1.0</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>observer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>ref</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nx>isIntersecting</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p></recipes></p> <hr> <h3 id=controlling-a-non-react-widget>Controlling a non-React widget<a class=headerlink href=#controlling-a-non-react-widget title="Permanent link">&para;</a></h3> <p>Sometimes, you want to keep an external system synchronized to some prop or state of your component.</p> <p>For example, if you have a third-party map widget or a video player component written without React, you can use an Effect to call methods on it that make its state match the current state of your React component. This Effect creates an instance of a <code>MapWidget</code> class defined in <code>map-widget.js</code>. When you change the <code>zoomLevel</code> prop of the <code>Map</code> component, the Effect calls the <code>setZoom()</code> on the class instance to keep it synchronized:</p> <p>```json package.json hidden { "dependencies": { "leaflet": "1.9.1", "react": "latest", "react-dom": "latest", "react-scripts": "latest", "remarkable": "2.0.1" }, "scripts": { "start": "react-scripts start", "build": "react-scripts build", "test": "react-scripts test --env=jsdom", "eject": "react-scripts eject" } } <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code>```js
import { useState } from &quot;react&quot;;
import Map from &quot;./Map.js&quot;;

export default function App() {
    const [zoomLevel, setZoomLevel] = useState(0);
    return (
        &lt;&gt;
            Zoom level: {zoomLevel}x
            &lt;button onClick={() =&gt; setZoomLevel(zoomLevel + 1)}&gt;+&lt;/button&gt;
            &lt;button onClick={() =&gt; setZoomLevel(zoomLevel - 1)}&gt;-&lt;/button&gt;
            &lt;hr /&gt;
            &lt;Map zoomLevel={zoomLevel} /&gt;
        &lt;/&gt;
    );
}
</code></pre></div></td></tr></table></div></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useRef</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>MapWidget</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./map-widget.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nb>Map</span><span class=p>({</span><span class=w> </span><span class=nx>zoomLevel</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>containerRef</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>mapRef</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>mapRef</span><span class=p>.</span><span class=nx>current</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>mapRef</span><span class=p>.</span><span class=nx>current</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>MapWidget</span><span class=p>(</span><span class=nx>containerRef</span><span class=p>.</span><span class=nx>current</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>mapRef</span><span class=p>.</span><span class=nx>current</span><span class=p>;</span>
<span class=w>        </span><span class=nx>map</span><span class=p>.</span><span class=nx>setZoom</span><span class=p>(</span><span class=nx>zoomLevel</span><span class=p>);</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>zoomLevel</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span><span class=w> </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>200</span><span class=p>,</span><span class=w> </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>200</span><span class=w> </span><span class=p>}}</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>containerRef</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=s2>&quot;leaflet/dist/leaflet.css&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=kr>as</span><span class=w> </span><span class=nx>L</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;leaflet&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=kd>class</span><span class=w> </span><span class=nx>MapWidget</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kr>constructor</span><span class=p>(</span><span class=nx>domNode</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>L</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>domNode</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>zoomControl</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nx>doubleClickZoom</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nx>boxZoom</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nx>keyboard</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nx>scrollWheelZoom</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nx>zoomAnimation</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nx>touchZoom</span><span class=o>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>            </span><span class=nx>zoomSnap</span><span class=o>:</span><span class=w> </span><span class=mf>0.1</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>        </span><span class=nx>L</span><span class=p>.</span><span class=nx>tileLayer</span><span class=p>(</span><span class=s2>&quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;</span><span class=p>,</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>maxZoom</span><span class=o>:</span><span class=w> </span><span class=mf>19</span><span class=p>,</span>
<span class=w>            </span><span class=nx>attribution</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;© OpenStreetMap&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=p>}).</span><span class=nx>addTo</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>map</span><span class=p>);</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>map</span><span class=p>.</span><span class=nx>setView</span><span class=p>([</span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=mf>0</span><span class=p>],</span><span class=w> </span><span class=mf>0</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nx>setZoom</span><span class=p>(</span><span class=nx>level</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=nx>map</span><span class=p>.</span><span class=nx>setZoom</span><span class=p>(</span><span class=nx>level</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>In this example, a cleanup function is not needed because the <code>MapWidget</code> class manages only the DOM node that was passed to it. After the <code>Map</code> React component is removed from the tree, both the DOM node and the <code>MapWidget</code> class instance will be automatically garbage-collected by the browser JavaScript engine.</p> <hr> <h3 id=fetching-data-with-effects>Fetching data with Effects<a class=headerlink href=#fetching-data-with-effects title="Permanent link">&para;</a></h3> <p>You can use an Effect to fetch data for your component. Note that <a href=/learn/start-a-new-react-project#production-grade-react-frameworks>if you use a framework,</a> using your framework's data fetching mechanism will be a lot more efficient than writing Effects manually.</p> <p>If you want to fetch data from an Effect manually, your code might look like this:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;react&#39;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>fetchBio</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s1>&#39;./api.js&#39;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Page</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;Alice&#39;</span><span class=p>);</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>bio</span><span class=p>,</span><span class=w> </span><span class=nx>setBio</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>  </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<span class=w>    </span><span class=nx>setBio</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=nx>fetchBio</span><span class=p>(</span><span class=nx>person</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>result</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>ignore</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setBio</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>});</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>]);</span>

<span class=w>  </span><span class=c1>// ...</span>
</code></pre></div></td></tr></table></div> <p>Note the <code>ignore</code> variable which is initialized to <code>false</code>, and is set to <code>true</code> during cleanup. This ensures <a href=https://maxrozen.com/race-conditions-fetching-data-react-with-useeffect>your code doesn't suffer from "race conditions":</a> network responses may arrive in a different order than you sent them.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>fetchBio</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./api.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Page</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Alice&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>bio</span><span class=p>,</span><span class=w> </span><span class=nx>setBio</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<span class=w>        </span><span class=nx>setBio</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>        </span><span class=nx>fetchBio</span><span class=p>(</span><span class=nx>person</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>result</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>ignore</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>setBio</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>                    </span><span class=nx>setPerson</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
<span class=w>                </span><span class=p>}}</span>
<span class=w>            </span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Alice&quot;</span><span class=o>&gt;</span><span class=nx>Alice</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Bob&quot;</span><span class=o>&gt;</span><span class=nx>Bob</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Taylor&quot;</span><span class=o>&gt;</span><span class=nx>Taylor</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>i</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>bio</span><span class=w> </span><span class=o>??</span><span class=w> </span><span class=s2>&quot;Loading...&quot;</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/i&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>fetchBio</span><span class=p>(</span><span class=nx>person</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>delay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>person</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;Bob&quot;</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=mf>2000</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=mf>200</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>resolve</span><span class=p>(</span><span class=s2>&quot;This is &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>person</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;’s bio.&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span><span class=w> </span><span class=nx>delay</span><span class=p>);</span>
<span class=w>    </span><span class=p>});</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>You can also rewrite using the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function><code>async</code> / <code>await</code></a> syntax, but you still need to provide a cleanup function:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>fetchBio</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./api.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Page</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Alice&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>bio</span><span class=p>,</span><span class=w> </span><span class=nx>setBio</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>startFetching</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setBio</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>fetchBio</span><span class=p>(</span><span class=nx>person</span><span class=p>);</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>ignore</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>setBio</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<span class=w>        </span><span class=nx>startFetching</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>                    </span><span class=nx>setPerson</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
<span class=w>                </span><span class=p>}}</span>
<span class=w>            </span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Alice&quot;</span><span class=o>&gt;</span><span class=nx>Alice</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Bob&quot;</span><span class=o>&gt;</span><span class=nx>Bob</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Taylor&quot;</span><span class=o>&gt;</span><span class=nx>Taylor</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>i</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>bio</span><span class=w> </span><span class=o>??</span><span class=w> </span><span class=s2>&quot;Loading...&quot;</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/i&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>fetchBio</span><span class=p>(</span><span class=nx>person</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>delay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>person</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;Bob&quot;</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=mf>2000</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=mf>200</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>resolve</span><span class=p>(</span><span class=s2>&quot;This is &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>person</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;’s bio.&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span><span class=w> </span><span class=nx>delay</span><span class=p>);</span>
<span class=w>    </span><span class=p>});</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Writing data fetching directly in Effects gets repetitive and makes it difficult to add optimizations like caching and server rendering later. <a href=/learn/reusing-logic-with-custom-hooks#when-to-use-custom-hooks>It's easier to use a custom Hook--either your own or maintained by the community.</a></p> <p><deepdive></p> <h4 id=what-are-good-alternatives-to-data-fetching-in-effects>What are good alternatives to data fetching in Effects?<a class=headerlink href=#what-are-good-alternatives-to-data-fetching-in-effects title="Permanent link">&para;</a></h4> <p>Writing <code>fetch</code> calls inside Effects is a <a href=https://www.robinwieruch.de/react-hooks-fetch-data/ >popular way to fetch data</a>, especially in fully client-side apps. This is, however, a very manual approach and it has significant downsides:</p> <ul> <li><strong>Effects don't run on the server.</strong> This means that the initial server-rendered HTML will only include a loading state with no data. The client computer will have to download all JavaScript and render your app only to discover that now it needs to load the data. This is not very efficient.</li> <li><strong>Fetching directly in Effects makes it easy to create "network waterfalls".</strong> You render the parent component, it fetches some data, renders the child components, and then they start fetching their data. If the network is not very fast, this is significantly slower than fetching all data in parallel.</li> <li><strong>Fetching directly in Effects usually means you don't preload or cache data.</strong> For example, if the component unmounts and then mounts again, it would have to fetch the data again.</li> <li><strong>It's not very ergonomic.</strong> There's quite a bit of boilerplate code involved when writing <code>fetch</code> calls in a way that doesn't suffer from bugs like <a href=https://maxrozen.com/race-conditions-fetching-data-react-with-useeffect>race conditions.</a></li> </ul> <p>This list of downsides is not specific to React. It applies to fetching data on mount with any library. Like with routing, data fetching is not trivial to do well, so we recommend the following approaches:</p> <ul> <li><strong>If you use a <a href=/learn/start-a-new-react-project#production-grade-react-frameworks>framework</a>, use its built-in data fetching mechanism.</strong> Modern React frameworks have integrated data fetching mechanisms that are efficient and don't suffer from the above pitfalls.</li> <li><strong>Otherwise, consider using or building a client-side cache.</strong> Popular open source solutions include <a href=https://react-query.tanstack.com/ >React Query</a>, <a href=https://swr.vercel.app/ >useSWR</a>, and <a href=https://beta.reactrouter.com/en/main/start/overview>React Router 6.4+.</a> You can build your own solution too, in which case you would use Effects under the hood but also add logic for deduplicating requests, caching responses, and avoiding network waterfalls (by preloading data or hoisting data requirements to routes).</li> </ul> <p>You can continue fetching data directly in Effects if neither of these approaches suit you.</p> <p></deepdive></p> <hr> <h3 id=specifying-reactive-dependencies>Specifying reactive dependencies<a class=headerlink href=#specifying-reactive-dependencies title="Permanent link">&para;</a></h3> <p><strong>Notice that you can't "choose" the dependencies of your Effect.</strong> Every <codestep step={2}>reactive value</codestep> used by your Effect's code must be declared as a dependency. Your Effect's dependency list is determined by the surrounding code:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// This is a reactive value</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>);</span><span class=w> </span><span class=c1>// This is a reactive value too</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span><span class=w> </span><span class=c1>// This Effect reads these reactive values</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>]);</span><span class=w> </span><span class=c1>// ✅ So you must specify them as dependencies of your Effect</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>If either <code>serverUrl</code> or <code>roomId</code> change, your Effect will reconnect to the chat using the new values.</p> <p><strong><a href=/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values>Reactive values</a> include props and all variables and functions declared directly inside of your component.</strong> Since <code>roomId</code> and <code>serverUrl</code> are reactive values, you can't remove them from the dependencies. If you try to omit them and <a href=/learn/editor-setup#linting>your linter is correctly configured for React,</a> the linter will flag this as a mistake you need to fix:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span><span class=w> </span><span class=c1>// 🔴 React Hook useEffect has missing dependencies: &#39;roomId&#39; and &#39;serverUrl&#39;</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><strong>To remove a dependency, you need to <a href=/learn/removing-effect-dependencies#removing-unnecessary-dependencies>"prove" to the linter that it <em>doesn't need</em> to be a dependency.</a></strong> For example, you can move <code>serverUrl</code> out of your component to prove that it's not reactive and won't change on re-renders:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>;</span><span class=w> </span><span class=c1>// Not a reactive value anymore</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>]);</span><span class=w> </span><span class=c1>// ✅ All dependencies declared</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Now that <code>serverUrl</code> is not a reactive value (and can't change on a re-render), it doesn't need to be a dependency. <strong>If your Effect's code doesn't use any reactive values, its dependency list should be empty (<code>[]</code>):</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>;</span><span class=w> </span><span class=c1>// Not a reactive value anymore</span>
<span class=kd>const</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;music&quot;</span><span class=p>;</span><span class=w> </span><span class=c1>// Not a reactive value anymore</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span><span class=w> </span><span class=c1>// ✅ All dependencies declared</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><a href=/learn/lifecycle-of-reactive-effects#what-an-effect-with-empty-dependencies-means>An Effect with empty dependencies</a> doesn't re-run when any of your component's props or state change.</p> <p><pitfall></p> <p>If you have an existing codebase, you might have some Effects that suppress the linter like this:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=w>    </span><span class=c1>// 🔴 Avoid suppressing the linter like this:</span>
<span class=w>    </span><span class=c1>// eslint-ignore-next-line react-hooks/exhaustive-deps</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</code></pre></div></td></tr></table></div> <p><strong>When dependencies don't match the code, there is a high risk of introducing bugs.</strong> By suppressing the linter, you "lie" to React about the values your Effect depends on. <a href=/learn/removing-effect-dependencies#removing-unnecessary-dependencies>Instead, prove they're unnecessary.</a></p> <p></pitfall></p> <p><recipes titletext="Examples of passing reactive dependencies" titleid=examples-dependencies></p> <h4 id=passing-a-dependency-array>Passing a dependency array<a class=headerlink href=#passing-a-dependency-array title="Permanent link">&para;</a></h4> <p>If you specify the dependencies, your Effect runs <strong>after the initial render <em>and</em> after re-renders with changed dependencies.</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=p>]);</span><span class=w> </span><span class=c1>// Runs again if a or b are different</span>
</code></pre></div></td></tr></table></div> <p>In the below example, <code>serverUrl</code> and <code>roomId</code> are <a href=/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values>reactive values,</a> so they both must be specified as dependencies. As a result, selecting a different room in the dropdown or editing the server URL input causes the chat to re-connect. However, since <code>message</code> isn't used in the Effect (and so it isn't a dependency), editing the message doesn't re-connect to the chat.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>message</span><span class=p>,</span><span class=w> </span><span class=nx>setMessage</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Server</span><span class=w> </span><span class=nx>URL</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>serverUrl</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=nx>room</span><span class=o>!&lt;</span><span class=err>/h1&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Your</span><span class=w> </span><span class=nx>message</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>message</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setMessage</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>,</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;general&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Choose</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>chat</span><span class=w> </span><span class=nx>room</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;general&quot;</span><span class=o>&gt;</span><span class=nx>general</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;travel&quot;</span><span class=o>&gt;</span><span class=nx>travel</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;music&quot;</span><span class=o>&gt;</span><span class=nx>music</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>(</span><span class=o>!</span><span class=nx>show</span><span class=p>)}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Close chat&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Open chat&quot;</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>ChatRoom</span><span class=w> </span><span class=nx>roomId</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// A real implementation would actually connect to the server</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;✅ Connecting to &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;...&quot;</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>disconnect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;❌ Disconnected from &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h4 id=passing-an-empty-dependency-array>Passing an empty dependency array<a class=headerlink href=#passing-an-empty-dependency-array title="Permanent link">&para;</a></h4> <p>If your Effect truly doesn't use any reactive values, it will only run <strong>after the initial render.</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span><span class=w> </span><span class=c1>// Does not run again (except once in development)</span>
</code></pre></div></td></tr></table></div> <p><strong>Even with empty dependencies, setup and cleanup will <a href=/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development>run one extra time in development</a> to help you find bugs.</strong></p> <p>In this example, both <code>serverUrl</code> and <code>roomId</code> are hardcoded. Since they're declared outside the component, they are not reactive values, and so they aren't dependencies. The dependency list is empty, so the Effect doesn't re-run on re-renders.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=kd>const</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>;</span>
<span class=kd>const</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;music&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>message</span><span class=p>,</span><span class=w> </span><span class=nx>setMessage</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=nx>room</span><span class=o>!&lt;</span><span class=err>/h1&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Your</span><span class=w> </span><span class=nx>message</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>message</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setMessage</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>(</span><span class=o>!</span><span class=nx>show</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Close chat&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Open chat&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>ChatRoom</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// A real implementation would actually connect to the server</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;✅ Connecting to &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;...&quot;</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>disconnect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;❌ Disconnected from &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <h4 id=passing-no-dependency-array-at-all>Passing no dependency array at all<a class=headerlink href=#passing-no-dependency-array-at-all title="Permanent link">&para;</a></h4> <p>If you pass no dependency array at all, your Effect runs <strong>after every single render (and re-render)</strong> of your component.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>});</span><span class=w> </span><span class=c1>// Always runs again</span>
</code></pre></div></td></tr></table></div> <p>In this example, the Effect re-runs when you change <code>serverUrl</code> and <code>roomId</code>, which is sensible. However, it <em>also</em> re-runs when you change the <code>message</code>, which is probably undesirable. This is why usually you'll specify the dependency array.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>message</span><span class=p>,</span><span class=w> </span><span class=nx>setMessage</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>});</span><span class=w> </span><span class=c1>// No dependency array at all</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Server</span><span class=w> </span><span class=nx>URL</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>serverUrl</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setServerUrl</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=nx>room</span><span class=o>!&lt;</span><span class=err>/h1&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Your</span><span class=w> </span><span class=nx>message</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>message</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setMessage</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>,</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;general&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Choose</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>chat</span><span class=w> </span><span class=nx>room</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;general&quot;</span><span class=o>&gt;</span><span class=nx>general</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;travel&quot;</span><span class=o>&gt;</span><span class=nx>travel</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;music&quot;</span><span class=o>&gt;</span><span class=nx>music</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>(</span><span class=o>!</span><span class=nx>show</span><span class=p>)}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Close chat&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Open chat&quot;</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>ChatRoom</span><span class=w> </span><span class=nx>roomId</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// A real implementation would actually connect to the server</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;✅ Connecting to &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;...&quot;</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>disconnect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;❌ Disconnected from &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p></recipes></p> <hr> <h3 id=updating-state-based-on-previous-state-from-an-effect>Updating state based on previous state from an Effect<a class=headerlink href=#updating-state-based-on-previous-state-from-an-effect title="Permanent link">&para;</a></h3> <p>When you want to update state based on previous state from an Effect, you might run into a problem:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>Counter</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>count</span><span class=p>,</span><span class=w> </span><span class=nx>setCount</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>intervalId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>setInterval</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setCount</span><span class=p>(</span><span class=nx>count</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1</span><span class=p>);</span><span class=w> </span><span class=c1>// You want to increment the counter every second...</span>
<span class=w>        </span><span class=p>},</span><span class=w> </span><span class=mf>1000</span><span class=p>);</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>clearInterval</span><span class=p>(</span><span class=nx>intervalId</span><span class=p>);</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>count</span><span class=p>]);</span><span class=w> </span><span class=c1>// 🚩 ... but specifying `count` as a dependency always resets the interval.</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Since <code>count</code> is a reactive value, it must be specified in the list of dependencies. However, that causes the Effect to cleanup and setup again every time the <code>count</code> changes. This is not ideal.</p> <p>To fix this, <a href=/reference/react/useState#updating-state-based-on-the-previous-state>pass the <code>c =&gt; c + 1</code> state updater</a> to <code>setCount</code>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Counter</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>count</span><span class=p>,</span><span class=w> </span><span class=nx>setCount</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>intervalId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>setInterval</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setCount</span><span class=p>((</span><span class=nx>c</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>c</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1</span><span class=p>);</span><span class=w> </span><span class=c1>// ✅ Pass a state updater</span>
<span class=w>        </span><span class=p>},</span><span class=w> </span><span class=mf>1000</span><span class=p>);</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>clearInterval</span><span class=p>(</span><span class=nx>intervalId</span><span class=p>);</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span><span class=w> </span><span class=c1>// ✅ Now count is not a dependency</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>count</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/h1&gt;;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-top</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>

<span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>150</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Now that you're passing <code>c =&gt; c + 1</code> instead of <code>count + 1</code>, <a href=/learn/removing-effect-dependencies#are-you-reading-some-state-to-calculate-the-next-state>your Effect no longer needs to depend on <code>count</code>.</a> As a result of this fix, it won't need to cleanup and setup the interval again every time the <code>count</code> changes.</p> <hr> <h3 id=removing-unnecessary-object-dependencies>Removing unnecessary object dependencies<a class=headerlink href=#removing-unnecessary-object-dependencies title="Permanent link">&para;</a></h3> <p>If your Effect depends on an object or a function created during rendering, it might run too often. For example, this Effect re-connects after every render because the <code>options</code> object is <a href=/learn/removing-effect-dependencies#does-some-reactive-value-change-unintentionally>different for every render:</a></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;https://localhost:1234&#39;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>message</span><span class=p>,</span><span class=w> </span><span class=nx>setMessage</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>

<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// 🚩 This object is created from scratch on every re-render</span>
<span class=w>    </span><span class=nx>serverUrl</span><span class=o>:</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span>
<span class=w>    </span><span class=nx>roomId</span><span class=o>:</span><span class=w> </span><span class=nx>roomId</span>
<span class=w>  </span><span class=p>};</span>

<span class=w>  </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>options</span><span class=p>);</span><span class=w> </span><span class=c1>// It&#39;s used inside the Effect</span>
<span class=w>    </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>options</span><span class=p>]);</span><span class=w> </span><span class=c1>// 🚩 As a result, these dependencies are always different on a re-render</span>
<span class=w>  </span><span class=c1>// ...</span>
</code></pre></div></td></tr></table></div> <p>Avoid using an object created during rendering as a dependency. Instead, create the object inside the Effect:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=kd>const</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>message</span><span class=p>,</span><span class=w> </span><span class=nx>setMessage</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>serverUrl</span><span class=o>:</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span>
<span class=w>            </span><span class=nx>roomId</span><span class=o>:</span><span class=w> </span><span class=nx>roomId</span><span class=p>,</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>options</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=nx>room</span><span class=o>!&lt;</span><span class=err>/h1&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>message</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setMessage</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>            </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>,</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;general&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Choose</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>chat</span><span class=w> </span><span class=nx>room</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;general&quot;</span><span class=o>&gt;</span><span class=nx>general</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;travel&quot;</span><span class=o>&gt;</span><span class=nx>travel</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;music&quot;</span><span class=o>&gt;</span><span class=nx>music</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>ChatRoom</span><span class=w> </span><span class=nx>roomId</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>createConnection</span><span class=p>({</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// A real implementation would actually connect to the server</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;✅ Connecting to &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;...&quot;</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>disconnect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;❌ Disconnected from &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Now that you create the <code>options</code> object inside the Effect, the Effect itself only depends on the <code>roomId</code> string.</p> <p>With this fix, typing into the input doesn't reconnect the chat. Unlike an object which gets re-created, a string like <code>roomId</code> doesn't change unless you set it to another value. <a href=/learn/removing-effect-dependencies>Read more about removing dependencies.</a></p> <hr> <h3 id=removing-unnecessary-function-dependencies>Removing unnecessary function dependencies<a class=headerlink href=#removing-unnecessary-function-dependencies title="Permanent link">&para;</a></h3> <p>If your Effect depends on an object or a function created during rendering, it might run too often. For example, this Effect re-connects after every render because the <code>createOptions</code> function is <a href=/learn/removing-effect-dependencies#does-some-reactive-value-change-unintentionally>different for every render:</a></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>message</span><span class=p>,</span><span class=w> </span><span class=nx>setMessage</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>);</span>

<span class=w>  </span><span class=kd>function</span><span class=w> </span><span class=nx>createOptions</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// 🚩 This function is created from scratch on every re-render</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nx>serverUrl</span><span class=o>:</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span>
<span class=w>      </span><span class=nx>roomId</span><span class=o>:</span><span class=w> </span><span class=nx>roomId</span>
<span class=w>    </span><span class=p>};</span>
<span class=w>  </span><span class=p>}</span>

<span class=w>  </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createOptions</span><span class=p>();</span><span class=w> </span><span class=c1>// It&#39;s used inside the Effect</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>();</span>
<span class=w>    </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>createOptions</span><span class=p>]);</span><span class=w> </span><span class=c1>// 🚩 As a result, these dependencies are always different on a re-render</span>
<span class=w>  </span><span class=c1>// ...</span>
</code></pre></div></td></tr></table></div> <p>By itself, creating a function from scratch on every re-render is not a problem. You don't need to optimize that. However, if you use it as a dependency of your Effect, it will cause your Effect to re-run after every re-render.</p> <p>Avoid using a function created during rendering as a dependency. Instead, declare it inside the Effect:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=kd>const</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;https://localhost:1234&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>message</span><span class=p>,</span><span class=w> </span><span class=nx>setMessage</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>function</span><span class=w> </span><span class=nx>createOptions</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>serverUrl</span><span class=o>:</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span>
<span class=w>                </span><span class=nx>roomId</span><span class=o>:</span><span class=w> </span><span class=nx>roomId</span><span class=p>,</span>
<span class=w>            </span><span class=p>};</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>options</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createOptions</span><span class=p>();</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>options</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=nx>room</span><span class=o>!&lt;</span><span class=err>/h1&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>message</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setMessage</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>            </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>,</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;general&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Choose</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>chat</span><span class=w> </span><span class=nx>room</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setRoomId</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                </span><span class=o>&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;general&quot;</span><span class=o>&gt;</span><span class=nx>general</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;travel&quot;</span><span class=o>&gt;</span><span class=nx>travel</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;music&quot;</span><span class=o>&gt;</span><span class=nx>music</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>ChatRoom</span><span class=w> </span><span class=nx>roomId</span><span class=o>=</span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>createConnection</span><span class=p>({</span><span class=w> </span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// A real implementation would actually connect to the server</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;✅ Connecting to &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;...&quot;</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>disconnect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span>
<span class=w>                </span><span class=s1>&#39;❌ Disconnected from &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; room at &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>serverUrl</span>
<span class=w>            </span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Now that you define the <code>createOptions</code> function inside the Effect, the Effect itself only depends on the <code>roomId</code> string. With this fix, typing into the input doesn't reconnect the chat. Unlike a function which gets re-created, a string like <code>roomId</code> doesn't change unless you set it to another value. <a href=/learn/removing-effect-dependencies>Read more about removing dependencies.</a></p> <hr> <h3 id=reading-the-latest-props-and-state-from-an-effect>Reading the latest props and state from an Effect<a class=headerlink href=#reading-the-latest-props-and-state-from-an-effect title="Permanent link">&para;</a></h3> <p><wip></p> <p>This section describes an <strong>experimental API that has not yet been released</strong> in a stable version of React.</p> <p></wip></p> <p>By default, when you read a reactive value from an Effect, you have to add it as a dependency. This ensures that your Effect "reacts" to every change of that value. For most dependencies, that's the behavior you want.</p> <p><strong>However, sometimes you'll want to read the <em>latest</em> props and state from an Effect without "reacting" to them.</strong> For example, imagine you want to log the number of the items in the shopping cart for every page visit:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>Page</span><span class=p>({</span><span class=w> </span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>shoppingCart</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>logVisit</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>shoppingCart</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>shoppingCart</span><span class=p>]);</span><span class=w> </span><span class=c1>// ✅ All dependencies declared</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><strong>What if you want to log a new page visit after every <code>url</code> change, but <em>not</em> if only the <code>shoppingCart</code> changes?</strong> You can't exclude <code>shoppingCart</code> from dependencies without breaking the <a href=#specifying-reactive-dependencies>reactivity rules.</a> However, you can express that you <em>don't want</em> a piece of code to "react" to changes even though it is called from inside an Effect. <a href=/learn/separating-events-from-effects#declaring-an-effect-event>Declare an <em>Effect Event</em></a> with the <a href=/reference/react/experimental_useEffectEvent><code>useEffectEvent</code></a> Hook, and move the code reading <code>shoppingCart</code> inside of it:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>Page</span><span class=p>({</span><span class=w> </span><span class=nx>url</span><span class=p>,</span><span class=w> </span><span class=nx>shoppingCart</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>onVisit</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useEffectEvent</span><span class=p>((</span><span class=nx>visitedUrl</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>logVisit</span><span class=p>(</span><span class=nx>visitedUrl</span><span class=p>,</span><span class=w> </span><span class=nx>shoppingCart</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>onVisit</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>url</span><span class=p>]);</span><span class=w> </span><span class=c1>// ✅ All dependencies declared</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><strong>Effect Events are not reactive and must always be omitted from dependencies of your Effect.</strong> This is what lets you put non-reactive code (where you can read the latest value of some props and state) inside of them. By reading <code>shoppingCart</code> inside of <code>onVisit</code>, you ensure that <code>shoppingCart</code> won't re-run your Effect.</p> <p><a href=/learn/separating-events-from-effects#reading-latest-props-and-state-with-effect-events>Read more about how Effect Events let you separate reactive and non-reactive code.</a></p> <hr> <h3 id=displaying-different-content-on-the-server-and-the-client>Displaying different content on the server and the client<a class=headerlink href=#displaying-different-content-on-the-server-and-the-client title="Permanent link">&para;</a></h3> <p>If your app uses server rendering (either <a href=/reference/react-dom/server>directly</a> or via a <a href=/learn/start-a-new-react-project#production-grade-react-frameworks>framework</a>), your component will render in two different environments. On the server, it will render to produce the initial HTML. On the client, React will run the rendering code again so that it can attach your event handlers to that HTML. This is why, for <a href=/reference/react-dom/client/hydrateRoot#hydrating-server-rendered-html>hydration</a> to work, your initial render output must be identical on the client and the server.</p> <p>In rare cases, you might need to display different content on the client. For example, if your app reads some data from <a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage><code>localStorage</code></a>, it can't possibly do that on the server. Here is how you could implement this:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>MyComponent</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>didMount</span><span class=p>,</span><span class=w> </span><span class=nx>setDidMount</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setDidMount</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>didMount</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// ... return client-only JSX ...</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// ... return initial JSX ...</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>While the app is loading, the user will see the initial render output. Then, when it's loaded and hydrated, your Effect will run and set <code>didMount</code> to <code>true</code>, triggering a re-render. This will switch to the client-only render output. Effects don't run on the server, so this is why <code>didMount</code> was <code>false</code> during the initial server render.</p> <p>Use this pattern sparingly. Keep in mind that users with a slow connection will see the initial content for quite a bit of time--potentially, many seconds--so you don't want to make jarring changes to your component's appearance. In many cases, you can avoid the need for this by conditionally showing different things with CSS.</p> <hr> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <h3 id=my-effect-runs-twice-when-the-component-mounts>My Effect runs twice when the component mounts<a class=headerlink href=#my-effect-runs-twice-when-the-component-mounts title="Permanent link">&para;</a></h3> <p>When Strict Mode is on, in development, React runs setup and cleanup one extra time before the actual setup.</p> <p>This is a stress-test that verifies your Effect’s logic is implemented correctly. If this causes visible issues, your cleanup function is missing some logic. The cleanup function should stop or undo whatever the setup function was doing. The rule of thumb is that the user shouldn’t be able to distinguish between the setup being called once (as in production) and a setup → cleanup → setup sequence (as in development).</p> <p>Read more about <a href=/learn/synchronizing-with-effects#step-3-add-cleanup-if-needed>how this helps find bugs</a> and <a href=/learn/synchronizing-with-effects#how-to-handle-the-effect-firing-twice-in-development>how to fix your logic.</a></p> <hr> <h3 id=my-effect-runs-after-every-re-render>My Effect runs after every re-render<a class=headerlink href=#my-effect-runs-after-every-re-render title="Permanent link">&para;</a></h3> <p>First, check that you haven't forgotten to specify the dependency array:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>});</span><span class=w> </span><span class=c1>// 🚩 No dependency array: re-runs after every render!</span>
</code></pre></div></td></tr></table></div> <p>If you've specified the dependency array but your Effect still re-runs in a loop, it's because one of your dependencies is different on every re-render.</p> <p>You can debug this problem by manually logging your dependencies to the console:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// ..</span>
<span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>]);</span>

<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>([</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>]);</span>
</code></pre></div></td></tr></table></div> <p>You can then right-click on the arrays from different re-renders in the console and select "Store as a global variable" for both of them. Assuming the first one got saved as <code>temp1</code> and the second one got saved as <code>temp2</code>, you can then use the browser console to check whether each dependency in both arrays is the same:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nb>Object</span><span class=p>.</span><span class=nx>is</span><span class=p>(</span><span class=nx>temp1</span><span class=p>[</span><span class=mf>0</span><span class=p>],</span><span class=w> </span><span class=nx>temp2</span><span class=p>[</span><span class=mf>0</span><span class=p>]);</span><span class=w> </span><span class=c1>// Is the first dependency the same between the arrays?</span>
<span class=nb>Object</span><span class=p>.</span><span class=nx>is</span><span class=p>(</span><span class=nx>temp1</span><span class=p>[</span><span class=mf>1</span><span class=p>],</span><span class=w> </span><span class=nx>temp2</span><span class=p>[</span><span class=mf>1</span><span class=p>]);</span><span class=w> </span><span class=c1>// Is the second dependency the same between the arrays?</span>
<span class=nb>Object</span><span class=p>.</span><span class=nx>is</span><span class=p>(</span><span class=nx>temp1</span><span class=p>[</span><span class=mf>2</span><span class=p>],</span><span class=w> </span><span class=nx>temp2</span><span class=p>[</span><span class=mf>2</span><span class=p>]);</span><span class=w> </span><span class=c1>// ... and so on for every dependency ...</span>
</code></pre></div></td></tr></table></div> <p>When you find the dependency that is different on every re-render, you can usually fix it in one of these ways:</p> <ul> <li><a href=#updating-state-based-on-previous-state-from-an-effect>Updating state based on previous state from an Effect</a></li> <li><a href=#removing-unnecessary-object-dependencies>Removing unnecessary object dependencies</a></li> <li><a href=#removing-unnecessary-function-dependencies>Removing unnecessary function dependencies</a></li> <li><a href=#reading-the-latest-props-and-state-from-an-effect>Reading the latest props and state from an Effect</a></li> </ul> <p>As a last resort (if these methods didn't help), wrap its creation with <a href=/reference/react/useMemo#memoizing-a-dependency-of-another-hook><code>useMemo</code></a> or <a href=/reference/react/useCallback#preventing-an-effect-from-firing-too-often><code>useCallback</code></a> (for functions).</p> <hr> <h3 id=my-effect-keeps-re-running-in-an-infinite-cycle>My Effect keeps re-running in an infinite cycle<a class=headerlink href=#my-effect-keeps-re-running-in-an-infinite-cycle title="Permanent link">&para;</a></h3> <p>If your Effect runs in an infinite cycle, these two things must be true:</p> <ul> <li>Your Effect is updating some state.</li> <li>That state leads to a re-render, which causes the Effect's dependencies to change.</li> </ul> <p>Before you start fixing the problem, ask yourself whether your Effect is connecting to some external system (like DOM, network, a third-party widget, and so on). Why does your Effect need to set state? Does it synchronize with that external system? Or are you trying to manage your application's data flow with it?</p> <p>If there is no external system, consider whether <a href=/learn/you-might-not-need-an-effect>removing the Effect altogether</a> would simplify your logic.</p> <p>If you're genuinely synchronizing with some external system, think about why and under what conditions your Effect should update the state. Has something changed that affects your component's visual output? If you need to keep track of some data that isn't used by rendering, a <a href=/reference/react/useRef#referencing-a-value-with-a-ref>ref</a> (which doesn't trigger re-renders) might be more appropriate. Verify your Effect doesn't update the state (and trigger re-renders) more than needed.</p> <p>Finally, if your Effect is updating the state at the right time, but there is still a loop, it's because that state update leads to one of the Effect's dependencies changing. <a href=/reference/react/useEffect#my-effect-runs-after-every-re-render>Read how to debug dependency changes.</a></p> <hr> <h3 id=my-cleanup-logic-runs-even-though-my-component-didnt-unmount>My cleanup logic runs even though my component didn't unmount<a class=headerlink href=#my-cleanup-logic-runs-even-though-my-component-didnt-unmount title="Permanent link">&para;</a></h3> <p>The cleanup function runs not only during unmount, but before every re-render with changed dependencies. Additionally, in development, React <a href=#my-effect-runs-twice-when-the-component-mounts>runs setup+cleanup one extra time immediately after component mounts.</a></p> <p>If you have cleanup code without corresponding setup code, it's usually a code smell:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// 🔴 Avoid: Cleanup logic without corresponding setup logic</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>doSomething</span><span class=p>();</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</code></pre></div></td></tr></table></div> <p>Your cleanup logic should be "symmetrical" to the setup logic, and should stop or undo whatever setup did:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>    </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>serverUrl</span><span class=p>,</span><span class=w> </span><span class=nx>roomId</span><span class=p>]);</span>
</code></pre></div></td></tr></table></div> <p><a href=/learn/lifecycle-of-reactive-effects#the-lifecycle-of-an-effect>Learn how the Effect lifecycle is different from the component's lifecycle.</a></p> <hr> <h3 id=my-effect-does-something-visual-and-i-see-a-flicker-before-it-runs>My Effect does something visual, and I see a flicker before it runs<a class=headerlink href=#my-effect-does-something-visual-and-i-see-a-flicker-before-it-runs title="Permanent link">&para;</a></h3> <p>If your Effect must block the browser from <a href=/learn/render-and-commit#epilogue-browser-paint>painting the screen,</a> replace <code>useEffect</code> with <a href=/reference/react/useLayoutEffect><code>useLayoutEffect</code></a>. Note that <strong>this shouldn't be needed for the vast majority of Effects.</strong> You'll only need this if it's crucial to run your Effect before the browser paint: for example, to measure and position a tooltip before the user sees it.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="June 21, 2023 05:37:58">June 21, 2023</span> </small> </div> <div class=md-source-date> <small> Authors: <span class="git-page-authors git-authors"><a href=mailto:16909269+archmonger@users.noreply.github.com>Archmonger</a></span> </small> </div> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy;<div id=year> </div> <script> document.getElementById("year").innerHTML = new Date().getFullYear(); </script>Reactive Python and affiliates.<div class=legal-footer-right>This project has no affiliation to ReactJS or Meta Platforms, Inc.</div> </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "content.code.copy", "search.highlight"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.4e0fa4ba.min.js></script> <script src=../../assets/js/main.js></script> </body> </html>