dist: xenial
language: python
cache: apt

addons:
  chrome: stable

before_install:
  - sudo apt update
  # javascript dependencies
  - sudo apt install nodejs
  - npm install -g yarn
  # install chromebrowser
  - wget -N http://chromedriver.storage.googleapis.com/2.38/chromedriver_linux64.zip -P ~/
  - unzip ~/chromedriver_linux64.zip -d ~/
  - rm ~/chromedriver_linux64.zip
  - sudo mv -f ~/chromedriver /usr/bin/
  - sudo chmod +x /usr/bin/chromedriver

install:
  # Install IDOM along with test requirements
  - pip install -r requirements.txt
  - pip install -e .[all]

script: cd $WORK_DIR && eval $TEST_CMD

matrix:
  include:
    - name: "python-3.6"
      python: 3.6
      env:
        - WORK_DIR="."
        - TEST_CMD="bash scripts/test.sh"
    - name: "python-3.7"
      python: 3.7
      env:
        - WORK_DIR="."
        - TEST_CMD="bash scripts/test.sh"

before_deploy:
  - sudo apt update
  # javascript dependencies
  - wget -qO- https://deb.nodesource.com/setup_8.x | sudo bash -
  - sudo apt install nodejs
  - npm install -g yarn

deploy:
  provider: pypi
  user: "__token__"
  password:
    secure: cV+nAh97EmaMQD4M7+u2MLeXvC5HuJs5A/9X1nqsLDVOus3qe6svhuorfBV0kQcxTq42DIm4/0KpobQAmhejvEEAFwXwTE1N3rqF7XuK41Zk3zvLbqAOXgACNGDN1TFQqLlN37zVQd9uZJAkdJYXKMv6m5Z+cGhYOc51J1Xzu3G/tQ03M/Lh3up9mmVpIpNCvoTAt/yO8zLzsu+hP7xODo6tkFYFqoLMWbszV9BgJ/uqERpBVKo4sE8OGa/YIBSOiQ1nNGcOYZIXON7frJT817UftTdlWc9Czmy/Cd/atCGXJVFbN2cQ0ysrOgbnZCR397b9EWuez0SmwCVqkdaK6oChfMJiiLRzCc53BSpFER4DrDno6B0V3likXFCDWl+ackI4PvJIlVTAlbeeJn7l/O2Ga2WTLEdl/kEx0Be1yGvFpbv+2Jz/UQ43Mevr34Whk9cocTW9rbJg/QTa5YlK4XzUwWoqkuMxQPC4d4DatkP+SoIdYnZhMoZYhzj9o93ZRjz9ZzWvNvb3ERj7d/ugiFnu1YgNebjkjFRcs1zIYGexXQ103aAfhZUzUqN9Y3zPZ++f66U/7r/4kWbxMYUOkXSnBqJEcbItz9EyXf6qhqoJmlovpQ7asDpgsax09AZJQqwUDmGJncGKUQgLYiK7HEGiYIlRzrKOlUnvxISYRLY=
  on:
    tags: true
