dist: xenial
language: python

python:
  - 3.6
  - 3.7
  - 3.8
  - 3.8-dev

cache: apt

addons:
  chrome: stable

before_install:
- sudo apt update
# javascript dependencies
- curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash
- nvm install 10.16.3
- nvm use 10.16.3
- npm --version
# install chromebrowser
- wget -N http://chromedriver.storage.googleapis.com/2.38/chromedriver_linux64.zip -P ~/
- unzip ~/chromedriver_linux64.zip -d ~/
- rm ~/chromedriver_linux64.zip
- sudo mv -f ~/chromedriver /usr/bin/
- sudo chmod +x /usr/bin/chromedriver

install:
# Install IDOM along with test requirements
- pip install -r requirements.txt
- pip install -e .[all]

script:
- bash scripts/test.sh

jobs:
  include:
  - stage: deploy
    if: tag IS present AND repo = rmorshea/idom
    python: 3.6
    script:
    - python setup.py bdist_wheel
    - twine upload dist/* -u $PYPI_USERNAME -p $PYPI_PASSWORD
