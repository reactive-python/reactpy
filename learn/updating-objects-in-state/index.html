<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="It's React, but in Python."><meta name=author content=Archmonger><link href=https://reactive-python.github.io/reactpy/learn/updating-objects-in-state/ rel=canonical><link href=../queueing-a-series-of-state-updates/ rel=prev><link href=../updating-arrays-in-state/ rel=next><link rel=icon href=https://raw.githubusercontent.com/reactive-python/reactpy/main/branding/svg/reactpy-logo-square.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.4.0"><title>Updating Objects in State ðŸš§ - ReactPy</title><link rel=stylesheet href=../../assets/stylesheets/main.9f615399.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.649f08f9.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h224V368c0-26.5 21.5-48 48-48h112V96c0-35.3-28.7-64-64-64H64zm384 320H336c-8.8 0-16 7.2-16 16v112l32-32 64-64 32-32z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../assets/css/main.css><link rel=stylesheet href=../../assets/css/button.css><link rel=stylesheet href=../../assets/css/admonition.css><link rel=stylesheet href=../../assets/css/banner.css><link rel=stylesheet href=../../assets/css/sidebar.css><link rel=stylesheet href=../../assets/css/navbar.css><link rel=stylesheet href=../../assets/css/table-of-contents.css><link rel=stylesheet href=../../assets/css/code.css><link rel=stylesheet href=../../assets/css/footer.css><link rel=stylesheet href=../../assets/css/home.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#overview class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest release. <a href=../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=ReactPy class="md-header__button md-logo" aria-label=ReactPy data-md-component=logo> <img src=https://raw.githubusercontent.com/reactive-python/reactpy/main/branding/svg/reactpy-logo-square.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ReactPy </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Updating Objects in State ðŸš§ </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81 1.42-1.42M1 13h3v-2H1m12 9h-2v3h2"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/reactive-python/reactpy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ReactPy </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../quick-start/ class=md-tabs__link> Get Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../your-first-component/ class=md-tabs__link> Learn </a> </li> <li class=md-tabs__item> <a href=../../reference/overview/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../about/changelog/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=ReactPy class="md-nav__button md-logo" aria-label=ReactPy data-md-component=logo> <img src=https://raw.githubusercontent.com/reactive-python/reactpy/main/branding/svg/reactpy-logo-square.svg alt=logo> </a> ReactPy </label> <div class=md-nav__source> <a href=https://github.com/reactive-python/reactpy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ReactPy </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Get Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Get Started </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> Quick Start </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Quick Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick start </span> </a> </li> <li class=md-nav__item> <a href=../tutorial-tic-tac-toe/ class=md-nav__link> <span class=md-ellipsis> Tutorial: Tic-Tac-Toe ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../thinking-in-react/ class=md-nav__link> <span class=md-ellipsis> Thinking in React </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Installation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../creating-a-react-app/ class=md-nav__link> <span class=md-ellipsis> Creating a Standalone React App </span> </a> </li> <li class=md-nav__item> <a href=../add-react-to-an-existing-project/ class=md-nav__link> <span class=md-ellipsis> Add React to an Existing Project </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Setup </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../editor-setup/ class=md-nav__link> <span class=md-ellipsis> Editor Setup </span> </a> </li> <li class=md-nav__item> <a href=../extra-tools-and-packages/ class=md-nav__link> <span class=md-ellipsis> Tools, Modules, and Packages ðŸš§ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Learn </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Learn </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Describing the UI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Describing the UI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../your-first-component/ class=md-nav__link> <span class=md-ellipsis> Your First Component ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../importing-and-exporting-components/ class=md-nav__link> <span class=md-ellipsis> Importing and Exporting Components ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../passing-props-to-a-component/ class=md-nav__link> <span class=md-ellipsis> Passing Props to a Component ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../conditional-rendering/ class=md-nav__link> <span class=md-ellipsis> Conditional Rendering ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../rendering-lists/ class=md-nav__link> <span class=md-ellipsis> Rendering Lists ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../keeping-components-pure/ class=md-nav__link> <span class=md-ellipsis> Keeping Components Pure ðŸš§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Adding Interactivity </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Adding Interactivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../responding-to-events/ class=md-nav__link> <span class=md-ellipsis> Responding to Events ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../state-a-components-memory/ class=md-nav__link> <span class=md-ellipsis> State: A Component's Memory ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../render-and-commit/ class=md-nav__link> <span class=md-ellipsis> Render and Commit ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../state-as-a-snapshot/ class=md-nav__link> <span class=md-ellipsis> State as a Snapshot ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../queueing-a-series-of-state-updates/ class=md-nav__link> <span class=md-ellipsis> Queueing a Series of State Updates ðŸš§ </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Updating Objects in State ðŸš§ </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Updating Objects in State ðŸš§ </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#whats-a-mutation class=md-nav__link> What's a mutation? </a> </li> <li class=md-nav__item> <a href=#treat-state-as-read-only class=md-nav__link> Treat state as read-only </a> <nav class=md-nav aria-label="Treat state as read-only"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-mutation-is-fine class=md-nav__link> Local mutation is fine </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#copying-objects-with-the-spread-syntax class=md-nav__link> Copying objects with the spread syntax </a> <nav class=md-nav aria-label="Copying objects with the spread syntax"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#using-a-single-event-handler-for-multiple-fields class=md-nav__link> Using a single event handler for multiple fields </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#updating-a-nested-object class=md-nav__link> Updating a nested object </a> <nav class=md-nav aria-label="Updating a nested object"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#objects-are-not-really-nested class=md-nav__link> Objects are not really nested </a> </li> <li class=md-nav__item> <a href=#write-concise-update-logic-with-immer class=md-nav__link> Write concise update logic with Immer </a> <nav class=md-nav aria-label="Write concise update logic with Immer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-does-immer-work class=md-nav__link> How does Immer work? </a> </li> <li class=md-nav__item> <a href=#why-is-mutating-state-not-recommended-in-react class=md-nav__link> Why is mutating state not recommended in React? </a> </li> <li class=md-nav__item> <a href=#fix-incorrect-state-updates class=md-nav__link> Fix incorrect state updates </a> </li> <li class=md-nav__item> <a href=#find-and-fix-the-mutation class=md-nav__link> Find and fix the mutation </a> </li> <li class=md-nav__item> <a href=#update-an-object-with-immer class=md-nav__link> Update an object with Immer </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../updating-arrays-in-state/ class=md-nav__link> <span class=md-ellipsis> Updating Arrays in State ðŸš§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> Managing State </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Managing State </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reacting-to-input-with-state/ class=md-nav__link> <span class=md-ellipsis> Reacting to Input with State ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../choosing-the-state-structure/ class=md-nav__link> <span class=md-ellipsis> Choosing the State Structure ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../sharing-state-between-components/ class=md-nav__link> <span class=md-ellipsis> Sharing State Between Components ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../preserving-and-resetting-state/ class=md-nav__link> <span class=md-ellipsis> Preserving and Resetting State ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../extracting-state-logic-into-a-reducer/ class=md-nav__link> <span class=md-ellipsis> Extracting State Logic into a Reducer ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../passing-data-deeply-with-context/ class=md-nav__link> <span class=md-ellipsis> Passing Data Deeply with Context ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../scaling-up-with-reducer-and-context/ class=md-nav__link> <span class=md-ellipsis> Scaling Up with Reducer and Context ðŸš§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> Escape Hatches </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Escape Hatches </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../referencing-values-with-refs/ class=md-nav__link> <span class=md-ellipsis> Referencing Values with Refs ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../manipulating-the-dom-with-refs/ class=md-nav__link> <span class=md-ellipsis> Manipulating the DOM with Refs ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../synchronizing-with-effects/ class=md-nav__link> <span class=md-ellipsis> Synchronizing with Effects ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../you-might-not-need-an-effect/ class=md-nav__link> <span class=md-ellipsis> You Might Not Need an Effect ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../lifecycle-of-reactive-effects/ class=md-nav__link> <span class=md-ellipsis> Lifecycle of Reactive Effects ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../separating-events-from-effects/ class=md-nav__link> <span class=md-ellipsis> Separating Events from Effects ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../removing-effect-dependencies/ class=md-nav__link> <span class=md-ellipsis> Removing Effect Dependencies ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../reusing-logic-with-custom-hooks/ class=md-nav__link> <span class=md-ellipsis> Reusing Logic with Custom Hooks ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../communicate-data-between-server-and-client/ class=md-nav__link> <span class=md-ellipsis> Communicating Data Between Server and Client ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../convert-between-vdom-and-html/ class=md-nav__link> <span class=md-ellipsis> Convert Between VDOM and HTML ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../vdom-mutations/ class=md-nav__link> <span class=md-ellipsis> VDOM Mutations ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../creating-vdom-event-handlers/ class=md-nav__link> <span class=md-ellipsis> Creating VDOM Event Handlers ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../creating-html-tags/ class=md-nav__link> <span class=md-ellipsis> Creating HTML Tags ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../creating-backends/ class=md-nav__link> <span class=md-ellipsis> Creating Backends ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../manually-register-a-client/ class=md-nav__link> <span class=md-ellipsis> Manually Register a Client ðŸš§ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Hooks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Hooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/use-state/ class=md-nav__link> <span class=md-ellipsis> Use State ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-effect/ class=md-nav__link> <span class=md-ellipsis> Use Effect ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-async-effect/ class=md-nav__link> <span class=md-ellipsis> Use Async Effect ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-context/ class=md-nav__link> <span class=md-ellipsis> Use Context ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-reducer/ class=md-nav__link> <span class=md-ellipsis> Use Reducer ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-callback/ class=md-nav__link> <span class=md-ellipsis> Use Callback ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-memo/ class=md-nav__link> <span class=md-ellipsis> Use Memo ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-ref/ class=md-nav__link> <span class=md-ellipsis> Use Ref ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-debug-value/ class=md-nav__link> <span class=md-ellipsis> Use Debug Value ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-connection/ class=md-nav__link> <span class=md-ellipsis> Use Connection ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-scope/ class=md-nav__link> <span class=md-ellipsis> Use Scope ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-location/ class=md-nav__link> <span class=md-ellipsis> Use Location ðŸš§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> HTML Tags </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> HTML Tags </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/common-props/ class=md-nav__link> <span class=md-ellipsis> Common Props ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/usage/ class=md-nav__link> <span class=md-ellipsis> Usage ðŸš§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> Executors </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Executors </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/reactpy/ class=md-nav__link> <span class=md-ellipsis> ReactPy </span> </a> </li> <li class=md-nav__item> <a href=../../reference/reactpy-csr/ class=md-nav__link> <span class=md-ellipsis> ReactPyCsr ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/reactpy-middleware/ class=md-nav__link> <span class=md-ellipsis> ReactPyMiddleware ðŸš§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> Rules of React </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Rules of React </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/rules-of-react/ class=md-nav__link> <span class=md-ellipsis> Overview ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/components-and-hooks-must-be-pure/ class=md-nav__link> <span class=md-ellipsis> Components and Hooks must be pure ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/react-calls-components-and-hooks/ class=md-nav__link> <span class=md-ellipsis> React calls Components and Hooks ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/rules-of-hooks/ class=md-nav__link> <span class=md-ellipsis> Rules of Hooks ðŸš§ </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../reference/protocol-structure/ class=md-nav__link> <span class=md-ellipsis> Protocol Structure ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../reference/client-api/ class=md-nav__link> <span class=md-ellipsis> Client API ðŸš§ </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> About </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../about/community/ class=md-nav__link> <span class=md-ellipsis> Community ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../about/running-tests/ class=md-nav__link> <span class=md-ellipsis> Running Tests ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../about/code/ class=md-nav__link> <span class=md-ellipsis> Contributing Code ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../about/docs/ class=md-nav__link> <span class=md-ellipsis> Contributing Documentation ðŸš§ </span> </a> </li> <li class=md-nav__item> <a href=../../about/licenses/ class=md-nav__link> <span class=md-ellipsis> Licenses ðŸš§ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#whats-a-mutation class=md-nav__link> What's a mutation? </a> </li> <li class=md-nav__item> <a href=#treat-state-as-read-only class=md-nav__link> Treat state as read-only </a> <nav class=md-nav aria-label="Treat state as read-only"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-mutation-is-fine class=md-nav__link> Local mutation is fine </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#copying-objects-with-the-spread-syntax class=md-nav__link> Copying objects with the spread syntax </a> <nav class=md-nav aria-label="Copying objects with the spread syntax"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#using-a-single-event-handler-for-multiple-fields class=md-nav__link> Using a single event handler for multiple fields </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#updating-a-nested-object class=md-nav__link> Updating a nested object </a> <nav class=md-nav aria-label="Updating a nested object"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#objects-are-not-really-nested class=md-nav__link> Objects are not really nested </a> </li> <li class=md-nav__item> <a href=#write-concise-update-logic-with-immer class=md-nav__link> Write concise update logic with Immer </a> <nav class=md-nav aria-label="Write concise update logic with Immer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#how-does-immer-work class=md-nav__link> How does Immer work? </a> </li> <li class=md-nav__item> <a href=#why-is-mutating-state-not-recommended-in-react class=md-nav__link> Why is mutating state not recommended in React? </a> </li> <li class=md-nav__item> <a href=#fix-incorrect-state-updates class=md-nav__link> Fix incorrect state updates </a> </li> <li class=md-nav__item> <a href=#find-and-fix-the-mutation class=md-nav__link> Find and fix the mutation </a> </li> <li class=md-nav__item> <a href=#update-an-object-with-immer class=md-nav__link> Update an object with Immer </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Updating Objects in State ðŸš§</h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p class=intro> State can hold any kind of JavaScript value, including objects. But you shouldn't change objects that you hold in the React state directly. Instead, when you want to update an object, you need to create a new one (or make a copy of an existing one), and then set the state to use that copy. </p> <div class="admonition summary"> <p class=admonition-title>You will learn</p> <ul> <li>How to correctly update an object in React state</li> <li>How to update a nested object without mutating it</li> <li>What immutability is, and how not to break it</li> <li>How to make object copying less repetitive with Immer</li> </ul> </div> <h2 id=whats-a-mutation>What's a mutation?<a class=headerlink href=#whats-a-mutation title="Permanent link">&para;</a></h2> <p>You can store any kind of JavaScript value in state.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>x</span><span class=p>,</span><span class=w> </span><span class=nx>setX</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>
</code></pre></div></td></tr></table></div> <p>So far you've been working with numbers, strings, and booleans. These kinds of JavaScript values are "immutable", meaning unchangeable or "read-only". You can trigger a re-render to <em>replace</em> a value:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>setX</span><span class=p>(</span><span class=mf>5</span><span class=p>);</span>
</code></pre></div></td></tr></table></div> <p>The <code>x</code> state changed from <code>0</code> to <code>5</code>, but the <em>number <code>0</code> itself</em> did not change. It's not possible to make any changes to the built-in primitive values like numbers, strings, and booleans in JavaScript.</p> <p>Now consider an object in state:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>position</span><span class=p>,</span><span class=w> </span><span class=nx>setPosition</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span><span class=w> </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span><span class=w> </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=w> </span><span class=p>});</span>
</code></pre></div></td></tr></table></div> <p>Technically, it is possible to change the contents of <em>the object itself</em>. <strong>This is called a mutation:</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>5</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <p>However, although objects in React state are technically mutable, you should treat them <strong>as if</strong> they were immutable--like numbers, booleans, and strings. Instead of mutating them, you should always replace them.</p> <h2 id=treat-state-as-read-only>Treat state as read-only<a class=headerlink href=#treat-state-as-read-only title="Permanent link">&para;</a></h2> <p>In other words, you should <strong>treat any JavaScript object that you put into state as read-only.</strong></p> <p>This example holds an object in state to represent the current pointer position. The red dot is supposed to move when you touch or move the cursor over the preview area. But the dot stays in the initial position:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>MovingDot</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>position</span><span class=p>,</span><span class=w> </span><span class=nx>setPosition</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=w>        </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>onPointerMove</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>;</span>
<span class=w>                </span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>;</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;100vw&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;100vh&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>                </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                    </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;red&quot;</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>borderRadius</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;50%&quot;</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px, </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px)`</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>left</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>10</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>top</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>10</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>20</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>20</span><span class=p>,</span>
<span class=w>                </span><span class=p>}}</span>
<span class=w>            </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>padding</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>250</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>The problem is with this bit of code.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>onPointerMove</span><span class=o>=</span><span class=p>{</span><span class=nx>e</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>;</span>
<span class=w>  </span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>;</span>
<span class=p>}}</span>
</code></pre></div></td></tr></table></div> <p>This code modifies the object assigned to <code>position</code> from <a href=/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time>the previous render.</a> But without using the state setting function, React has no idea that object has changed. So React does not do anything in response. It's like trying to change the order after you've already eaten the meal. While mutating state can work in some cases, we don't recommend it. You should treat the state value you have access to in a render as read-only.</p> <p>To actually <a href=/learn/state-as-a-snapshot#setting-state-triggers-renders>trigger a re-render</a> in this case, <strong>create a <em>new</em> object and pass it to the state setting function:</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>onPointerMove</span><span class=o>=</span><span class=p>{</span><span class=nx>e</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=nx>setPosition</span><span class=p>({</span>
<span class=w>    </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>    </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span>
<span class=w>  </span><span class=p>});</span>
<span class=p>}}</span>
</code></pre></div></td></tr></table></div> <p>With <code>setPosition</code>, you're telling React:</p> <ul> <li>Replace <code>position</code> with this new object</li> <li>And render this component again</li> </ul> <p>Notice how the red dot now follows your pointer when you touch or hover over the preview area:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>MovingDot</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>position</span><span class=p>,</span><span class=w> </span><span class=nx>setPosition</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=w>        </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>onPointerMove</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>setPosition</span><span class=p>({</span>
<span class=w>                    </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=w>                </span><span class=p>});</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;100vw&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;100vh&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>                </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                    </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;red&quot;</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>borderRadius</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;50%&quot;</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px, </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px)`</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>left</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>10</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>top</span><span class=o>:</span><span class=w> </span><span class=o>-</span><span class=mf>10</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>20</span><span class=p>,</span>
<span class=w>                    </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>20</span><span class=p>,</span>
<span class=w>                </span><span class=p>}}</span>
<span class=w>            </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>padding</span><span class=p>:</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
<span class=w>    </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>250</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><deepdive></p> <h4 id=local-mutation-is-fine>Local mutation is fine<a class=headerlink href=#local-mutation-is-fine title="Permanent link">&para;</a></h4> <p>Code like this is a problem because it modifies an <em>existing</em> object in state:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>;</span>
<span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <p>But code like this is <strong>absolutely fine</strong> because you're mutating a fresh object you have <em>just created</em>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=nx>nextPosition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{};</span>
<span class=nx>nextPosition</span><span class=p>.</span><span class=nx>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>;</span>
<span class=nx>nextPosition</span><span class=p>.</span><span class=nx>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>;</span>
<span class=nx>setPosition</span><span class=p>(</span><span class=nx>nextPosition</span><span class=p>);</span>
</code></pre></div></td></tr></table></div> <p>In fact, it is completely equivalent to writing this:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>setPosition</span><span class=p>({</span>
<span class=w>    </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>    </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=p>});</span>
</code></pre></div></td></tr></table></div> <p>Mutation is only a problem when you change <em>existing</em> objects that are already in state. Mutating an object you've just created is okay because <em>no other code references it yet.</em> Changing it isn't going to accidentally impact something that depends on it. This is called a "local mutation". You can even do local mutation <a href=/learn/keeping-components-pure#local-mutation-your-components-little-secret>while rendering.</a> Very convenient and completely okay!</p> <p></deepdive></p> <h2 id=copying-objects-with-the-spread-syntax>Copying objects with the spread syntax<a class=headerlink href=#copying-objects-with-the-spread-syntax title="Permanent link">&para;</a></h2> <p>In the previous example, the <code>position</code> object is always created fresh from the current cursor position. But often, you will want to include <em>existing</em> data as a part of the new object you're creating. For example, you may want to update <em>only one</em> field in a form, but keep the previous values for all other fields.</p> <p>These input fields don't work because the <code>onChange</code> handlers mutate the state:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Barbara&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Hepworth&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>email</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;bhepworth@sculpture.com&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleFirstNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>person</span><span class=p>.</span><span class=nx>firstName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleLastNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>person</span><span class=p>.</span><span class=nx>lastName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleEmailChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>person</span><span class=p>.</span><span class=nx>email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>First</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>firstName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleFirstNameChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Last</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>lastName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleLastNameChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Email</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>email</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleEmailChange</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>firstName</span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>lastName</span><span class=p>}</span><span class=w> </span><span class=p>({</span><span class=nx>person</span><span class=p>.</span><span class=nx>email</span><span class=p>})</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>For example, this line mutates the state from a past render:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>person</span><span class=p>.</span><span class=nx>firstName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <p>The reliable way to get the behavior you're looking for is to create a new object and pass it to <code>setPerson</code>. But here, you want to also <strong>copy the existing data into it</strong> because only one of the fields has changed:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>    </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span><span class=w> </span><span class=c1>// New first name from the input</span>
<span class=w>    </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=nx>person</span><span class=p>.</span><span class=nx>lastName</span><span class=p>,</span>
<span class=w>    </span><span class=nx>email</span><span class=o>:</span><span class=w> </span><span class=nx>person</span><span class=p>.</span><span class=nx>email</span><span class=p>,</span>
<span class=p>});</span>
</code></pre></div></td></tr></table></div> <p>You can use the <code>...</code> <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax#spread_in_object_literals>object spread</a> syntax so that you don't need to copy every property separately.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>    </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=c1>// Copy the old fields</span>
<span class=w>    </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span><span class=w> </span><span class=c1>// But override this one</span>
<span class=p>});</span>
</code></pre></div></td></tr></table></div> <p>Now the form works!</p> <p>Notice how you didn't declare a separate state variable for each input field. For large forms, keeping all data grouped in an object is very convenient--as long as you update it correctly!</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Barbara&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Hepworth&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>email</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;bhepworth@sculpture.com&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleFirstNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span>
<span class=w>            </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleLastNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span>
<span class=w>            </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleEmailChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span>
<span class=w>            </span><span class=nx>email</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>First</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>firstName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleFirstNameChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Last</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>lastName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleLastNameChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Email</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>email</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleEmailChange</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>firstName</span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>lastName</span><span class=p>}</span><span class=w> </span><span class=p>({</span><span class=nx>person</span><span class=p>.</span><span class=nx>email</span><span class=p>})</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Note that the <code>...</code> spread syntax is "shallow"--it only copies things one level deep. This makes it fast, but it also means that if you want to update a nested property, you'll have to use it more than once.</p> <p><deepdive></p> <h4 id=using-a-single-event-handler-for-multiple-fields>Using a single event handler for multiple fields<a class=headerlink href=#using-a-single-event-handler-for-multiple-fields title="Permanent link">&para;</a></h4> <p>You can also use the <code>[</code> and <code>]</code> braces inside your object definition to specify a property with dynamic name. Here is the same example, but with a single event handler instead of three different ones:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Barbara&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Hepworth&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>email</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;bhepworth@sculpture.com&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span>
<span class=w>            </span><span class=p>[</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>name</span><span class=p>]</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>First</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>name</span><span class=o>=</span><span class=s2>&quot;firstName&quot;</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>firstName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Last</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>name</span><span class=o>=</span><span class=s2>&quot;lastName&quot;</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>lastName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Email</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>name</span><span class=o>=</span><span class=s2>&quot;email&quot;</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>email</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>firstName</span><span class=p>}</span><span class=w> </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>lastName</span><span class=p>}</span><span class=w> </span><span class=p>({</span><span class=nx>person</span><span class=p>.</span><span class=nx>email</span><span class=p>})</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Here, <code>e.target.name</code> refers to the <code>name</code> property given to the <code>&lt;input&gt;</code> DOM element.</p> <p></deepdive></p> <h2 id=updating-a-nested-object>Updating a nested object<a class=headerlink href=#updating-a-nested-object title="Permanent link">&para;</a></h2> <p>Consider a nested object structure like this:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Niki de Saint Phalle&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Blue Nana&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>city</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Hamburg&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>image</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://i.imgur.com/Sd1AgUOm.jpg&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=p>},</span>
<span class=p>});</span>
</code></pre></div></td></tr></table></div> <p>If you wanted to update <code>person.artwork.city</code>, it's clear how to do it with mutation:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;New Delhi&quot;</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <p>But in React, you treat state as immutable! In order to change <code>city</code>, you would first need to produce the new <code>artwork</code> object (pre-populated with data from the previous one), and then produce the new <code>person</code> object which points at the new <code>artwork</code>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=nx>nextArtwork</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>,</span><span class=w> </span><span class=nx>city</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;New Delhi&quot;</span><span class=w> </span><span class=p>};</span>
<span class=kd>const</span><span class=w> </span><span class=nx>nextPerson</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=nx>nextArtwork</span><span class=w> </span><span class=p>};</span>
<span class=nx>setPerson</span><span class=p>(</span><span class=nx>nextPerson</span><span class=p>);</span>
</code></pre></div></td></tr></table></div> <p>Or, written as a single function call:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>    </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=c1>// Copy other fields</span>
<span class=w>    </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// but replace the artwork</span>
<span class=w>        </span><span class=p>...</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>,</span><span class=w> </span><span class=c1>// with the same one</span>
<span class=w>        </span><span class=nx>city</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;New Delhi&quot;</span><span class=p>,</span><span class=w> </span><span class=c1>// but in New Delhi!</span>
<span class=w>    </span><span class=p>},</span>
<span class=p>});</span>
</code></pre></div></td></tr></table></div> <p>This gets a bit wordy, but it works fine for many cases:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span>
<span class=normal>75</span>
<span class=normal>76</span>
<span class=normal>77</span>
<span class=normal>78</span>
<span class=normal>79</span>
<span class=normal>80</span>
<span class=normal>81</span>
<span class=normal>82</span>
<span class=normal>83</span>
<span class=normal>84</span>
<span class=normal>85</span>
<span class=normal>86</span>
<span class=normal>87</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Niki de Saint Phalle&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Blue Nana&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>city</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Hamburg&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>image</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://i.imgur.com/Sd1AgUOm.jpg&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span>
<span class=w>            </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleTitleChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span>
<span class=w>            </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=p>...</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>,</span>
<span class=w>                </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleCityChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span>
<span class=w>            </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=p>...</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>,</span>
<span class=w>                </span><span class=nx>city</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleImageChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPerson</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>person</span><span class=p>,</span>
<span class=w>            </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=p>...</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>,</span>
<span class=w>                </span><span class=nx>image</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleNameChange</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Title</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleTitleChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>City</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>city</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleCityChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Image</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>image</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleImageChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>i</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/i&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=s2>&quot; by &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>br</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>                </span><span class=p>(</span><span class=nx>located</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>city</span><span class=p>})</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>img</span><span class=w> </span><span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>image</span><span class=p>}</span><span class=w> </span><span class=nx>alt</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>img</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>width</span><span class=p>:</span><span class=w> </span><span class=mi>200</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>200</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><deepdive></p> <h4 id=objects-are-not-really-nested>Objects are not really nested<a class=headerlink href=#objects-are-not-really-nested title="Permanent link">&para;</a></h4> <p>An object like this appears "nested" in code:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>let</span><span class=w> </span><span class=nx>obj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Niki de Saint Phalle&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Blue Nana&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>city</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Hamburg&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>image</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://i.imgur.com/Sd1AgUOm.jpg&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=p>},</span>
<span class=p>};</span>
</code></pre></div></td></tr></table></div> <p>However, "nesting" is an inaccurate way to think about how objects behave. When the code executes, there is no such thing as a "nested" object. You are really looking at two different objects:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>let</span><span class=w> </span><span class=nx>obj1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Blue Nana&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>city</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Hamburg&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>image</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://i.imgur.com/Sd1AgUOm.jpg&quot;</span><span class=p>,</span>
<span class=p>};</span>

<span class=kd>let</span><span class=w> </span><span class=nx>obj2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Niki de Saint Phalle&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=nx>obj1</span><span class=p>,</span>
<span class=p>};</span>
</code></pre></div></td></tr></table></div> <p>The <code>obj1</code> object is not "inside" <code>obj2</code>. For example, <code>obj3</code> could "point" at <code>obj1</code> too:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>let</span><span class=w> </span><span class=nx>obj1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Blue Nana&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>city</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Hamburg&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>image</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://i.imgur.com/Sd1AgUOm.jpg&quot;</span><span class=p>,</span>
<span class=p>};</span>

<span class=kd>let</span><span class=w> </span><span class=nx>obj2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Niki de Saint Phalle&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=nx>obj1</span><span class=p>,</span>
<span class=p>};</span>

<span class=kd>let</span><span class=w> </span><span class=nx>obj3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Copycat&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=nx>obj1</span><span class=p>,</span>
<span class=p>};</span>
</code></pre></div></td></tr></table></div> <p>If you were to mutate <code>obj3.artwork.city</code>, it would affect both <code>obj2.artwork.city</code> and <code>obj1.city</code>. This is because <code>obj3.artwork</code>, <code>obj2.artwork</code>, and <code>obj1</code> are the same object. This is difficult to see when you think of objects as "nested". Instead, they are separate objects "pointing" at each other with properties.</p> <p></deepdive></p> <h3 id=write-concise-update-logic-with-immer>Write concise update logic with Immer<a class=headerlink href=#write-concise-update-logic-with-immer title="Permanent link">&para;</a></h3> <p>If your state is deeply nested, you might want to consider <a href=/learn/choosing-the-state-structure#avoid-deeply-nested-state>flattening it.</a> But, if you don't want to change your state structure, you might prefer a shortcut to nested spreads. <a href=https://github.com/immerjs/use-immer>Immer</a> is a popular library that lets you write using the convenient but mutating syntax and takes care of producing the copies for you. With Immer, the code you write looks like you are "breaking the rules" and mutating an object:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>updatePerson</span><span class=p>((</span><span class=nx>draft</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>draft</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Lagos&quot;</span><span class=p>;</span>
<span class=p>});</span>
</code></pre></div></td></tr></table></div> <p>But unlike a regular mutation, it doesn't overwrite the past state!</p> <p><deepdive></p> <h4 id=how-does-immer-work>How does Immer work?<a class=headerlink href=#how-does-immer-work title="Permanent link">&para;</a></h4> <p>The <code>draft</code> provided by Immer is a special type of object, called a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy>Proxy</a>, that "records" what you do with it. This is why you can mutate it freely as much as you like! Under the hood, Immer figures out which parts of the <code>draft</code> have been changed, and produces a completely new object that contains your edits.</p> <p></deepdive></p> <p>To try Immer:</p> <ol> <li>Run <code>npm install use-immer</code> to add Immer as a dependency</li> <li>Then replace <code>import { useState } from 'react'</code> with <code>import { useImmer } from 'use-immer'</code></li> </ol> <p>Here is the above example converted to Immer:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span>
<span class=normal>73</span>
<span class=normal>74</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useImmer</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;use-immer&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>updatePerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useImmer</span><span class=p>({</span>
<span class=w>        </span><span class=nx>name</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Niki de Saint Phalle&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>artwork</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>title</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Blue Nana&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>city</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Hamburg&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nx>image</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;https://i.imgur.com/Sd1AgUOm.jpg&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>updatePerson</span><span class=p>((</span><span class=nx>draft</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>draft</span><span class=p>.</span><span class=nx>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleTitleChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>updatePerson</span><span class=p>((</span><span class=nx>draft</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>draft</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>title</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleCityChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>updatePerson</span><span class=p>((</span><span class=nx>draft</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>draft</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleImageChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>updatePerson</span><span class=p>((</span><span class=nx>draft</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>draft</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>image</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleNameChange</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Title</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleTitleChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>City</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>city</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleCityChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Image</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>image</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleImageChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>i</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/i&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=s2>&quot; by &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>br</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>                </span><span class=p>(</span><span class=nx>located</span><span class=w> </span><span class=ow>in</span><span class=w> </span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>city</span><span class=p>})</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>img</span><span class=w> </span><span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>image</span><span class=p>}</span><span class=w> </span><span class=nx>alt</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>.</span><span class=nx>artwork</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;dependencies&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;immer&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.7.3&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;react&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;react-dom&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;react-scripts&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;use-immer&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;0.5.1&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=nt>&quot;scripts&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;start&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts start&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;build&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts build&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;test&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts test --env=jsdom&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;eject&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts eject&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>img</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>width</span><span class=p>:</span><span class=w> </span><span class=mi>200</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>200</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Notice how much more concise the event handlers have become. You can mix and match <code>useState</code> and <code>useImmer</code> in a single component as much as you like. Immer is a great way to keep the update handlers concise, especially if there's nesting in your state, and copying objects leads to repetitive code.</p> <p><deepdive></p> <h4 id=why-is-mutating-state-not-recommended-in-react>Why is mutating state not recommended in React?<a class=headerlink href=#why-is-mutating-state-not-recommended-in-react title="Permanent link">&para;</a></h4> <p>There are a few reasons:</p> <ul> <li><strong>Debugging:</strong> If you use <code>console.log</code> and don't mutate state, your past logs won't get clobbered by the more recent state changes. So you can clearly see how state has changed between renders.</li> <li><strong>Optimizations:</strong> Common React <a href=/reference/react/memo>optimization strategies</a> rely on skipping work if previous props or state are the same as the next ones. If you never mutate state, it is very fast to check whether there were any changes. If <code>prevObj === obj</code>, you can be sure that nothing could have changed inside of it.</li> <li><strong>New Features:</strong> The new React features we're building rely on state being <a href=/learn/state-as-a-snapshot>treated like a snapshot.</a> If you're mutating past versions of state, that may prevent you from using the new features.</li> <li><strong>Requirement Changes:</strong> Some application features, like implementing Undo/Redo, showing a history of changes, or letting the user reset a form to earlier values, are easier to do when nothing is mutated. This is because you can keep past copies of state in memory, and reuse them when appropriate. If you start with a mutative approach, features like this can be difficult to add later on.</li> <li><strong>Simpler Implementation:</strong> Because React does not rely on mutation, it does not need to do anything special with your objects. It does not need to hijack their properties, always wrap them into Proxies, or do other work at initialization as many "reactive" solutions do. This is also why React lets you put any object into state--no matter how large--without additional performance or correctness pitfalls.</li> </ul> <p>In practice, you can often "get away" with mutating state in React, but we strongly advise you not to do that so that you can use new React features developed with this approach in mind. Future contributors and perhaps even your future self will thank you!</p> <p></deepdive></p> <p><recap></p> <ul> <li>Treat all state in React as immutable.</li> <li>When you store objects in state, mutating them will not trigger renders and will change the state in previous render "snapshots".</li> <li>Instead of mutating an object, create a <em>new</em> version of it, and trigger a re-render by setting state to it.</li> <li>You can use the <code>{...obj, something: 'newValue'}</code> object spread syntax to create copies of objects.</li> <li>Spread syntax is shallow: it only copies one level deep.</li> <li>To update a nested object, you need to create copies all the way up from the place you're updating.</li> <li>To reduce repetitive copying code, use Immer.</li> </ul> <p></recap></p> <p><challenges></p> <h4 id=fix-incorrect-state-updates>Fix incorrect state updates<a class=headerlink href=#fix-incorrect-state-updates title="Permanent link">&para;</a></h4> <p>This form has a few bugs. Click the button that increases the score a few times. Notice that it does not increase. Then edit the first name, and notice that the score has suddenly "caught up" with your changes. Finally, edit the last name, and notice that the score has disappeared completely.</p> <p>Your task is to fix all of these bugs. As you fix them, explain why each of them happens.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Scoreboard</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>player</span><span class=p>,</span><span class=w> </span><span class=nx>setPlayer</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Ranjani&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Shettar&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>score</span><span class=o>:</span><span class=w> </span><span class=mf>10</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePlusClick</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>player</span><span class=p>.</span><span class=nx>score</span><span class=o>++</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleFirstNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPlayer</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>player</span><span class=p>,</span>
<span class=w>            </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleLastNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPlayer</span><span class=p>({</span>
<span class=w>            </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Score</span><span class=o>:</span><span class=w> </span><span class=o>&lt;</span><span class=nx>b</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>player</span><span class=p>.</span><span class=nx>score</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/b&gt;{&quot; &quot;}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePlusClick</span><span class=p>}</span><span class=o>&gt;+</span><span class=mf>1</span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>First</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>player</span><span class=p>.</span><span class=nx>firstName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleFirstNameChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Last</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>player</span><span class=p>.</span><span class=nx>lastName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleLastNameChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><solution></p> <p>Here is a version with both bugs fixed:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Scoreboard</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>player</span><span class=p>,</span><span class=w> </span><span class=nx>setPlayer</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Ranjani&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Shettar&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>score</span><span class=o>:</span><span class=w> </span><span class=mf>10</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePlusClick</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPlayer</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>player</span><span class=p>,</span>
<span class=w>            </span><span class=nx>score</span><span class=o>:</span><span class=w> </span><span class=nx>player</span><span class=p>.</span><span class=nx>score</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleFirstNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPlayer</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>player</span><span class=p>,</span>
<span class=w>            </span><span class=nx>firstName</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleLastNameChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setPlayer</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>player</span><span class=p>,</span>
<span class=w>            </span><span class=nx>lastName</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Score</span><span class=o>:</span><span class=w> </span><span class=o>&lt;</span><span class=nx>b</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>player</span><span class=p>.</span><span class=nx>score</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/b&gt;{&quot; &quot;}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePlusClick</span><span class=p>}</span><span class=o>&gt;+</span><span class=mf>1</span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>First</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>player</span><span class=p>.</span><span class=nx>firstName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleFirstNameChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Last</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                    </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>player</span><span class=p>.</span><span class=nx>lastName</span><span class=p>}</span>
<span class=w>                    </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleLastNameChange</span><span class=p>}</span>
<span class=w>                </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-left</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>5</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>The problem with <code>handlePlusClick</code> was that it mutated the <code>player</code> object. As a result, React did not know that there's a reason to re-render, and did not update the score on the screen. This is why, when you edited the first name, the state got updated, triggering a re-render which <em>also</em> updated the score on the screen.</p> <p>The problem with <code>handleLastNameChange</code> was that it did not copy the existing <code>...player</code> fields into the new object. This is why the score got lost after you edited the last name.</p> <p></solution></p> <h4 id=find-and-fix-the-mutation>Find and fix the mutation<a class=headerlink href=#find-and-fix-the-mutation title="Permanent link">&para;</a></h4> <p>There is a draggable box on a static background. You can change the box's color using the select input.</p> <p>But there is a bug. If you move the box first, and then change its color, the background (which isn't supposed to move!) will "jump" to the box position. But this should not happen: the <code>Background</code>'s <code>position</code> prop is set to <code>initialPosition</code>, which is <code>{ x: 0, y: 0 }</code>. Why is the background moving after the color change?</p> <p>Find the bug and fix it.</p> <p><hint></p> <p>If something unexpected changes, there is a mutation. Find the mutation in <code>App.js</code> and fix it.</p> <p></hint></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Background</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Background.js&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Box</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Box.js&quot;</span><span class=p>;</span>

<span class=kd>const</span><span class=w> </span><span class=nx>initialPosition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=w>    </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=p>};</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Canvas</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>shape</span><span class=p>,</span><span class=w> </span><span class=nx>setShape</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>color</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;orange&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=nx>initialPosition</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleMove</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span><span class=w> </span><span class=nx>dy</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>dx</span><span class=p>;</span>
<span class=w>        </span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>dy</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleColorChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setShape</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>shape</span><span class=p>,</span>
<span class=w>            </span><span class=nx>color</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>select</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>color</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleColorChange</span><span class=p>}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=o>&gt;</span><span class=nx>orange</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;lightpink&quot;</span><span class=o>&gt;</span><span class=nx>lightpink</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;aliceblue&quot;</span><span class=o>&gt;</span><span class=nx>aliceblue</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Background</span><span class=w> </span><span class=nx>position</span><span class=o>=</span><span class=p>{</span><span class=nx>initialPosition</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Box</span>
<span class=w>                </span><span class=nx>color</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>color</span><span class=p>}</span>
<span class=w>                </span><span class=nx>position</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onMove</span><span class=o>=</span><span class=p>{</span><span class=nx>handleMove</span><span class=p>}</span>
<span class=w>            </span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Drag</span><span class=w> </span><span class=nx>me</span><span class=o>!</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/Box&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Box</span><span class=p>({</span><span class=w> </span><span class=nx>children</span><span class=p>,</span><span class=w> </span><span class=nx>color</span><span class=p>,</span><span class=w> </span><span class=nx>position</span><span class=p>,</span><span class=w> </span><span class=nx>onMove</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>lastCoordinates</span><span class=p>,</span><span class=w> </span><span class=nx>setLastCoordinates</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerDown</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>setPointerCapture</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>pointerId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>setLastCoordinates</span><span class=p>({</span>
<span class=w>            </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>            </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerMove</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>lastCoordinates</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setLastCoordinates</span><span class=p>({</span>
<span class=w>                </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>                </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=w>            </span><span class=p>});</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>dx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>lastCoordinates</span><span class=p>.</span><span class=nx>x</span><span class=p>;</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>dy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>lastCoordinates</span><span class=p>.</span><span class=nx>y</span><span class=p>;</span>
<span class=w>            </span><span class=nx>onMove</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span><span class=w> </span><span class=nx>dy</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerUp</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setLastCoordinates</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>onPointerDown</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerDown</span><span class=p>}</span>
<span class=w>            </span><span class=nx>onPointerMove</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerMove</span><span class=p>}</span>
<span class=w>            </span><span class=nx>onPointerUp</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerUp</span><span class=p>}</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>cursor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;grab&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=nx>color</span><span class=p>,</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>border</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1px solid black&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>display</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;flex&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>justifyContent</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>alignItems</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span>
<span class=sb>          </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px,</span>
<span class=sb>          </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px</span>
<span class=sb>        )`</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>children</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Background</span><span class=p>({</span><span class=w> </span><span class=nx>position</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span>
<span class=sb>        </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px,</span>
<span class=sb>        </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px</span>
<span class=sb>      )`</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>250</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>250</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;rgba(200, 200, 0, 0.2)&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>280</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>select</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><solution></p> <p>The problem was in the mutation inside <code>handleMove</code>. It mutated <code>shape.position</code>, but that's the same object that <code>initialPosition</code> points at. This is why both the shape and the background move. (It's a mutation, so the change doesn't reflect on the screen until an unrelated update--the color change--triggers a re-render.)</p> <p>The fix is to remove the mutation from <code>handleMove</code>, and use the spread syntax to copy the shape. Note that <code>+=</code> is a mutation, so you need to rewrite it to use a regular <code>+</code> operation.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Background</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Background.js&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Box</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Box.js&quot;</span><span class=p>;</span>

<span class=kd>const</span><span class=w> </span><span class=nx>initialPosition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=w>    </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=p>};</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Canvas</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>shape</span><span class=p>,</span><span class=w> </span><span class=nx>setShape</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>color</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;orange&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=nx>initialPosition</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleMove</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span><span class=w> </span><span class=nx>dy</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setShape</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>shape</span><span class=p>,</span>
<span class=w>            </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>dx</span><span class=p>,</span>
<span class=w>                </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>dy</span><span class=p>,</span>
<span class=w>            </span><span class=p>},</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleColorChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setShape</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>shape</span><span class=p>,</span>
<span class=w>            </span><span class=nx>color</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>select</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>color</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleColorChange</span><span class=p>}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=o>&gt;</span><span class=nx>orange</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;lightpink&quot;</span><span class=o>&gt;</span><span class=nx>lightpink</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;aliceblue&quot;</span><span class=o>&gt;</span><span class=nx>aliceblue</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Background</span><span class=w> </span><span class=nx>position</span><span class=o>=</span><span class=p>{</span><span class=nx>initialPosition</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Box</span>
<span class=w>                </span><span class=nx>color</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>color</span><span class=p>}</span>
<span class=w>                </span><span class=nx>position</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onMove</span><span class=o>=</span><span class=p>{</span><span class=nx>handleMove</span><span class=p>}</span>
<span class=w>            </span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Drag</span><span class=w> </span><span class=nx>me</span><span class=o>!</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/Box&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Box</span><span class=p>({</span><span class=w> </span><span class=nx>children</span><span class=p>,</span><span class=w> </span><span class=nx>color</span><span class=p>,</span><span class=w> </span><span class=nx>position</span><span class=p>,</span><span class=w> </span><span class=nx>onMove</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>lastCoordinates</span><span class=p>,</span><span class=w> </span><span class=nx>setLastCoordinates</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerDown</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>setPointerCapture</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>pointerId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>setLastCoordinates</span><span class=p>({</span>
<span class=w>            </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>            </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerMove</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>lastCoordinates</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setLastCoordinates</span><span class=p>({</span>
<span class=w>                </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>                </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=w>            </span><span class=p>});</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>dx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>lastCoordinates</span><span class=p>.</span><span class=nx>x</span><span class=p>;</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>dy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>lastCoordinates</span><span class=p>.</span><span class=nx>y</span><span class=p>;</span>
<span class=w>            </span><span class=nx>onMove</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span><span class=w> </span><span class=nx>dy</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerUp</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setLastCoordinates</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>onPointerDown</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerDown</span><span class=p>}</span>
<span class=w>            </span><span class=nx>onPointerMove</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerMove</span><span class=p>}</span>
<span class=w>            </span><span class=nx>onPointerUp</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerUp</span><span class=p>}</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>cursor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;grab&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=nx>color</span><span class=p>,</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>border</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1px solid black&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>display</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;flex&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>justifyContent</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>alignItems</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span>
<span class=sb>          </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px,</span>
<span class=sb>          </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px</span>
<span class=sb>        )`</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>children</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Background</span><span class=p>({</span><span class=w> </span><span class=nx>position</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span>
<span class=sb>        </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px,</span>
<span class=sb>        </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px</span>
<span class=sb>      )`</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>250</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>250</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;rgba(200, 200, 0, 0.2)&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>280</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>select</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p></solution></p> <h4 id=update-an-object-with-immer>Update an object with Immer<a class=headerlink href=#update-an-object-with-immer title="Permanent link">&para;</a></h4> <p>This is the same buggy example as in the previous challenge. This time, fix the mutation by using Immer. For your convenience, <code>useImmer</code> is already imported, so you need to change the <code>shape</code> state variable to use it.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useImmer</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;use-immer&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Background</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Background.js&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Box</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Box.js&quot;</span><span class=p>;</span>

<span class=kd>const</span><span class=w> </span><span class=nx>initialPosition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=w>    </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=p>};</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Canvas</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>shape</span><span class=p>,</span><span class=w> </span><span class=nx>setShape</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>({</span>
<span class=w>        </span><span class=nx>color</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;orange&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=nx>initialPosition</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleMove</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span><span class=w> </span><span class=nx>dy</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>dx</span><span class=p>;</span>
<span class=w>        </span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>dy</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleColorChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setShape</span><span class=p>({</span>
<span class=w>            </span><span class=p>...</span><span class=nx>shape</span><span class=p>,</span>
<span class=w>            </span><span class=nx>color</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>select</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>color</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleColorChange</span><span class=p>}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=o>&gt;</span><span class=nx>orange</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;lightpink&quot;</span><span class=o>&gt;</span><span class=nx>lightpink</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;aliceblue&quot;</span><span class=o>&gt;</span><span class=nx>aliceblue</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Background</span><span class=w> </span><span class=nx>position</span><span class=o>=</span><span class=p>{</span><span class=nx>initialPosition</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Box</span>
<span class=w>                </span><span class=nx>color</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>color</span><span class=p>}</span>
<span class=w>                </span><span class=nx>position</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onMove</span><span class=o>=</span><span class=p>{</span><span class=nx>handleMove</span><span class=p>}</span>
<span class=w>            </span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Drag</span><span class=w> </span><span class=nx>me</span><span class=o>!</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/Box&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Box</span><span class=p>({</span><span class=w> </span><span class=nx>children</span><span class=p>,</span><span class=w> </span><span class=nx>color</span><span class=p>,</span><span class=w> </span><span class=nx>position</span><span class=p>,</span><span class=w> </span><span class=nx>onMove</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>lastCoordinates</span><span class=p>,</span><span class=w> </span><span class=nx>setLastCoordinates</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerDown</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>setPointerCapture</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>pointerId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>setLastCoordinates</span><span class=p>({</span>
<span class=w>            </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>            </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerMove</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>lastCoordinates</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setLastCoordinates</span><span class=p>({</span>
<span class=w>                </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>                </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=w>            </span><span class=p>});</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>dx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>lastCoordinates</span><span class=p>.</span><span class=nx>x</span><span class=p>;</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>dy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>lastCoordinates</span><span class=p>.</span><span class=nx>y</span><span class=p>;</span>
<span class=w>            </span><span class=nx>onMove</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span><span class=w> </span><span class=nx>dy</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerUp</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setLastCoordinates</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>onPointerDown</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerDown</span><span class=p>}</span>
<span class=w>            </span><span class=nx>onPointerMove</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerMove</span><span class=p>}</span>
<span class=w>            </span><span class=nx>onPointerUp</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerUp</span><span class=p>}</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>cursor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;grab&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=nx>color</span><span class=p>,</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>border</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1px solid black&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>display</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;flex&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>justifyContent</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>alignItems</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span>
<span class=sb>          </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px,</span>
<span class=sb>          </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px</span>
<span class=sb>        )`</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>children</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Background</span><span class=p>({</span><span class=w> </span><span class=nx>position</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span>
<span class=sb>        </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px,</span>
<span class=sb>        </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px</span>
<span class=sb>      )`</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>250</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>250</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;rgba(200, 200, 0, 0.2)&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>280</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>select</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;dependencies&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;immer&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.7.3&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;react&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;react-dom&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;react-scripts&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;use-immer&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;0.5.1&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=nt>&quot;scripts&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;start&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts start&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;build&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts build&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;test&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts test --env=jsdom&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;eject&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts eject&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><solution></p> <p>This is the solution rewritten with Immer. Notice how the event handlers are written in a mutating fashion, but the bug does not occur. This is because under the hood, Immer never mutates the existing objects.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useImmer</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;use-immer&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Background</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Background.js&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Box</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Box.js&quot;</span><span class=p>;</span>

<span class=kd>const</span><span class=w> </span><span class=nx>initialPosition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=w>    </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=mf>0</span><span class=p>,</span>
<span class=p>};</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Canvas</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>shape</span><span class=p>,</span><span class=w> </span><span class=nx>updateShape</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useImmer</span><span class=p>({</span>
<span class=w>        </span><span class=nx>color</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;orange&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=nx>initialPosition</span><span class=p>,</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleMove</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span><span class=w> </span><span class=nx>dy</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>updateShape</span><span class=p>((</span><span class=nx>draft</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>draft</span><span class=p>.</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>dx</span><span class=p>;</span>
<span class=w>            </span><span class=nx>draft</span><span class=p>.</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=nx>dy</span><span class=p>;</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleColorChange</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>updateShape</span><span class=p>((</span><span class=nx>draft</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>draft</span><span class=p>.</span><span class=nx>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>select</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>color</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>handleColorChange</span><span class=p>}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;orange&quot;</span><span class=o>&gt;</span><span class=nx>orange</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;lightpink&quot;</span><span class=o>&gt;</span><span class=nx>lightpink</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;aliceblue&quot;</span><span class=o>&gt;</span><span class=nx>aliceblue</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Background</span><span class=w> </span><span class=nx>position</span><span class=o>=</span><span class=p>{</span><span class=nx>initialPosition</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>Box</span>
<span class=w>                </span><span class=nx>color</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>color</span><span class=p>}</span>
<span class=w>                </span><span class=nx>position</span><span class=o>=</span><span class=p>{</span><span class=nx>shape</span><span class=p>.</span><span class=nx>position</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onMove</span><span class=o>=</span><span class=p>{</span><span class=nx>handleMove</span><span class=p>}</span>
<span class=w>            </span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>Drag</span><span class=w> </span><span class=nx>me</span><span class=o>!</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/Box&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Box</span><span class=p>({</span><span class=w> </span><span class=nx>children</span><span class=p>,</span><span class=w> </span><span class=nx>color</span><span class=p>,</span><span class=w> </span><span class=nx>position</span><span class=p>,</span><span class=w> </span><span class=nx>onMove</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>lastCoordinates</span><span class=p>,</span><span class=w> </span><span class=nx>setLastCoordinates</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerDown</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>setPointerCapture</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>pointerId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>setLastCoordinates</span><span class=p>({</span>
<span class=w>            </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>            </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerMove</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>lastCoordinates</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setLastCoordinates</span><span class=p>({</span>
<span class=w>                </span><span class=nx>x</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=p>,</span>
<span class=w>                </span><span class=nx>y</span><span class=o>:</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=p>,</span>
<span class=w>            </span><span class=p>});</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>dx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientX</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>lastCoordinates</span><span class=p>.</span><span class=nx>x</span><span class=p>;</span>
<span class=w>            </span><span class=kd>const</span><span class=w> </span><span class=nx>dy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>e</span><span class=p>.</span><span class=nx>clientY</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=nx>lastCoordinates</span><span class=p>.</span><span class=nx>y</span><span class=p>;</span>
<span class=w>            </span><span class=nx>onMove</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span><span class=w> </span><span class=nx>dy</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handlePointerUp</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setLastCoordinates</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>onPointerDown</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerDown</span><span class=p>}</span>
<span class=w>            </span><span class=nx>onPointerMove</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerMove</span><span class=p>}</span>
<span class=w>            </span><span class=nx>onPointerUp</span><span class=o>=</span><span class=p>{</span><span class=nx>handlePointerUp</span><span class=p>}</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>100</span><span class=p>,</span>
<span class=w>                </span><span class=nx>cursor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;grab&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=nx>color</span><span class=p>,</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>border</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;1px solid black&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>display</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;flex&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>justifyContent</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>alignItems</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;center&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span>
<span class=sb>          </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px,</span>
<span class=sb>          </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px</span>
<span class=sb>        )`</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>children</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/div&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Background</span><span class=p>({</span><span class=w> </span><span class=nx>position</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;</span><span class=nx>div</span>
<span class=w>            </span><span class=nx>style</span><span class=o>=</span><span class=p>{{</span>
<span class=w>                </span><span class=nx>position</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;absolute&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=nx>transform</span><span class=o>:</span><span class=w> </span><span class=sb>`translate(</span>
<span class=sb>        </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>x</span><span class=si>}</span><span class=sb>px,</span>
<span class=sb>        </span><span class=si>${</span><span class=nx>position</span><span class=p>.</span><span class=nx>y</span><span class=si>}</span><span class=sb>px</span>
<span class=sb>      )`</span><span class=p>,</span>
<span class=w>                </span><span class=nx>width</span><span class=o>:</span><span class=w> </span><span class=mf>250</span><span class=p>,</span>
<span class=w>                </span><span class=nx>height</span><span class=o>:</span><span class=w> </span><span class=mf>250</span><span class=p>,</span>
<span class=w>                </span><span class=nx>backgroundColor</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;rgba(200, 200, 0, 0.2)&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=p>}}</span>
<span class=w>        </span><span class=o>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>height</span><span class=p>:</span><span class=w> </span><span class=mi>280</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>select</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>10</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;dependencies&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;immer&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.7.3&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;react&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;react-dom&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;react-scripts&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;latest&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;use-immer&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;0.5.1&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=nt>&quot;scripts&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;start&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts start&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;build&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts build&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;test&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts test --env=jsdom&quot;</span><span class=p>,</span>
<span class=w>        </span><span class=nt>&quot;eject&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;react-scripts eject&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p></solution></p> <p></challenges></p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 28, 2023 08:11:22">August 28, 2023</span> </small> </div> <div class=md-source-date> <small> Authors: <span class="git-page-authors git-authors"><a href=mailto:16909269+archmonger@users.noreply.github.com>Archmonger</a></span> </small> </div> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy;<div id=year> </div> <script> document.getElementById("year").innerHTML = new Date().getFullYear(); </script>Reactive Python and affiliates.<div class=legal-footer-right>This project has no affiliation to ReactJS or Meta Platforms, Inc.</div> </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "content.code.copy", "search.highlight"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.4e0fa4ba.min.js></script> <script src=../../assets/js/main.js></script> </body> </html>