<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="It's React, but in Python."><meta name=author content=Archmonger><link href=https://reactive-python.github.io/reactpy/learn/synchronizing-with-effects/ rel=canonical><link href=../manipulating-the-dom-with-refs/ rel=prev><link href=../you-might-not-need-an-effect/ rel=next><link rel=icon href=https://raw.githubusercontent.com/reactive-python/reactpy/main/branding/svg/reactpy-logo-square.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.4.0"><title>Synchronizing with Effects 🚧 - ReactPy</title><link rel=stylesheet href=../../assets/stylesheets/main.9f615399.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.649f08f9.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M64 32C28.7 32 0 60.7 0 96v320c0 35.3 28.7 64 64 64h224V368c0-26.5 21.5-48 48-48h112V96c0-35.3-28.7-64-64-64H64zm384 320H336c-8.8 0-16 7.2-16 16v112l32-32 64-64 32-32z"/></svg>');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><link rel=stylesheet href=../../assets/css/main.css><link rel=stylesheet href=../../assets/css/button.css><link rel=stylesheet href=../../assets/css/admonition.css><link rel=stylesheet href=../../assets/css/banner.css><link rel=stylesheet href=../../assets/css/sidebar.css><link rel=stylesheet href=../../assets/css/navbar.css><link rel=stylesheet href=../../assets/css/table-of-contents.css><link rel=stylesheet href=../../assets/css/code.css><link rel=stylesheet href=../../assets/css/footer.css><link rel=stylesheet href=../../assets/css/home.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#overview class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest release. <a href=../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=ReactPy class="md-header__button md-logo" aria-label=ReactPy data-md-component=logo> <img src=https://raw.githubusercontent.com/reactive-python/reactpy/main/branding/svg/reactpy-logo-square.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> ReactPy </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Synchronizing with Effects 🚧 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=red data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81 1.42-1.42M1 13h3v-2H1m12 9h-2v3h2"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=white data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/reactive-python/reactpy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ReactPy </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../quick-start/ class=md-tabs__link> Get Started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../your-first-component/ class=md-tabs__link> Learn </a> </li> <li class=md-tabs__item> <a href=../../reference/overview/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../about/changelog/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=ReactPy class="md-nav__button md-logo" aria-label=ReactPy data-md-component=logo> <img src=https://raw.githubusercontent.com/reactive-python/reactpy/main/branding/svg/reactpy-logo-square.svg alt=logo> </a> ReactPy </label> <div class=md-nav__source> <a href=https://github.com/reactive-python/reactpy title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> ReactPy </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Get Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Get Started </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> Quick Start </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> Quick Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick start </span> </a> </li> <li class=md-nav__item> <a href=../tutorial-tic-tac-toe/ class=md-nav__link> <span class=md-ellipsis> Tutorial: Tic-Tac-Toe 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../thinking-in-react/ class=md-nav__link> <span class=md-ellipsis> Thinking in React </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Installation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Installation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../creating-a-react-app/ class=md-nav__link> <span class=md-ellipsis> Creating a Standalone React App </span> </a> </li> <li class=md-nav__item> <a href=../add-react-to-an-existing-project/ class=md-nav__link> <span class=md-ellipsis> Add React to an Existing Project </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Setup </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Setup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../editor-setup/ class=md-nav__link> <span class=md-ellipsis> Editor Setup </span> </a> </li> <li class=md-nav__item> <a href=../extra-tools-and-packages/ class=md-nav__link> <span class=md-ellipsis> Tools, Modules, and Packages 🚧 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Learn </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Learn </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Describing the UI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Describing the UI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../your-first-component/ class=md-nav__link> <span class=md-ellipsis> Your First Component 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../importing-and-exporting-components/ class=md-nav__link> <span class=md-ellipsis> Importing and Exporting Components 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../passing-props-to-a-component/ class=md-nav__link> <span class=md-ellipsis> Passing Props to a Component 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../conditional-rendering/ class=md-nav__link> <span class=md-ellipsis> Conditional Rendering 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../rendering-lists/ class=md-nav__link> <span class=md-ellipsis> Rendering Lists 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../keeping-components-pure/ class=md-nav__link> <span class=md-ellipsis> Keeping Components Pure 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Adding Interactivity </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Adding Interactivity </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../responding-to-events/ class=md-nav__link> <span class=md-ellipsis> Responding to Events 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../state-a-components-memory/ class=md-nav__link> <span class=md-ellipsis> State: A Component's Memory 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../render-and-commit/ class=md-nav__link> <span class=md-ellipsis> Render and Commit 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../state-as-a-snapshot/ class=md-nav__link> <span class=md-ellipsis> State as a Snapshot 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../queueing-a-series-of-state-updates/ class=md-nav__link> <span class=md-ellipsis> Queueing a Series of State Updates 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../updating-objects-in-state/ class=md-nav__link> <span class=md-ellipsis> Updating Objects in State 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../updating-arrays-in-state/ class=md-nav__link> <span class=md-ellipsis> Updating Arrays in State 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> Managing State </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Managing State </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reacting-to-input-with-state/ class=md-nav__link> <span class=md-ellipsis> Reacting to Input with State 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../choosing-the-state-structure/ class=md-nav__link> <span class=md-ellipsis> Choosing the State Structure 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../sharing-state-between-components/ class=md-nav__link> <span class=md-ellipsis> Sharing State Between Components 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../preserving-and-resetting-state/ class=md-nav__link> <span class=md-ellipsis> Preserving and Resetting State 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../extracting-state-logic-into-a-reducer/ class=md-nav__link> <span class=md-ellipsis> Extracting State Logic into a Reducer 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../passing-data-deeply-with-context/ class=md-nav__link> <span class=md-ellipsis> Passing Data Deeply with Context 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../scaling-up-with-reducer-and-context/ class=md-nav__link> <span class=md-ellipsis> Scaling Up with Reducer and Context 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4 checked> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> Escape Hatches </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=true> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Escape Hatches </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../referencing-values-with-refs/ class=md-nav__link> <span class=md-ellipsis> Referencing Values with Refs 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../manipulating-the-dom-with-refs/ class=md-nav__link> <span class=md-ellipsis> Manipulating the DOM with Refs 🚧 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Synchronizing with Effects 🚧 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Synchronizing with Effects 🚧 </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#what-are-effects-and-how-are-they-different-from-events class=md-nav__link> What are Effects and how are they different from events? </a> </li> <li class=md-nav__item> <a href=#you-might-not-need-an-effect class=md-nav__link> You might not need an Effect </a> </li> <li class=md-nav__item> <a href=#how-to-write-an-effect class=md-nav__link> How to write an Effect </a> <nav class=md-nav aria-label="How to write an Effect"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-declare-an-effect class=md-nav__link> Step 1: Declare an Effect </a> </li> <li class=md-nav__item> <a href=#step-2-specify-the-effect-dependencies class=md-nav__link> Step 2: Specify the Effect dependencies </a> <nav class=md-nav aria-label="Step 2: Specify the Effect dependencies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#why-was-the-ref-omitted-from-the-dependency-array class=md-nav__link> Why was the ref omitted from the dependency array? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-3-add-cleanup-if-needed class=md-nav__link> Step 3: Add cleanup if needed </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#how-to-handle-the-effect-firing-twice-in-development class=md-nav__link> How to handle the Effect firing twice in development? </a> <nav class=md-nav aria-label="How to handle the Effect firing twice in development?"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#controlling-non-react-widgets class=md-nav__link> Controlling non-React widgets </a> </li> <li class=md-nav__item> <a href=#subscribing-to-events class=md-nav__link> Subscribing to events </a> </li> <li class=md-nav__item> <a href=#triggering-animations class=md-nav__link> Triggering animations </a> </li> <li class=md-nav__item> <a href=#fetching-data class=md-nav__link> Fetching data </a> <nav class=md-nav aria-label="Fetching data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-are-good-alternatives-to-data-fetching-in-effects class=md-nav__link> What are good alternatives to data fetching in Effects? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sending-analytics class=md-nav__link> Sending analytics </a> </li> <li class=md-nav__item> <a href=#not-an-effect-initializing-the-application class=md-nav__link> Not an Effect: Initializing the application </a> </li> <li class=md-nav__item> <a href=#not-an-effect-buying-a-product class=md-nav__link> Not an Effect: Buying a product </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#putting-it-all-together class=md-nav__link> Putting it all together </a> <nav class=md-nav aria-label="Putting it all together"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#each-render-has-its-own-effects class=md-nav__link> Each render has its own Effects </a> </li> <li class=md-nav__item> <a href=#initial-render class=md-nav__link> Initial render </a> </li> <li class=md-nav__item> <a href=#re-render-with-same-dependencies class=md-nav__link> Re-render with same dependencies </a> </li> <li class=md-nav__item> <a href=#re-render-with-different-dependencies class=md-nav__link> Re-render with different dependencies </a> </li> <li class=md-nav__item> <a href=#unmount class=md-nav__link> Unmount </a> </li> <li class=md-nav__item> <a href=#development-only-behaviors class=md-nav__link> Development-only behaviors </a> </li> <li class=md-nav__item> <a href=#focus-a-field-on-mount class=md-nav__link> Focus a field on mount </a> </li> <li class=md-nav__item> <a href=#focus-a-field-conditionally class=md-nav__link> Focus a field conditionally </a> </li> <li class=md-nav__item> <a href=#fix-an-interval-that-fires-twice class=md-nav__link> Fix an interval that fires twice </a> </li> <li class=md-nav__item> <a href=#fix-fetching-inside-an-effect class=md-nav__link> Fix fetching inside an Effect </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../you-might-not-need-an-effect/ class=md-nav__link> <span class=md-ellipsis> You Might Not Need an Effect 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../lifecycle-of-reactive-effects/ class=md-nav__link> <span class=md-ellipsis> Lifecycle of Reactive Effects 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../separating-events-from-effects/ class=md-nav__link> <span class=md-ellipsis> Separating Events from Effects 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../removing-effect-dependencies/ class=md-nav__link> <span class=md-ellipsis> Removing Effect Dependencies 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../reusing-logic-with-custom-hooks/ class=md-nav__link> <span class=md-ellipsis> Reusing Logic with Custom Hooks 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../communicate-data-between-server-and-client/ class=md-nav__link> <span class=md-ellipsis> Communicating Data Between Server and Client 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../convert-between-vdom-and-html/ class=md-nav__link> <span class=md-ellipsis> Convert Between VDOM and HTML 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../vdom-mutations/ class=md-nav__link> <span class=md-ellipsis> VDOM Mutations 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../creating-vdom-event-handlers/ class=md-nav__link> <span class=md-ellipsis> Creating VDOM Event Handlers 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../creating-html-tags/ class=md-nav__link> <span class=md-ellipsis> Creating HTML Tags 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../creating-backends/ class=md-nav__link> <span class=md-ellipsis> Creating Backends 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../manually-register-a-client/ class=md-nav__link> <span class=md-ellipsis> Manually Register a Client 🚧 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Hooks </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Hooks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/use-state/ class=md-nav__link> <span class=md-ellipsis> Use State 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-effect/ class=md-nav__link> <span class=md-ellipsis> Use Effect 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-async-effect/ class=md-nav__link> <span class=md-ellipsis> Use Async Effect 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-context/ class=md-nav__link> <span class=md-ellipsis> Use Context 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-reducer/ class=md-nav__link> <span class=md-ellipsis> Use Reducer 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-callback/ class=md-nav__link> <span class=md-ellipsis> Use Callback 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-memo/ class=md-nav__link> <span class=md-ellipsis> Use Memo 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-ref/ class=md-nav__link> <span class=md-ellipsis> Use Ref 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-debug-value/ class=md-nav__link> <span class=md-ellipsis> Use Debug Value 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-connection/ class=md-nav__link> <span class=md-ellipsis> Use Connection 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-scope/ class=md-nav__link> <span class=md-ellipsis> Use Scope 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/use-location/ class=md-nav__link> <span class=md-ellipsis> Use Location 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> HTML Tags </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> HTML Tags </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/common-props/ class=md-nav__link> <span class=md-ellipsis> Common Props 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/usage/ class=md-nav__link> <span class=md-ellipsis> Usage 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> Executors </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Executors </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/reactpy/ class=md-nav__link> <span class=md-ellipsis> ReactPy </span> </a> </li> <li class=md-nav__item> <a href=../../reference/reactpy-csr/ class=md-nav__link> <span class=md-ellipsis> ReactPyCsr 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/reactpy-middleware/ class=md-nav__link> <span class=md-ellipsis> ReactPyMiddleware 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> Rules of React </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Rules of React </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/rules-of-react/ class=md-nav__link> <span class=md-ellipsis> Overview 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/components-and-hooks-must-be-pure/ class=md-nav__link> <span class=md-ellipsis> Components and Hooks must be pure 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/react-calls-components-and-hooks/ class=md-nav__link> <span class=md-ellipsis> React calls Components and Hooks 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/rules-of-hooks/ class=md-nav__link> <span class=md-ellipsis> Rules of Hooks 🚧 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../reference/protocol-structure/ class=md-nav__link> <span class=md-ellipsis> Protocol Structure 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../reference/client-api/ class=md-nav__link> <span class=md-ellipsis> Client API 🚧 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> About </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/community/ class=md-nav__link> <span class=md-ellipsis> Community 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/running-tests/ class=md-nav__link> <span class=md-ellipsis> Running Tests 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/code/ class=md-nav__link> <span class=md-ellipsis> Contributing Code 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/docs/ class=md-nav__link> <span class=md-ellipsis> Contributing Documentation 🚧 </span> </a> </li> <li class=md-nav__item> <a href=../../about/licenses/ class=md-nav__link> <span class=md-ellipsis> Licenses 🚧 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=#what-are-effects-and-how-are-they-different-from-events class=md-nav__link> What are Effects and how are they different from events? </a> </li> <li class=md-nav__item> <a href=#you-might-not-need-an-effect class=md-nav__link> You might not need an Effect </a> </li> <li class=md-nav__item> <a href=#how-to-write-an-effect class=md-nav__link> How to write an Effect </a> <nav class=md-nav aria-label="How to write an Effect"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-declare-an-effect class=md-nav__link> Step 1: Declare an Effect </a> </li> <li class=md-nav__item> <a href=#step-2-specify-the-effect-dependencies class=md-nav__link> Step 2: Specify the Effect dependencies </a> <nav class=md-nav aria-label="Step 2: Specify the Effect dependencies"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#why-was-the-ref-omitted-from-the-dependency-array class=md-nav__link> Why was the ref omitted from the dependency array? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-3-add-cleanup-if-needed class=md-nav__link> Step 3: Add cleanup if needed </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#how-to-handle-the-effect-firing-twice-in-development class=md-nav__link> How to handle the Effect firing twice in development? </a> <nav class=md-nav aria-label="How to handle the Effect firing twice in development?"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#controlling-non-react-widgets class=md-nav__link> Controlling non-React widgets </a> </li> <li class=md-nav__item> <a href=#subscribing-to-events class=md-nav__link> Subscribing to events </a> </li> <li class=md-nav__item> <a href=#triggering-animations class=md-nav__link> Triggering animations </a> </li> <li class=md-nav__item> <a href=#fetching-data class=md-nav__link> Fetching data </a> <nav class=md-nav aria-label="Fetching data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-are-good-alternatives-to-data-fetching-in-effects class=md-nav__link> What are good alternatives to data fetching in Effects? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sending-analytics class=md-nav__link> Sending analytics </a> </li> <li class=md-nav__item> <a href=#not-an-effect-initializing-the-application class=md-nav__link> Not an Effect: Initializing the application </a> </li> <li class=md-nav__item> <a href=#not-an-effect-buying-a-product class=md-nav__link> Not an Effect: Buying a product </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#putting-it-all-together class=md-nav__link> Putting it all together </a> <nav class=md-nav aria-label="Putting it all together"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#each-render-has-its-own-effects class=md-nav__link> Each render has its own Effects </a> </li> <li class=md-nav__item> <a href=#initial-render class=md-nav__link> Initial render </a> </li> <li class=md-nav__item> <a href=#re-render-with-same-dependencies class=md-nav__link> Re-render with same dependencies </a> </li> <li class=md-nav__item> <a href=#re-render-with-different-dependencies class=md-nav__link> Re-render with different dependencies </a> </li> <li class=md-nav__item> <a href=#unmount class=md-nav__link> Unmount </a> </li> <li class=md-nav__item> <a href=#development-only-behaviors class=md-nav__link> Development-only behaviors </a> </li> <li class=md-nav__item> <a href=#focus-a-field-on-mount class=md-nav__link> Focus a field on mount </a> </li> <li class=md-nav__item> <a href=#focus-a-field-conditionally class=md-nav__link> Focus a field conditionally </a> </li> <li class=md-nav__item> <a href=#fix-an-interval-that-fires-twice class=md-nav__link> Fix an interval that fires twice </a> </li> <li class=md-nav__item> <a href=#fix-fetching-inside-an-effect class=md-nav__link> Fix fetching inside an Effect </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Synchronizing with Effects 🚧</h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p class=intro> Some components need to synchronize with external systems. For example, you might want to control a non-React component based on the React state, set up a server connection, or send an analytics log when a component appears on the screen. <em>Effects</em> let you run some code after rendering so that you can synchronize your component with some system outside of React. </p> <div class="admonition summary"> <p class=admonition-title>You will learn</p> <ul> <li>What Effects are</li> <li>How Effects are different from events</li> <li>How to declare an Effect in your component</li> <li>How to skip re-running an Effect unnecessarily</li> <li>Why Effects run twice in development and how to fix them</li> </ul> </div> <h2 id=what-are-effects-and-how-are-they-different-from-events>What are Effects and how are they different from events?<a class=headerlink href=#what-are-effects-and-how-are-they-different-from-events title="Permanent link">&para;</a></h2> <p>Before getting to Effects, you need to be familiar with two types of logic inside React components:</p> <ul> <li> <p><strong>Rendering code</strong> (introduced in <a href=/learn/describing-the-ui>Describing the UI</a>) lives at the top level of your component. This is where you take the props and state, transform them, and return the JSX you want to see on the screen. <a href=/learn/keeping-components-pure>Rendering code must be pure.</a> Like a math formula, it should only <em>calculate</em> the result, but not do anything else.</p> </li> <li> <p><strong>Event handlers</strong> (introduced in <a href=/learn/adding-interactivity>Adding Interactivity</a>) are nested functions inside your components that <em>do</em> things rather than just calculate them. An event handler might update an input field, submit an HTTP POST request to buy a product, or navigate the user to another screen. Event handlers contain <a href=https://en.wikipedia.org/wiki/Side_effect_(computer_science)>"side effects"</a> (they change the program's state) caused by a specific user action (for example, a button click or typing).</p> </li> </ul> <p>Sometimes this isn't enough. Consider a <code>ChatRoom</code> component that must connect to the chat server whenever it's visible on the screen. Connecting to a server is not a pure calculation (it's a side effect) so it can't happen during rendering. However, there is no single particular event like a click that causes <code>ChatRoom</code> to be displayed.</p> <p><strong><em>Effects</em> let you specify side effects that are caused by rendering itself, rather than by a particular event.</strong> Sending a message in the chat is an <em>event</em> because it is directly caused by the user clicking a specific button. However, setting up a server connection is an <em>Effect</em> because it should happen no matter which interaction caused the component to appear. Effects run at the end of a <a href=/learn/render-and-commit>commit</a> after the screen updates. This is a good time to synchronize the React components with some external system (like network or a third-party library).</p> <p><note></p> <p>Here and later in this text, capitalized "Effect" refers to the React-specific definition above, i.e. a side effect caused by rendering. To refer to the broader programming concept, we'll say "side effect".</p> <p></note></p> <h2 id=you-might-not-need-an-effect>You might not need an Effect<a class=headerlink href=#you-might-not-need-an-effect title="Permanent link">&para;</a></h2> <p><strong>Don't rush to add Effects to your components.</strong> Keep in mind that Effects are typically used to "step out" of your React code and synchronize with some <em>external</em> system. This includes browser APIs, third-party widgets, network, and so on. If your Effect only adjusts some state based on other state, <a href=/learn/you-might-not-need-an-effect>you might not need an Effect.</a></p> <h2 id=how-to-write-an-effect>How to write an Effect<a class=headerlink href=#how-to-write-an-effect title="Permanent link">&para;</a></h2> <p>To write an Effect, follow these three steps:</p> <ol> <li><strong>Declare an Effect.</strong> By default, your Effect will run after every render.</li> <li><strong>Specify the Effect dependencies.</strong> Most Effects should only re-run <em>when needed</em> rather than after every render. For example, a fade-in animation should only trigger when a component appears. Connecting and disconnecting to a chat room should only happen when the component appears and disappears, or when the chat room changes. You will learn how to control this by specifying <em>dependencies.</em></li> <li><strong>Add cleanup if needed.</strong> Some Effects need to specify how to stop, undo, or clean up whatever they were doing. For example, "connect" needs "disconnect", "subscribe" needs "unsubscribe", and "fetch" needs either "cancel" or "ignore". You will learn how to do this by returning a <em>cleanup function</em>.</li> </ol> <p>Let's look at each of these steps in detail.</p> <h3 id=step-1-declare-an-effect>Step 1: Declare an Effect<a class=headerlink href=#step-1-declare-an-effect title="Permanent link">&para;</a></h3> <p>To declare an Effect in your component, import the <a href=/reference/react/useEffect><code>useEffect</code> Hook</a> from React:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
</code></pre></div></td></tr></table></div> <p>Then, call it at the top level of your component and put some code inside your Effect:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>MyComponent</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// Code here will run after *every* render</span>
<span class=w>    </span><span class=p>});</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>div</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Every time your component renders, React will update the screen <em>and then</em> run the code inside <code>useEffect</code>. In other words, <strong><code>useEffect</code> "delays" a piece of code from running until that render is reflected on the screen.</strong></p> <p>Let's see how you can use an Effect to synchronize with an external system. Consider a <code>&lt;VideoPlayer&gt;</code> React component. It would be nice to control whether it's playing or paused by passing an <code>isPlaying</code> prop to it:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code><span class=o>&lt;</span><span class=nx>VideoPlayer</span><span class=w> </span><span class=nx>isPlaying</span><span class=o>=</span><span class=p>{</span><span class=nx>isPlaying</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span>
</code></pre></div></td></tr></table></div> <p>Your custom <code>VideoPlayer</code> component renders the built-in browser <a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video><code>&lt;video&gt;</code></a> tag:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>VideoPlayer</span><span class=p>({</span><span class=w> </span><span class=nx>src</span><span class=p>,</span><span class=w> </span><span class=nx>isPlaying</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// TODO: do something with isPlaying</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>video</span><span class=w> </span><span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>src</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>However, the browser <code>&lt;video&gt;</code> tag does not have an <code>isPlaying</code> prop. The only way to control it is to manually call the <a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/play><code>play()</code></a> and <a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/pause><code>pause()</code></a> methods on the DOM element. <strong>You need to synchronize the value of <code>isPlaying</code> prop, which tells whether the video <em>should</em> currently be playing, with calls like <code>play()</code> and <code>pause()</code>.</strong></p> <p>We'll need to first <a href=/learn/manipulating-the-dom-with-refs>get a ref</a> to the <code>&lt;video&gt;</code> DOM node.</p> <p>You might be tempted to try to call <code>play()</code> or <code>pause()</code> during rendering, but that isn't correct:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>VideoPlayer</span><span class=p>({</span><span class=w> </span><span class=nx>src</span><span class=p>,</span><span class=w> </span><span class=nx>isPlaying</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isPlaying</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>play</span><span class=p>();</span><span class=w> </span><span class=c1>// Calling these while rendering isn&#39;t allowed.</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>pause</span><span class=p>();</span><span class=w> </span><span class=c1>// Also, this crashes.</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>video</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>src</span><span class=p>}</span><span class=w> </span><span class=nx>loop</span><span class=w> </span><span class=nx>playsInline</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>isPlaying</span><span class=p>,</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>(</span><span class=o>!</span><span class=nx>isPlaying</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>isPlaying</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Pause&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Play&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>VideoPlayer</span>
<span class=w>                </span><span class=nx>isPlaying</span><span class=o>=</span><span class=p>{</span><span class=nx>isPlaying</span><span class=p>}</span>
<span class=w>                </span><span class=nx>src</span><span class=o>=</span><span class=s2>&quot;https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4&quot;</span>
<span class=w>            </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>video</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>width</span><span class=p>:</span><span class=w> </span><span class=mi>250</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>The reason this code isn't correct is that it tries to do something with the DOM node during rendering. In React, <a href=/learn/keeping-components-pure>rendering should be a pure calculation</a> of JSX and should not contain side effects like modifying the DOM.</p> <p>Moreover, when <code>VideoPlayer</code> is called for the first time, its DOM does not exist yet! There isn't a DOM node yet to call <code>play()</code> or <code>pause()</code> on, because React doesn't know what DOM to create until you return the JSX.</p> <p>The solution here is to <strong>wrap the side effect with <code>useEffect</code> to move it out of the rendering calculation:</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>VideoPlayer</span><span class=p>({</span><span class=w> </span><span class=nx>src</span><span class=p>,</span><span class=w> </span><span class=nx>isPlaying</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isPlaying</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>play</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>pause</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>video</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>src</span><span class=p>}</span><span class=w> </span><span class=nx>loop</span><span class=w> </span><span class=nx>playsInline</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>By wrapping the DOM update in an Effect, you let React update the screen first. Then your Effect runs.</p> <p>When your <code>VideoPlayer</code> component renders (either the first time or if it re-renders), a few things will happen. First, React will update the screen, ensuring the <code>&lt;video&gt;</code> tag is in the DOM with the right props. Then React will run your Effect. Finally, your Effect will call <code>play()</code> or <code>pause()</code> depending on the value of <code>isPlaying</code>.</p> <p>Press Play/Pause multiple times and see how the video player stays synchronized to the <code>isPlaying</code> value:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>VideoPlayer</span><span class=p>({</span><span class=w> </span><span class=nx>src</span><span class=p>,</span><span class=w> </span><span class=nx>isPlaying</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isPlaying</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>play</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>pause</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>video</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>src</span><span class=p>}</span><span class=w> </span><span class=nx>loop</span><span class=w> </span><span class=nx>playsInline</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>isPlaying</span><span class=p>,</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>(</span><span class=o>!</span><span class=nx>isPlaying</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>isPlaying</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Pause&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Play&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>VideoPlayer</span>
<span class=w>                </span><span class=nx>isPlaying</span><span class=o>=</span><span class=p>{</span><span class=nx>isPlaying</span><span class=p>}</span>
<span class=w>                </span><span class=nx>src</span><span class=o>=</span><span class=s2>&quot;https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4&quot;</span>
<span class=w>            </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>video</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>width</span><span class=p>:</span><span class=w> </span><span class=mi>250</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>In this example, the "external system" you synchronized to React state was the browser media API. You can use a similar approach to wrap legacy non-React code (like jQuery plugins) into declarative React components.</p> <p>Note that controlling a video player is much more complex in practice. Calling <code>play()</code> may fail, the user might play or pause using the built-in browser controls, and so on. This example is very simplified and incomplete.</p> <p><pitfall></p> <p>By default, Effects run after <em>every</em> render. This is why code like this will <strong>produce an infinite loop:</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>count</span><span class=p>,</span><span class=w> </span><span class=nx>setCount</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>
<span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>setCount</span><span class=p>(</span><span class=nx>count</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div></td></tr></table></div> <p>Effects run as a <em>result</em> of rendering. Setting state <em>triggers</em> rendering. Setting state immediately in an Effect is like plugging a power outlet into itself. The Effect runs, it sets the state, which causes a re-render, which causes the Effect to run, it sets the state again, this causes another re-render, and so on.</p> <p>Effects should usually synchronize your components with an <em>external</em> system. If there's no external system and you only want to adjust some state based on other state, <a href=/learn/you-might-not-need-an-effect>you might not need an Effect.</a></p> <p></pitfall></p> <h3 id=step-2-specify-the-effect-dependencies>Step 2: Specify the Effect dependencies<a class=headerlink href=#step-2-specify-the-effect-dependencies title="Permanent link">&para;</a></h3> <p>By default, Effects run after <em>every</em> render. Often, this is <strong>not what you want:</strong></p> <ul> <li>Sometimes, it's slow. Synchronizing with an external system is not always instant, so you might want to skip doing it unless it's necessary. For example, you don't want to reconnect to the chat server on every keystroke.</li> <li>Sometimes, it's wrong. For example, you don't want to trigger a component fade-in animation on every keystroke. The animation should only play once when the component appears for the first time.</li> </ul> <p>To demonstrate the issue, here is the previous example with a few <code>console.log</code> calls and a text input that updates the parent component's state. Notice how typing causes the Effect to re-run:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>VideoPlayer</span><span class=p>({</span><span class=w> </span><span class=nx>src</span><span class=p>,</span><span class=w> </span><span class=nx>isPlaying</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isPlaying</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;Calling video.play()&quot;</span><span class=p>);</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>play</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;Calling video.pause()&quot;</span><span class=p>);</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>pause</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>});</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>video</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>src</span><span class=p>}</span><span class=w> </span><span class=nx>loop</span><span class=w> </span><span class=nx>playsInline</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>isPlaying</span><span class=p>,</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>text</span><span class=p>,</span><span class=w> </span><span class=nx>setText</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>text</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setText</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>(</span><span class=o>!</span><span class=nx>isPlaying</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>isPlaying</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Pause&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Play&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>VideoPlayer</span>
<span class=w>                </span><span class=nx>isPlaying</span><span class=o>=</span><span class=p>{</span><span class=nx>isPlaying</span><span class=p>}</span>
<span class=w>                </span><span class=nx>src</span><span class=o>=</span><span class=s2>&quot;https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4&quot;</span>
<span class=w>            </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=o>,</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>video</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>width</span><span class=p>:</span><span class=w> </span><span class=mi>250</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>You can tell React to <strong>skip unnecessarily re-running the Effect</strong> by specifying an array of <em>dependencies</em> as the second argument to the <code>useEffect</code> call. Start by adding an empty <code>[]</code> array to the above example on line 14:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</code></pre></div></td></tr></table></div> <p>You should see an error saying <code>React Hook useEffect has a missing dependency: 'isPlaying'</code>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>VideoPlayer</span><span class=p>({</span><span class=w> </span><span class=nx>src</span><span class=p>,</span><span class=w> </span><span class=nx>isPlaying</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isPlaying</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;Calling video.play()&quot;</span><span class=p>);</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>play</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;Calling video.pause()&quot;</span><span class=p>);</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>pause</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span><span class=w> </span><span class=c1>// This causes an error</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>video</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>src</span><span class=p>}</span><span class=w> </span><span class=nx>loop</span><span class=w> </span><span class=nx>playsInline</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>isPlaying</span><span class=p>,</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>text</span><span class=p>,</span><span class=w> </span><span class=nx>setText</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>text</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setText</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>(</span><span class=o>!</span><span class=nx>isPlaying</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>isPlaying</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Pause&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Play&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>VideoPlayer</span>
<span class=w>                </span><span class=nx>isPlaying</span><span class=o>=</span><span class=p>{</span><span class=nx>isPlaying</span><span class=p>}</span>
<span class=w>                </span><span class=nx>src</span><span class=o>=</span><span class=s2>&quot;https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4&quot;</span>
<span class=w>            </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=o>,</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>video</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>width</span><span class=p>:</span><span class=w> </span><span class=mi>250</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>The problem is that the code inside of your Effect <em>depends on</em> the <code>isPlaying</code> prop to decide what to do, but this dependency was not explicitly declared. To fix this issue, add <code>isPlaying</code> to the dependency array:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isPlaying</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// It&#39;s used here...</span>
<span class=w>        </span><span class=c1>// ...</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=c1>// ...</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>isPlaying</span><span class=p>]);</span><span class=w> </span><span class=c1>// ...so it must be declared here!</span>
</code></pre></div></td></tr></table></div> <p>Now all dependencies are declared, so there is no error. Specifying <code>[isPlaying]</code> as the dependency array tells React that it should skip re-running your Effect if <code>isPlaying</code> is the same as it was during the previous render. With this change, typing into the input doesn't cause the Effect to re-run, but pressing Play/Pause does:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>VideoPlayer</span><span class=p>({</span><span class=w> </span><span class=nx>src</span><span class=p>,</span><span class=w> </span><span class=nx>isPlaying</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isPlaying</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;Calling video.play()&quot;</span><span class=p>);</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>play</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;Calling video.pause()&quot;</span><span class=p>);</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>pause</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>isPlaying</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>video</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>src</span><span class=o>=</span><span class=p>{</span><span class=nx>src</span><span class=p>}</span><span class=w> </span><span class=nx>loop</span><span class=w> </span><span class=nx>playsInline</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>isPlaying</span><span class=p>,</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>text</span><span class=p>,</span><span class=w> </span><span class=nx>setText</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>text</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setText</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setIsPlaying</span><span class=p>(</span><span class=o>!</span><span class=nx>isPlaying</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>isPlaying</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Pause&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Play&quot;</span><span class=p>}</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>VideoPlayer</span>
<span class=w>                </span><span class=nx>isPlaying</span><span class=o>=</span><span class=p>{</span><span class=nx>isPlaying</span><span class=p>}</span>
<span class=w>                </span><span class=nx>src</span><span class=o>=</span><span class=s2>&quot;https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4&quot;</span>
<span class=w>            </span><span class=o>/&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=o>,</span>
<span class=nt>button</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
<span class=nt>video</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>width</span><span class=p>:</span><span class=w> </span><span class=mi>250</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>The dependency array can contain multiple dependencies. React will only skip re-running the Effect if <em>all</em> of the dependencies you specify have exactly the same values as they had during the previous render. React compares the dependency values using the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is><code>Object.is</code></a> comparison. See the <a href=/reference/react/useEffect#reference><code>useEffect</code> reference</a> for details.</p> <p><strong>Notice that you can't "choose" your dependencies.</strong> You will get a lint error if the dependencies you specified don't match what React expects based on the code inside your Effect. This helps catch many bugs in your code. If you don't want some code to re-run, <a href=/learn/lifecycle-of-reactive-effects#what-to-do-when-you-dont-want-to-re-synchronize><em>edit the Effect code itself</em> to not "need" that dependency.</a></p> <p><pitfall></p> <p>The behaviors without the dependency array and with an <em>empty</em> <code>[]</code> dependency array are different:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// This runs after every render</span>
<span class=p>});</span>

<span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// This runs only on mount (when the component appears)</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// This runs on mount *and also* if either a or b have changed since the last render</span>
<span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>a</span><span class=p>,</span><span class=w> </span><span class=nx>b</span><span class=p>]);</span>
</code></pre></div></td></tr></table></div> <p>We'll take a close look at what "mount" means in the next step.</p> <p></pitfall></p> <p><deepdive></p> <h4 id=why-was-the-ref-omitted-from-the-dependency-array>Why was the ref omitted from the dependency array?<a class=headerlink href=#why-was-the-ref-omitted-from-the-dependency-array title="Permanent link">&para;</a></h4> <p>This Effect uses <em>both</em> <code>ref</code> and <code>isPlaying</code>, but only <code>isPlaying</code> is declared as a dependency:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>VideoPlayer</span><span class=p>({</span><span class=w> </span><span class=nx>src</span><span class=p>,</span><span class=w> </span><span class=nx>isPlaying</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>  </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isPlaying</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>play</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>pause</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>isPlaying</span><span class=p>]);</span>
</code></pre></div></td></tr></table></div> <p>This is because the <code>ref</code> object has a <em>stable identity:</em> React guarantees <a href=/reference/react/useRef#returns>you'll always get the same object</a> from the same <code>useRef</code> call on every render. It never changes, so it will never by itself cause the Effect to re-run. Therefore, it does not matter whether you include it or not. Including it is fine too:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>VideoPlayer</span><span class=p>({</span><span class=w> </span><span class=nx>src</span><span class=p>,</span><span class=w> </span><span class=nx>isPlaying</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>  </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>isPlaying</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>play</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
<span class=w>      </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>pause</span><span class=p>();</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>isPlaying</span><span class=p>,</span><span class=w> </span><span class=nx>ref</span><span class=p>]);</span>
</code></pre></div></td></tr></table></div> <p>The <a href=/reference/react/useState#setstate><code>set</code> functions</a> returned by <code>useState</code> also have stable identity, so you will often see them omitted from the dependencies too. If the linter lets you omit a dependency without errors, it is safe to do.</p> <p>Omitting always-stable dependencies only works when the linter can "see" that the object is stable. For example, if <code>ref</code> was passed from a parent component, you would have to specify it in the dependency array. However, this is good because you can't know whether the parent component always passes the same ref, or passes one of several refs conditionally. So your Effect <em>would</em> depend on which ref is passed.</p> <p></deepdive></p> <h3 id=step-3-add-cleanup-if-needed>Step 3: Add cleanup if needed<a class=headerlink href=#step-3-add-cleanup-if-needed title="Permanent link">&para;</a></h3> <p>Consider a different example. You're writing a <code>ChatRoom</code> component that needs to connect to the chat server when it appears. You are given a <code>createConnection()</code> API that returns an object with <code>connect()</code> and <code>disconnect()</code> methods. How do you keep the component connected while it is displayed to the user?</p> <p>Start by writing the Effect logic:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>();</span>
<span class=w>    </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=p>});</span>
</code></pre></div></td></tr></table></div> <p>It would be slow to connect to the chat after every re-render, so you add the dependency array:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>();</span>
<span class=w>    </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</code></pre></div></td></tr></table></div> <p><strong>The code inside the Effect does not use any props or state, so your dependency array is <code>[]</code> (empty). This tells React to only run this code when the component "mounts", i.e. appears on the screen for the first time.</strong></p> <p>Let's try running this code:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>();</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>chat</span><span class=o>!&lt;</span><span class=err>/h1&gt;;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>createConnection</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// A real implementation would actually connect to the server</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;✅ Connecting...&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>disconnect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;❌ Disconnected.&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>This Effect only runs on mount, so you might expect <code>"✅ Connecting..."</code> to be printed once in the console. <strong>However, if you check the console, <code>"✅ Connecting..."</code> gets printed twice. Why does it happen?</strong></p> <p>Imagine the <code>ChatRoom</code> component is a part of a larger app with many different screens. The user starts their journey on the <code>ChatRoom</code> page. The component mounts and calls <code>connection.connect()</code>. Then imagine the user navigates to another screen--for example, to the Settings page. The <code>ChatRoom</code> component unmounts. Finally, the user clicks Back and <code>ChatRoom</code> mounts again. This would set up a second connection--but the first connection was never destroyed! As the user navigates across the app, the connections would keep piling up.</p> <p>Bugs like this are easy to miss without extensive manual testing. To help you spot them quickly, in development React remounts every component once immediately after its initial mount.</p> <p>Seeing the <code>"✅ Connecting..."</code> log twice helps you notice the real issue: your code doesn't close the connection when the component unmounts.</p> <p>To fix the issue, return a <em>cleanup function</em> from your Effect:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>();</span>
<span class=w>    </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</code></pre></div></td></tr></table></div> <p>React will call your cleanup function each time before the Effect runs again, and one final time when the component unmounts (gets removed). Let's see what happens when the cleanup function is implemented:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>createConnection</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./chat.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>();</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>chat</span><span class=o>!&lt;</span><span class=err>/h1&gt;;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>createConnection</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// A real implementation would actually connect to the server</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>connect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;✅ Connecting...&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=nx>disconnect</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;❌ Disconnected.&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>input</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Now you get three console logs in development:</p> <ol> <li><code>"✅ Connecting..."</code></li> <li><code>"❌ Disconnected."</code></li> <li><code>"✅ Connecting..."</code></li> </ol> <p><strong>This is the correct behavior in development.</strong> By remounting your component, React verifies that navigating away and back would not break your code. Disconnecting and then connecting again is exactly what should happen! When you implement the cleanup well, there should be no user-visible difference between running the Effect once vs running it, cleaning it up, and running it again. There's an extra connect/disconnect call pair because React is probing your code for bugs in development. This is normal--don't try to make it go away!</p> <p><strong>In production, you would only see <code>"✅ Connecting..."</code> printed once.</strong> Remounting components only happens in development to help you find Effects that need cleanup. You can turn off <a href=/reference/react/StrictMode>Strict Mode</a> to opt out of the development behavior, but we recommend keeping it on. This lets you find many bugs like the one above.</p> <h2 id=how-to-handle-the-effect-firing-twice-in-development>How to handle the Effect firing twice in development?<a class=headerlink href=#how-to-handle-the-effect-firing-twice-in-development title="Permanent link">&para;</a></h2> <p>React intentionally remounts your components in development to find bugs like in the last example. <strong>The right question isn't "how to run an Effect once", but "how to fix my Effect so that it works after remounting".</strong></p> <p>Usually, the answer is to implement the cleanup function. The cleanup function should stop or undo whatever the Effect was doing. The rule of thumb is that the user shouldn't be able to distinguish between the Effect running once (as in production) and a <em>setup → cleanup → setup</em> sequence (as you'd see in development).</p> <p>Most of the Effects you'll write will fit into one of the common patterns below.</p> <h3 id=controlling-non-react-widgets>Controlling non-React widgets<a class=headerlink href=#controlling-non-react-widgets title="Permanent link">&para;</a></h3> <p>Sometimes you need to add UI widgets that aren't written to React. For example, let's say you're adding a map component to your page. It has a <code>setZoomLevel()</code> method, and you'd like to keep the zoom level in sync with a <code>zoomLevel</code> state variable in your React code. Your Effect would look similar to this:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>mapRef</span><span class=p>.</span><span class=nx>current</span><span class=p>;</span>
<span class=w>    </span><span class=nx>map</span><span class=p>.</span><span class=nx>setZoomLevel</span><span class=p>(</span><span class=nx>zoomLevel</span><span class=p>);</span>
<span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>zoomLevel</span><span class=p>]);</span>
</code></pre></div></td></tr></table></div> <p>Note that there is no cleanup needed in this case. In development, React will call the Effect twice, but this is not a problem because calling <code>setZoomLevel</code> twice with the same value does not do anything. It may be slightly slower, but this doesn't matter because it won't remount needlessly in production.</p> <p>Some APIs may not allow you to call them twice in a row. For example, the <a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement/showModal><code>showModal</code></a> method of the built-in <a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement><code>&lt;dialog&gt;</code></a> element throws if you call it twice. Implement the cleanup function and make it close the dialog:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>dialog</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>dialogRef</span><span class=p>.</span><span class=nx>current</span><span class=p>;</span>
<span class=w>    </span><span class=nx>dialog</span><span class=p>.</span><span class=nx>showModal</span><span class=p>();</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>dialog</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</code></pre></div></td></tr></table></div> <p>In development, your Effect will call <code>showModal()</code>, then immediately <code>close()</code>, and then <code>showModal()</code> again. This has the same user-visible behavior as calling <code>showModal()</code> once, as you would see in production.</p> <h3 id=subscribing-to-events>Subscribing to events<a class=headerlink href=#subscribing-to-events title="Permanent link">&para;</a></h3> <p>If your Effect subscribes to something, the cleanup function should unsubscribe:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>function</span><span class=w> </span><span class=nx>handleScroll</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>scrollX</span><span class=p>,</span><span class=w> </span><span class=nb>window</span><span class=p>.</span><span class=nx>scrollY</span><span class=p>);</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>    </span><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&quot;scroll&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>handleScroll</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nb>window</span><span class=p>.</span><span class=nx>removeEventListener</span><span class=p>(</span><span class=s2>&quot;scroll&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>handleScroll</span><span class=p>);</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</code></pre></div></td></tr></table></div> <p>In development, your Effect will call <code>addEventListener()</code>, then immediately <code>removeEventListener()</code>, and then <code>addEventListener()</code> again with the same handler. So there would be only one active subscription at a time. This has the same user-visible behavior as calling <code>addEventListener()</code> once, as in production.</p> <h3 id=triggering-animations>Triggering animations<a class=headerlink href=#triggering-animations title="Permanent link">&para;</a></h3> <p>If your Effect animates something in, the cleanup function should reset the animation to the initial values:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>node</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>;</span>
<span class=w>    </span><span class=nx>node</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>opacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1</span><span class=p>;</span><span class=w> </span><span class=c1>// Trigger the animation</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>node</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>opacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0</span><span class=p>;</span><span class=w> </span><span class=c1>// Reset to the initial value</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</code></pre></div></td></tr></table></div> <p>In development, opacity will be set to <code>1</code>, then to <code>0</code>, and then to <code>1</code> again. This should have the same user-visible behavior as setting it to <code>1</code> directly, which is what would happen in production. If you use a third-party animation library with support for tweening, your cleanup function should reset the timeline to its initial state.</p> <h3 id=fetching-data>Fetching data<a class=headerlink href=#fetching-data title="Permanent link">&para;</a></h3> <p>If your Effect fetches something, the cleanup function should either <a href=https://developer.mozilla.org/en-US/docs/Web/API/AbortController>abort the fetch</a> or ignore its result:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>

<span class=w>    </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>startFetching</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=nx>fetchTodos</span><span class=p>(</span><span class=nx>userId</span><span class=p>);</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>ignore</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setTodos</span><span class=p>(</span><span class=nx>json</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=nx>startFetching</span><span class=p>();</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<span class=w>    </span><span class=p>};</span>
<span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>userId</span><span class=p>]);</span>
</code></pre></div></td></tr></table></div> <p>You can't "undo" a network request that already happened, but your cleanup function should ensure that the fetch that's <em>not relevant anymore</em> does not keep affecting your application. If the <code>userId</code> changes from <code>'Alice'</code> to <code>'Bob'</code>, cleanup ensures that the <code>'Alice'</code> response is ignored even if it arrives after <code>'Bob'</code>.</p> <p><strong>In development, you will see two fetches in the Network tab.</strong> There is nothing wrong with that. With the approach above, the first Effect will immediately get cleaned up so its copy of the <code>ignore</code> variable will be set to <code>true</code>. So even though there is an extra request, it won't affect the state thanks to the <code>if (!ignore)</code> check.</p> <p><strong>In production, there will only be one request.</strong> If the second request in development is bothering you, the best approach is to use a solution that deduplicates requests and caches their responses between components:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>TodoList</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=kd>const</span><span class=w> </span><span class=nx>todos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useSomeDataLibrary</span><span class=p>(</span><span class=sb>`/api/user/</span><span class=si>${</span><span class=nx>userId</span><span class=si>}</span><span class=sb>/todos`</span><span class=p>);</span>
<span class=w>  </span><span class=c1>// ...</span>
</code></pre></div></td></tr></table></div> <p>This will not only improve the development experience, but also make your application feel faster. For example, the user pressing the Back button won't have to wait for some data to load again because it will be cached. You can either build such a cache yourself or use one of the many alternatives to manual fetching in Effects.</p> <p><deepdive></p> <h4 id=what-are-good-alternatives-to-data-fetching-in-effects>What are good alternatives to data fetching in Effects?<a class=headerlink href=#what-are-good-alternatives-to-data-fetching-in-effects title="Permanent link">&para;</a></h4> <p>Writing <code>fetch</code> calls inside Effects is a <a href=https://www.robinwieruch.de/react-hooks-fetch-data/ >popular way to fetch data</a>, especially in fully client-side apps. This is, however, a very manual approach and it has significant downsides:</p> <ul> <li><strong>Effects don't run on the server.</strong> This means that the initial server-rendered HTML will only include a loading state with no data. The client computer will have to download all JavaScript and render your app only to discover that now it needs to load the data. This is not very efficient.</li> <li><strong>Fetching directly in Effects makes it easy to create "network waterfalls".</strong> You render the parent component, it fetches some data, renders the child components, and then they start fetching their data. If the network is not very fast, this is significantly slower than fetching all data in parallel.</li> <li><strong>Fetching directly in Effects usually means you don't preload or cache data.</strong> For example, if the component unmounts and then mounts again, it would have to fetch the data again.</li> <li><strong>It's not very ergonomic.</strong> There's quite a bit of boilerplate code involved when writing <code>fetch</code> calls in a way that doesn't suffer from bugs like <a href=https://maxrozen.com/race-conditions-fetching-data-react-with-useeffect>race conditions.</a></li> </ul> <p>This list of downsides is not specific to React. It applies to fetching data on mount with any library. Like with routing, data fetching is not trivial to do well, so we recommend the following approaches:</p> <ul> <li><strong>If you use a <a href=/learn/start-a-new-react-project#production-grade-react-frameworks>framework</a>, use its built-in data fetching mechanism.</strong> Modern React frameworks have integrated data fetching mechanisms that are efficient and don't suffer from the above pitfalls.</li> <li><strong>Otherwise, consider using or building a client-side cache.</strong> Popular open source solutions include <a href=https://tanstack.com/query/latest>React Query</a>, <a href=https://swr.vercel.app/ >useSWR</a>, and <a href=https://beta.reactrouter.com/en/main/start/overview>React Router 6.4+.</a> You can build your own solution too, in which case you would use Effects under the hood, but add logic for deduplicating requests, caching responses, and avoiding network waterfalls (by preloading data or hoisting data requirements to routes).</li> </ul> <p>You can continue fetching data directly in Effects if neither of these approaches suit you.</p> <p></deepdive></p> <h3 id=sending-analytics>Sending analytics<a class=headerlink href=#sending-analytics title="Permanent link">&para;</a></h3> <p>Consider this code that sends an analytics event on the page visit:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>logVisit</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span><span class=w> </span><span class=c1>// Sends a POST request</span>
<span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>url</span><span class=p>]);</span>
</code></pre></div></td></tr></table></div> <p>In development, <code>logVisit</code> will be called twice for every URL, so you might be tempted to try to fix that. <strong>We recommend keeping this code as is.</strong> Like with earlier examples, there is no <em>user-visible</em> behavior difference between running it once and running it twice. From a practical point of view, <code>logVisit</code> should not do anything in development because you don't want the logs from the development machines to skew the production metrics. Your component remounts every time you save its file, so it logs extra visits in development anyway.</p> <p><strong>In production, there will be no duplicate visit logs.</strong></p> <p>To debug the analytics events you're sending, you can deploy your app to a staging environment (which runs in production mode) or temporarily opt out of <a href=/reference/react/StrictMode>Strict Mode</a> and its development-only remounting checks. You may also send analytics from the route change event handlers instead of Effects. For more precise analytics, <a href=https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API>intersection observers</a> can help track which components are in the viewport and how long they remain visible.</p> <h3 id=not-an-effect-initializing-the-application>Not an Effect: Initializing the application<a class=headerlink href=#not-an-effect-initializing-the-application title="Permanent link">&para;</a></h3> <p>Some logic should only run once when the application starts. You can put it outside your components:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=ow>typeof</span><span class=w> </span><span class=nb>window</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=s2>&quot;undefined&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// Check if we&#39;re running in the browser.</span>
<span class=w>    </span><span class=nx>checkAuthToken</span><span class=p>();</span>
<span class=w>    </span><span class=nx>loadDataFromLocalStorage</span><span class=p>();</span>
<span class=p>}</span>

<span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>This guarantees that such logic only runs once after the browser loads the page.</p> <h3 id=not-an-effect-buying-a-product>Not an Effect: Buying a product<a class=headerlink href=#not-an-effect-buying-a-product title="Permanent link">&para;</a></h3> <p>Sometimes, even if you write a cleanup function, there's no way to prevent user-visible consequences of running the Effect twice. For example, maybe your Effect sends a POST request like buying a product:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// 🔴 Wrong: This Effect fires twice in development, exposing a problem in the code.</span>
<span class=w>    </span><span class=nx>fetch</span><span class=p>(</span><span class=s2>&quot;/api/buy&quot;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;POST&quot;</span><span class=w> </span><span class=p>});</span>
<span class=p>},</span><span class=w> </span><span class=p>[]);</span>
</code></pre></div></td></tr></table></div> <p>You wouldn't want to buy the product twice. However, this is also why you shouldn't put this logic in an Effect. What if the user goes to another page and then presses Back? Your Effect would run again. You don't want to buy the product when the user <em>visits</em> a page; you want to buy it when the user <em>clicks</em> the Buy button.</p> <p>Buying is not caused by rendering; it's caused by a specific interaction. It should run only when the user presses the button. <strong>Delete the Effect and move your <code>/api/buy</code> request into the Buy button event handler:</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>function</span><span class=w> </span><span class=nx>handleClick</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=c1>// ✅ Buying is an event because it is caused by a particular interaction.</span>
<span class=w>    </span><span class=nx>fetch</span><span class=p>(</span><span class=s2>&quot;/api/buy&quot;</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>method</span><span class=o>:</span><span class=w> </span><span class=s2>&quot;POST&quot;</span><span class=w> </span><span class=p>});</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><strong>This illustrates that if remounting breaks the logic of your application, this usually uncovers existing bugs.</strong> From the user's perspective, visiting a page shouldn't be different from visiting it, clicking a link, and pressing Back. React verifies that your components abide by this principle by remounting them once in development.</p> <h2 id=putting-it-all-together>Putting it all together<a class=headerlink href=#putting-it-all-together title="Permanent link">&para;</a></h2> <p>This playground can help you "get a feel" for how Effects work in practice.</p> <p>This example uses <a href=https://developer.mozilla.org/en-US/docs/Web/API/setTimeout><code>setTimeout</code></a> to schedule a console log with the input text to appear three seconds after the Effect runs. The cleanup function cancels the pending timeout. Start by pressing "Mount the component":</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=kd>function</span><span class=w> </span><span class=nx>Playground</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>text</span><span class=p>,</span><span class=w> </span><span class=nx>setText</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;a&quot;</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>function</span><span class=w> </span><span class=nx>onTimeout</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;⏰ &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>text</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;🔵 Schedule &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>text</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; log&#39;</span><span class=p>);</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>timeoutId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>setTimeout</span><span class=p>(</span><span class=nx>onTimeout</span><span class=p>,</span><span class=w> </span><span class=mf>3000</span><span class=p>);</span>

<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;🟡 Cancel &quot;&#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>text</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;&quot; log&#39;</span><span class=p>);</span>
<span class=w>            </span><span class=nx>clearTimeout</span><span class=p>(</span><span class=nx>timeoutId</span><span class=p>);</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>text</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                </span><span class=nx>What</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>log</span><span class=o>:</span><span class=p>{</span><span class=s2>&quot; &quot;</span><span class=p>}</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>text</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setText</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>text</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/h1&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>(</span><span class=o>!</span><span class=nx>show</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Unmount&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Mount&quot;</span><span class=p>}</span><span class=w> </span><span class=nx>the</span><span class=w> </span><span class=nx>component</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>Playground</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>You will see three logs at first: <code>Schedule "a" log</code>, <code>Cancel "a" log</code>, and <code>Schedule "a" log</code> again. Three second later there will also be a log saying <code>a</code>. As you learned earlier, the extra schedule/cancel pair is because React remounts the component once in development to verify that you've implemented cleanup well.</p> <p>Now edit the input to say <code>abc</code>. If you do it fast enough, you'll see <code>Schedule "ab" log</code> immediately followed by <code>Cancel "ab" log</code> and <code>Schedule "abc" log</code>. <strong>React always cleans up the previous render's Effect before the next render's Effect.</strong> This is why even if you type into the input fast, there is at most one timeout scheduled at a time. Edit the input a few times and watch the console to get a feel for how Effects get cleaned up.</p> <p>Type something into the input and then immediately press "Unmount the component". Notice how unmounting cleans up the last render's Effect. Here, it clears the last timeout before it has a chance to fire.</p> <p>Finally, edit the component above and comment out the cleanup function so that the timeouts don't get cancelled. Try typing <code>abcde</code> fast. What do you expect to happen in three seconds? Will <code>console.log(text)</code> inside the timeout print the <em>latest</em> <code>text</code> and produce five <code>abcde</code> logs? Give it a try to check your intuition!</p> <p>Three seconds later, you should see a sequence of logs (<code>a</code>, <code>ab</code>, <code>abc</code>, <code>abcd</code>, and <code>abcde</code>) rather than five <code>abcde</code> logs. <strong>Each Effect "captures" the <code>text</code> value from its corresponding render.</strong> It doesn't matter that the <code>text</code> state changed: an Effect from the render with <code>text = 'ab'</code> will always see <code>'ab'</code>. In other words, Effects from each render are isolated from each other. If you're curious how this works, you can read about <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures>closures</a>.</p> <p><deepdive></p> <h4 id=each-render-has-its-own-effects>Each render has its own Effects<a class=headerlink href=#each-render-has-its-own-effects title="Permanent link">&para;</a></h4> <p>You can think of <code>useEffect</code> as "attaching" a piece of behavior to the render output. Consider this Effect:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>ChatRoom</span><span class=p>({</span><span class=w> </span><span class=nx>roomId</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=nx>roomId</span><span class=p>);</span>
<span class=w>        </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>roomId</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=p>{</span><span class=nx>roomId</span><span class=p>}</span><span class=o>!&lt;</span><span class=err>/h1&gt;;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Let's see what exactly happens as the user navigates around the app.</p> <h4 id=initial-render>Initial render<a class=headerlink href=#initial-render title="Permanent link">&para;</a></h4> <p>The user visits <code>&lt;ChatRoom roomId="general" /&gt;</code>. Let's <a href=/learn/state-as-a-snapshot#rendering-takes-a-snapshot-in-time>mentally substitute</a> <code>roomId</code> with <code>'general'</code>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span class=c1>// JSX for the first render (roomId = &quot;general&quot;)</span>
<span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>general</span><span class=o>!&lt;</span><span class=err>/h1&gt;;</span>
</code></pre></div></td></tr></table></div> <p><strong>The Effect is <em>also</em> a part of the rendering output.</strong> The first render's Effect becomes:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=c1>// Effect for the first render (roomId = &quot;general&quot;)</span>
<span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=s2>&quot;general&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=p>},</span>
<span class=w>    </span><span class=c1>// Dependencies for the first render (roomId = &quot;general&quot;)</span>
<span class=w>    </span><span class=p>[</span><span class=s2>&quot;general&quot;</span><span class=p>];</span>
</code></pre></div></td></tr></table></div> <p>React runs this Effect, which connects to the <code>'general'</code> chat room.</p> <h4 id=re-render-with-same-dependencies>Re-render with same dependencies<a class=headerlink href=#re-render-with-same-dependencies title="Permanent link">&para;</a></h4> <p>Let's say <code>&lt;ChatRoom roomId="general" /&gt;</code> re-renders. The JSX output is the same:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span class=c1>// JSX for the second render (roomId = &quot;general&quot;)</span>
<span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>general</span><span class=o>!&lt;</span><span class=err>/h1&gt;;</span>
</code></pre></div></td></tr></table></div> <p>React sees that the rendering output has not changed, so it doesn't update the DOM.</p> <p>The Effect from the second render looks like this:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=c1>// Effect for the second render (roomId = &quot;general&quot;)</span>
<span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=s2>&quot;general&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=p>},</span>
<span class=w>    </span><span class=c1>// Dependencies for the second render (roomId = &quot;general&quot;)</span>
<span class=w>    </span><span class=p>[</span><span class=s2>&quot;general&quot;</span><span class=p>];</span>
</code></pre></div></td></tr></table></div> <p>React compares <code>['general']</code> from the second render with <code>['general']</code> from the first render. <strong>Because all dependencies are the same, React <em>ignores</em> the Effect from the second render.</strong> It never gets called.</p> <h4 id=re-render-with-different-dependencies>Re-render with different dependencies<a class=headerlink href=#re-render-with-different-dependencies title="Permanent link">&para;</a></h4> <p>Then, the user visits <code>&lt;ChatRoom roomId="travel" /&gt;</code>. This time, the component returns different JSX:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code><span class=c1>// JSX for the third render (roomId = &quot;travel&quot;)</span>
<span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Welcome</span><span class=w> </span><span class=nx>to</span><span class=w> </span><span class=nx>travel</span><span class=o>!&lt;</span><span class=err>/h1&gt;;</span>
</code></pre></div></td></tr></table></div> <p>React updates the DOM to change <code>"Welcome to general"</code> into <code>"Welcome to travel"</code>.</p> <p>The Effect from the third render looks like this:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=c1>// Effect for the third render (roomId = &quot;travel&quot;)</span>
<span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>connection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>createConnection</span><span class=p>(</span><span class=s2>&quot;travel&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=nx>connection</span><span class=p>.</span><span class=nx>connect</span><span class=p>();</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>connection</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>();</span>
<span class=p>},</span>
<span class=w>    </span><span class=c1>// Dependencies for the third render (roomId = &quot;travel&quot;)</span>
<span class=w>    </span><span class=p>[</span><span class=s2>&quot;travel&quot;</span><span class=p>];</span>
</code></pre></div></td></tr></table></div> <p>React compares <code>['travel']</code> from the third render with <code>['general']</code> from the second render. One dependency is different: <code>Object.is('travel', 'general')</code> is <code>false</code>. The Effect can't be skipped.</p> <p><strong>Before React can apply the Effect from the third render, it needs to clean up the last Effect that <em>did</em> run.</strong> The second render's Effect was skipped, so React needs to clean up the first render's Effect. If you scroll up to the first render, you'll see that its cleanup calls <code>disconnect()</code> on the connection that was created with <code>createConnection('general')</code>. This disconnects the app from the <code>'general'</code> chat room.</p> <p>After that, React runs the third render's Effect. It connects to the <code>'travel'</code> chat room.</p> <h4 id=unmount>Unmount<a class=headerlink href=#unmount title="Permanent link">&para;</a></h4> <p>Finally, let's say the user navigates away, and the <code>ChatRoom</code> component unmounts. React runs the last Effect's cleanup function. The last Effect was from the third render. The third render's cleanup destroys the <code>createConnection('travel')</code> connection. So the app disconnects from the <code>'travel'</code> room.</p> <h4 id=development-only-behaviors>Development-only behaviors<a class=headerlink href=#development-only-behaviors title="Permanent link">&para;</a></h4> <p>When <a href=/reference/react/StrictMode>Strict Mode</a> is on, React remounts every component once after mount (state and DOM are preserved). This <a href=#step-3-add-cleanup-if-needed>helps you find Effects that need cleanup</a> and exposes bugs like race conditions early. Additionally, React will remount the Effects whenever you save a file in development. Both of these behaviors are development-only.</p> <p></deepdive></p> <p><recap></p> <ul> <li>Unlike events, Effects are caused by rendering itself rather than a particular interaction.</li> <li>Effects let you synchronize a component with some external system (third-party API, network, etc).</li> <li>By default, Effects run after every render (including the initial one).</li> <li>React will skip the Effect if all of its dependencies have the same values as during the last render.</li> <li>You can't "choose" your dependencies. They are determined by the code inside the Effect.</li> <li>Empty dependency array (<code>[]</code>) corresponds to the component "mounting", i.e. being added to the screen.</li> <li>In Strict Mode, React mounts components twice (in development only!) to stress-test your Effects.</li> <li>If your Effect breaks because of remounting, you need to implement a cleanup function.</li> <li>React will call your cleanup function before the Effect runs next time, and during the unmount.</li> </ul> <p></recap></p> <p><challenges></p> <h4 id=focus-a-field-on-mount>Focus a field on mount<a class=headerlink href=#focus-a-field-on-mount title="Permanent link">&para;</a></h4> <p>In this example, the form renders a <code>&lt;MyInput /&gt;</code> component.</p> <p>Use the input's <a href=https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/focus><code>focus()</code></a> method to make <code>MyInput</code> automatically focus when it appears on the screen. There is already a commented out implementation, but it doesn't quite work. Figure out why it doesn't work, and fix it. (If you're familiar with the <code>autoFocus</code> attribute, pretend that it does not exist: we are reimplementing the same functionality from scratch.)</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>MyInput</span><span class=p>({</span><span class=w> </span><span class=nx>value</span><span class=p>,</span><span class=w> </span><span class=nx>onChange</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=c1>// TODO: This doesn&#39;t quite work. Fix it.</span>
<span class=w>    </span><span class=c1>// ref.current.focus()</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>value</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>onChange</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>MyInput</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./MyInput.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=nx>setName</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Taylor&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>upper</span><span class=p>,</span><span class=w> </span><span class=nx>setUpper</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>((</span><span class=nx>s</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>!</span><span class=nx>s</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Hide&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Show&quot;</span><span class=p>}</span><span class=w> </span><span class=nx>form</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>br</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span>
<span class=w>                </span><span class=o>&lt;&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Enter</span><span class=w> </span><span class=nx>your</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                        </span><span class=o>&lt;</span><span class=nx>MyInput</span>
<span class=w>                            </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span>
<span class=w>                            </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setName</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                        </span><span class=o>/&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                            </span><span class=nx>type</span><span class=o>=</span><span class=s2>&quot;checkbox&quot;</span>
<span class=w>                            </span><span class=nx>checked</span><span class=o>=</span><span class=p>{</span><span class=nx>upper</span><span class=p>}</span>
<span class=w>                            </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setUpper</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>checked</span><span class=p>)}</span>
<span class=w>                        </span><span class=o>/&gt;</span>
<span class=w>                        </span><span class=nx>Make</span><span class=w> </span><span class=nx>it</span><span class=w> </span><span class=nx>uppercase</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Hello</span><span class=p>,</span><span class=w> </span><span class=o>&lt;</span><span class=nx>b</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>upper</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nx>name</span><span class=p>.</span><span class=nx>toUpperCase</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>name</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/b&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>            </span><span class=p>)}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-top</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>

<span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>150</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>To verify that your solution works, press "Show form" and verify that the input receives focus (becomes highlighted and the cursor is placed inside). Press "Hide form" and "Show form" again. Verify the input is highlighted again.</p> <p><code>MyInput</code> should only focus <em>on mount</em> rather than after every render. To verify that the behavior is right, press "Show form" and then repeatedly press the "Make it uppercase" checkbox. Clicking the checkbox should <em>not</em> focus the input above it.</p> <p><solution></p> <p>Calling <code>ref.current.focus()</code> during render is wrong because it is a <em>side effect</em>. Side effects should either be placed inside an event handler or be declared with <code>useEffect</code>. In this case, the side effect is <em>caused</em> by the component appearing rather than by any specific interaction, so it makes sense to put it in an Effect.</p> <p>To fix the mistake, wrap the <code>ref.current.focus()</code> call into an Effect declaration. Then, to ensure that this Effect runs only on mount rather than after every render, add the empty <code>[]</code> dependencies to it.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>MyInput</span><span class=p>({</span><span class=w> </span><span class=nx>value</span><span class=p>,</span><span class=w> </span><span class=nx>onChange</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>value</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>onChange</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>MyInput</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./MyInput.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>name</span><span class=p>,</span><span class=w> </span><span class=nx>setName</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Taylor&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>upper</span><span class=p>,</span><span class=w> </span><span class=nx>setUpper</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>((</span><span class=nx>s</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>!</span><span class=nx>s</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Hide&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Show&quot;</span><span class=p>}</span><span class=w> </span><span class=nx>form</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>br</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span>
<span class=w>                </span><span class=o>&lt;&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Enter</span><span class=w> </span><span class=nx>your</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                        </span><span class=o>&lt;</span><span class=nx>MyInput</span>
<span class=w>                            </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span>
<span class=w>                            </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setName</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                        </span><span class=o>/&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=o>&lt;</span><span class=nx>input</span>
<span class=w>                            </span><span class=nx>type</span><span class=o>=</span><span class=s2>&quot;checkbox&quot;</span>
<span class=w>                            </span><span class=nx>checked</span><span class=o>=</span><span class=p>{</span><span class=nx>upper</span><span class=p>}</span>
<span class=w>                            </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setUpper</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>checked</span><span class=p>)}</span>
<span class=w>                        </span><span class=o>/&gt;</span>
<span class=w>                        </span><span class=nx>Make</span><span class=w> </span><span class=nx>it</span><span class=w> </span><span class=nx>uppercase</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Hello</span><span class=p>,</span><span class=w> </span><span class=o>&lt;</span><span class=nx>b</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>upper</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nx>name</span><span class=p>.</span><span class=nx>toUpperCase</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>name</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/b&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>            </span><span class=p>)}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-top</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>

<span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>150</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p></solution></p> <h4 id=focus-a-field-conditionally>Focus a field conditionally<a class=headerlink href=#focus-a-field-conditionally title="Permanent link">&para;</a></h4> <p>This form renders two <code>&lt;MyInput /&gt;</code> components.</p> <p>Press "Show form" and notice that the second field automatically gets focused. This is because both of the <code>&lt;MyInput /&gt;</code> components try to focus the field inside. When you call <code>focus()</code> for two input fields in a row, the last one always "wins".</p> <p>Let's say you want to focus the first field. The first <code>MyInput</code> component now receives a boolean <code>shouldFocus</code> prop set to <code>true</code>. Change the logic so that <code>focus()</code> is only called if the <code>shouldFocus</code> prop received by <code>MyInput</code> is <code>true</code>.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>MyInput</span><span class=p>({</span><span class=w> </span><span class=nx>shouldFocus</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=p>,</span><span class=w> </span><span class=nx>onChange</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=c1>// TODO: call focus() only if shouldFocus is true.</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>value</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>onChange</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>MyInput</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./MyInput.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>firstName</span><span class=p>,</span><span class=w> </span><span class=nx>setFirstName</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Taylor&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>lastName</span><span class=p>,</span><span class=w> </span><span class=nx>setLastName</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Swift&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>upper</span><span class=p>,</span><span class=w> </span><span class=nx>setUpper</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>firstName</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>lastName</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>((</span><span class=nx>s</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>!</span><span class=nx>s</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Hide&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Show&quot;</span><span class=p>}</span><span class=w> </span><span class=nx>form</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>br</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span>
<span class=w>                </span><span class=o>&lt;&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Enter</span><span class=w> </span><span class=nx>your</span><span class=w> </span><span class=nx>first</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                        </span><span class=o>&lt;</span><span class=nx>MyInput</span>
<span class=w>                            </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>firstName</span><span class=p>}</span>
<span class=w>                            </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setFirstName</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                            </span><span class=nx>shouldFocus</span><span class=o>=</span><span class=p>{</span><span class=kc>true</span><span class=p>}</span>
<span class=w>                        </span><span class=o>/&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Enter</span><span class=w> </span><span class=nx>your</span><span class=w> </span><span class=nx>last</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                        </span><span class=o>&lt;</span><span class=nx>MyInput</span>
<span class=w>                            </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>lastName</span><span class=p>}</span>
<span class=w>                            </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setLastName</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                            </span><span class=nx>shouldFocus</span><span class=o>=</span><span class=p>{</span><span class=kc>false</span><span class=p>}</span>
<span class=w>                        </span><span class=o>/&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Hello</span><span class=p>,</span><span class=w> </span><span class=o>&lt;</span><span class=nx>b</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>upper</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nx>name</span><span class=p>.</span><span class=nx>toUpperCase</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>name</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/b&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>            </span><span class=p>)}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-top</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>

<span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>150</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>To verify your solution, press "Show form" and "Hide form" repeatedly. When the form appears, only the <em>first</em> input should get focused. This is because the parent component renders the first input with <code>shouldFocus={true}</code> and the second input with <code>shouldFocus={false}</code>. Also check that both inputs still work and you can type into both of them.</p> <p><hint></p> <p>You can't declare an Effect conditionally, but your Effect can include conditional logic.</p> <p></hint></p> <p><solution></p> <p>Put the conditional logic inside the Effect. You will need to specify <code>shouldFocus</code> as a dependency because you are using it inside the Effect. (This means that if some input's <code>shouldFocus</code> changes from <code>false</code> to <code>true</code>, it will focus after mount.)</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useEffect</span><span class=p>,</span><span class=w> </span><span class=nx>useRef</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>MyInput</span><span class=p>({</span><span class=w> </span><span class=nx>shouldFocus</span><span class=p>,</span><span class=w> </span><span class=nx>value</span><span class=p>,</span><span class=w> </span><span class=nx>onChange</span><span class=w> </span><span class=p>})</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useRef</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>shouldFocus</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>.</span><span class=nx>focus</span><span class=p>();</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>shouldFocus</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>input</span><span class=w> </span><span class=nx>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>ref</span><span class=p>}</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>value</span><span class=p>}</span><span class=w> </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=nx>onChange</span><span class=p>}</span><span class=w> </span><span class=o>/&gt;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>MyInput</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./MyInput.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>firstName</span><span class=p>,</span><span class=w> </span><span class=nx>setFirstName</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Taylor&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>lastName</span><span class=p>,</span><span class=w> </span><span class=nx>setLastName</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Swift&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>upper</span><span class=p>,</span><span class=w> </span><span class=nx>setUpper</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>firstName</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot; &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>lastName</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>((</span><span class=nx>s</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>!</span><span class=nx>s</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Hide&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Show&quot;</span><span class=p>}</span><span class=w> </span><span class=nx>form</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>br</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=p>(</span>
<span class=w>                </span><span class=o>&lt;&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Enter</span><span class=w> </span><span class=nx>your</span><span class=w> </span><span class=nx>first</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                        </span><span class=o>&lt;</span><span class=nx>MyInput</span>
<span class=w>                            </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>firstName</span><span class=p>}</span>
<span class=w>                            </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setFirstName</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                            </span><span class=nx>shouldFocus</span><span class=o>=</span><span class=p>{</span><span class=kc>true</span><span class=p>}</span>
<span class=w>                        </span><span class=o>/&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>label</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Enter</span><span class=w> </span><span class=nx>your</span><span class=w> </span><span class=nx>last</span><span class=w> </span><span class=nx>name</span><span class=o>:</span>
<span class=w>                        </span><span class=o>&lt;</span><span class=nx>MyInput</span>
<span class=w>                            </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>lastName</span><span class=p>}</span>
<span class=w>                            </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setLastName</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>)}</span>
<span class=w>                            </span><span class=nx>shouldFocus</span><span class=o>=</span><span class=p>{</span><span class=kc>false</span><span class=p>}</span>
<span class=w>                        </span><span class=o>/&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/label&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                        </span><span class=nx>Hello</span><span class=p>,</span><span class=w> </span><span class=o>&lt;</span><span class=nx>b</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>upper</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=nx>name</span><span class=p>.</span><span class=nx>toUpperCase</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=nx>name</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/b&gt;</span>
<span class=w>                    </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>            </span><span class=p>)}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-top</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>

<span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>150</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p></solution></p> <h4 id=fix-an-interval-that-fires-twice>Fix an interval that fires twice<a class=headerlink href=#fix-an-interval-that-fires-twice title="Permanent link">&para;</a></h4> <p>This <code>Counter</code> component displays a counter that should increment every second. On mount, it calls <a href=https://developer.mozilla.org/en-US/docs/Web/API/setInterval><code>setInterval</code>.</a> This causes <code>onTick</code> to run every second. The <code>onTick</code> function increments the counter.</p> <p>However, instead of incrementing once per second, it increments twice. Why is that? Find the cause of the bug and fix it.</p> <p><hint></p> <p>Keep in mind that <code>setInterval</code> returns an interval ID, which you can pass to <a href=https://developer.mozilla.org/en-US/docs/Web/API/clearInterval><code>clearInterval</code></a> to stop the interval.</p> <p></hint></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Counter</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>count</span><span class=p>,</span><span class=w> </span><span class=nx>setCount</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>function</span><span class=w> </span><span class=nx>onTick</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setCount</span><span class=p>((</span><span class=nx>c</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>c</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=nx>setInterval</span><span class=p>(</span><span class=nx>onTick</span><span class=p>,</span><span class=w> </span><span class=mf>1000</span><span class=p>);</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>count</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/h1&gt;;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Counter</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Counter.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Form</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>((</span><span class=nx>s</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>!</span><span class=nx>s</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Hide&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Show&quot;</span><span class=p>}</span><span class=w> </span><span class=nx>counter</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>br</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>Counter</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-top</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>

<span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>150</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p><solution></p> <p>When <a href=/reference/react/StrictMode>Strict Mode</a> is on (like in the sandboxes on this site), React remounts each component once in development. This causes the interval to be set up twice, and this is why each second the counter increments twice.</p> <p>However, React's behavior is not the <em>cause</em> of the bug: the bug already exists in the code. React's behavior makes the bug more noticeable. The real cause is that this Effect starts a process but doesn't provide a way to clean it up.</p> <p>To fix this code, save the interval ID returned by <code>setInterval</code>, and implement a cleanup function with <a href=https://developer.mozilla.org/en-US/docs/Web/API/clearInterval><code>clearInterval</code></a>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Counter</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>count</span><span class=p>,</span><span class=w> </span><span class=nx>setCount</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=mf>0</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>function</span><span class=w> </span><span class=nx>onTick</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setCount</span><span class=p>((</span><span class=nx>c</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>c</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mf>1</span><span class=p>);</span>
<span class=w>        </span><span class=p>}</span>

<span class=w>        </span><span class=kd>const</span><span class=w> </span><span class=nx>intervalId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>setInterval</span><span class=p>(</span><span class=nx>onTick</span><span class=p>,</span><span class=w> </span><span class=mf>1000</span><span class=p>);</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>clearInterval</span><span class=p>(</span><span class=nx>intervalId</span><span class=p>);</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>count</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/h1&gt;;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=nx>Counter</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./Counter.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>App</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>show</span><span class=p>,</span><span class=w> </span><span class=nx>setShow</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>button</span><span class=w> </span><span class=nx>on_click</span><span class=o>=</span><span class=p>{()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=nx>setShow</span><span class=p>((</span><span class=nx>s</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=o>!</span><span class=nx>s</span><span class=p>)}</span><span class=o>&gt;</span>
<span class=w>                </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=s2>&quot;Hide&quot;</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=s2>&quot;Show&quot;</span><span class=p>}</span><span class=w> </span><span class=nx>counter</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/button&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>br</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=p>{</span><span class=nx>show</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=o>&lt;</span><span class=nx>Counter</span><span class=w> </span><span class=o>/&gt;</span><span class=p>}</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nt>label</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>display</span><span class=p>:</span><span class=w> </span><span class=kc>block</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-top</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=w>    </span><span class=k>margin-bottom</span><span class=p>:</span><span class=w> </span><span class=mi>20</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>

<span class=nt>body</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=k>min-height</span><span class=p>:</span><span class=w> </span><span class=mi>150</span><span class=kt>px</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>In development, React will still remount your component once to verify that you've implemented cleanup well. So there will be a <code>setInterval</code> call, immediately followed by <code>clearInterval</code>, and <code>setInterval</code> again. In production, there will be only one <code>setInterval</code> call. The user-visible behavior in both cases is the same: the counter increments once per second.</p> <p></solution></p> <h4 id=fix-fetching-inside-an-effect>Fix fetching inside an Effect<a class=headerlink href=#fix-fetching-inside-an-effect title="Permanent link">&para;</a></h4> <p>This component shows the biography for the selected person. It loads the biography by calling an asynchronous function <code>fetchBio(person)</code> on mount and whenever <code>person</code> changes. That asynchronous function returns a <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise>Promise</a> which eventually resolves to a string. When fetching is done, it calls <code>setBio</code> to display that string under the select box.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>fetchBio</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./api.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Page</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Alice&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>bio</span><span class=p>,</span><span class=w> </span><span class=nx>setBio</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>

<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setBio</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>        </span><span class=nx>fetchBio</span><span class=p>(</span><span class=nx>person</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>result</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>setBio</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>                    </span><span class=nx>setPerson</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
<span class=w>                </span><span class=p>}}</span>
<span class=w>            </span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Alice&quot;</span><span class=o>&gt;</span><span class=nx>Alice</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Bob&quot;</span><span class=o>&gt;</span><span class=nx>Bob</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Taylor&quot;</span><span class=o>&gt;</span><span class=nx>Taylor</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>i</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>bio</span><span class=w> </span><span class=o>??</span><span class=w> </span><span class=s2>&quot;Loading...&quot;</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/i&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>fetchBio</span><span class=p>(</span><span class=nx>person</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>delay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>person</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;Bob&quot;</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=mf>2000</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=mf>200</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>resolve</span><span class=p>(</span><span class=s2>&quot;This is &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>person</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;’s bio.&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span><span class=w> </span><span class=nx>delay</span><span class=p>);</span>
<span class=w>    </span><span class=p>});</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>There is a bug in this code. Start by selecting "Alice". Then select "Bob" and then immediately after that select "Taylor". If you do this fast enough, you will notice that bug: Taylor is selected, but the paragraph below says "This is Bob's bio."</p> <p>Why does this happen? Fix the bug inside this Effect.</p> <p><hint></p> <p>If an Effect fetches something asynchronously, it usually needs cleanup.</p> <p></hint></p> <p><solution></p> <p>To trigger the bug, things need to happen in this order:</p> <ul> <li>Selecting <code>'Bob'</code> triggers <code>fetchBio('Bob')</code></li> <li>Selecting <code>'Taylor'</code> triggers <code>fetchBio('Taylor')</code></li> <li><strong>Fetching <code>'Taylor'</code> completes <em>before</em> fetching <code>'Bob'</code></strong></li> <li>The Effect from the <code>'Taylor'</code> render calls <code>setBio('This is Taylor’s bio')</code></li> <li>Fetching <code>'Bob'</code> completes</li> <li>The Effect from the <code>'Bob'</code> render calls <code>setBio('This is Bob’s bio')</code></li> </ul> <p>This is why you see Bob's bio even though Taylor is selected. Bugs like this are called <a href=https://en.wikipedia.org/wiki/Race_condition>race conditions</a> because two asynchronous operations are "racing" with each other, and they might arrive in an unexpected order.</p> <p>To fix this race condition, add a cleanup function:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>useState</span><span class=p>,</span><span class=w> </span><span class=nx>useEffect</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;react&quot;</span><span class=p>;</span>
<span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>fetchBio</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;./api.js&quot;</span><span class=p>;</span>

<span class=k>export</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>Page</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>,</span><span class=w> </span><span class=nx>setPerson</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=s2>&quot;Alice&quot;</span><span class=p>);</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=p>[</span><span class=nx>bio</span><span class=p>,</span><span class=w> </span><span class=nx>setBio</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>useState</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>    </span><span class=nx>useEffect</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>;</span>
<span class=w>        </span><span class=nx>setBio</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
<span class=w>        </span><span class=nx>fetchBio</span><span class=p>(</span><span class=nx>person</span><span class=p>).</span><span class=nx>then</span><span class=p>((</span><span class=nx>result</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=nx>ignore</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>                </span><span class=nx>setBio</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
<span class=w>            </span><span class=p>}</span>
<span class=w>        </span><span class=p>});</span>
<span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>ignore</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span>
<span class=w>        </span><span class=p>};</span>
<span class=w>    </span><span class=p>},</span><span class=w> </span><span class=p>[</span><span class=nx>person</span><span class=p>]);</span>

<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span>
<span class=w>        </span><span class=o>&lt;&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>select</span>
<span class=w>                </span><span class=nx>value</span><span class=o>=</span><span class=p>{</span><span class=nx>person</span><span class=p>}</span>
<span class=w>                </span><span class=nx>onChange</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>                    </span><span class=nx>setPerson</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
<span class=w>                </span><span class=p>}}</span>
<span class=w>            </span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Alice&quot;</span><span class=o>&gt;</span><span class=nx>Alice</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Bob&quot;</span><span class=o>&gt;</span><span class=nx>Bob</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>option</span><span class=w> </span><span class=nx>value</span><span class=o>=</span><span class=s2>&quot;Taylor&quot;</span><span class=o>&gt;</span><span class=nx>Taylor</span><span class=o>&lt;</span><span class=err>/option&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/select&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>hr</span><span class=w> </span><span class=o>/&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span>
<span class=w>                </span><span class=o>&lt;</span><span class=nx>i</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>bio</span><span class=w> </span><span class=o>??</span><span class=w> </span><span class=s2>&quot;Loading...&quot;</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/i&gt;</span>
<span class=w>            </span><span class=o>&lt;</span><span class=err>/p&gt;</span>
<span class=w>        </span><span class=o>&lt;</span><span class=err>/&gt;</span>
<span class=w>    </span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div><pre><span></span><code><span class=k>export</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=kd>function</span><span class=w> </span><span class=nx>fetchBio</span><span class=p>(</span><span class=nx>person</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kd>const</span><span class=w> </span><span class=nx>delay</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>person</span><span class=w> </span><span class=o>===</span><span class=w> </span><span class=s2>&quot;Bob&quot;</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=mf>2000</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=mf>200</span><span class=p>;</span>
<span class=w>    </span><span class=k>return</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=nx>setTimeout</span><span class=p>(()</span><span class=w> </span><span class=p>=&gt;</span><span class=w> </span><span class=p>{</span>
<span class=w>            </span><span class=nx>resolve</span><span class=p>(</span><span class=s2>&quot;This is &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>person</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot;’s bio.&quot;</span><span class=p>);</span>
<span class=w>        </span><span class=p>},</span><span class=w> </span><span class=nx>delay</span><span class=p>);</span>
<span class=w>    </span><span class=p>});</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> <p>Each render's Effect has its own <code>ignore</code> variable. Initially, the <code>ignore</code> variable is set to <code>false</code>. However, if an Effect gets cleaned up (such as when you select a different person), its <code>ignore</code> variable becomes <code>true</code>. So now it doesn't matter in which order the requests complete. Only the last person's Effect will have <code>ignore</code> set to <code>false</code>, so it will call <code>setBio(result)</code>. Past Effects have been cleaned up, so the <code>if (!ignore)</code> check will prevent them from calling <code>setBio</code>:</p> <ul> <li>Selecting <code>'Bob'</code> triggers <code>fetchBio('Bob')</code></li> <li>Selecting <code>'Taylor'</code> triggers <code>fetchBio('Taylor')</code> <strong>and cleans up the previous (Bob's) Effect</strong></li> <li>Fetching <code>'Taylor'</code> completes <em>before</em> fetching <code>'Bob'</code></li> <li>The Effect from the <code>'Taylor'</code> render calls <code>setBio('This is Taylor’s bio')</code></li> <li>Fetching <code>'Bob'</code> completes</li> <li>The Effect from the <code>'Bob'</code> render <strong>does not do anything because its <code>ignore</code> flag was set to <code>true</code></strong></li> </ul> <p>In addition to ignoring the result of an outdated API call, you can also use <a href=https://developer.mozilla.org/en-US/docs/Web/API/AbortController><code>AbortController</code></a> to cancel the requests that are no longer needed. However, by itself this is not enough to protect against race conditions. More asynchronous steps could be chained after the fetch, so using an explicit flag like <code>ignore</code> is the most reliable way to fix this type of problems.</p> <p></solution></p> <p></challenges></p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 28, 2023 08:11:22">August 28, 2023</span> </small> </div> <div class=md-source-date> <small> Authors: <span class="git-page-authors git-authors"><a href=mailto:16909269+archmonger@users.noreply.github.com>Archmonger</a></span> </small> </div> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy;<div id=year> </div> <script> document.getElementById("year").innerHTML = new Date().getFullYear(); </script>Reactive Python and affiliates.<div class=legal-footer-right>This project has no affiliation to ReactJS or Meta Platforms, Inc.</div> </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "content.code.copy", "search.highlight"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.4e0fa4ba.min.js></script> <script src=../../assets/js/main.js></script> </body> </html>